{
    "pattern": "CREATE OR REPLACE FUNCTION indicator(<function_parameter>, <function_parameter>) AS ( WITH RECURSIVE <cte_parameter> AS ( SELECT 0 AS <column_alias_parameter>, 0 AS <column_alias_parameter> UNION ALL SELECT <column_alias_parameter> + 1, <column_alias_parameter> + IF( <function_parameter>[<column_alias_parameter> + 1] = <function_parameter>, 1, 0 ) AS <column_alias_parameter> FROM <cte_parameter> WHERE <column_alias_parameter> <comparison_operator_parameter> <function_parameter> ) SELECT ARRAY_AGG(<column_alias_parameter> ORDER BY <column_alias_parameter>)[2:] FROM <cte_parameter> ); CREATE OR REPLACE FUNCTION s_(<function_parameter>, <function_parameter>, <function_parameter>, <function_parameter>, <function_parameter>) AS ( SELECT IF( <function_parameter> = 0, <function_parameter>, IF( <function_parameter> = 1, <function_parameter>[1:<function_parameter> - 1] || ['X'] || <function_parameter>[<function_parameter> + 1:], ( WITH <ix_t_parameter> AS ( SELECT LIST_POSITION(<function_parameter>(<function_parameter>, <function_parameter>), <function_parameter>) AS <column_alias_parameter> ) SELECT IF(<column_alias_parameter>, <function_parameter>[1:<column_alias_parameter> - 1] || ['X'] || <function_parameter>[<column_alias_parameter> + 1:], <function_parameter>) FROM <ix_t_parameter> ) ) ) ); CREATE OR REPLACE FUNCTION s(<function_parameter>, <function_parameter>, <function_parameter>, <function_parameter>) AS ( s_(<function_parameter>, <function_parameter>, <function_parameter>, <function_parameter>, COALESCE(LIST_POSITION(<function_parameter>,<function_parameter>), 0)) ); SELECT s(['a', 'a', 'a'], 'a', 2, 'X'); SELECT s(['a', 'X', 'a'], 'a', 2, 'Y'); SELECT s(['a', 'a', 'a'], 'a', 2, 'X').s('a', 2, 'Y') AS <column_alias_parameter>; WITH <lst_t_parameter> AS ( SELECT REGEXP_EXTRACT_ALL('aaaaaaaaaaa', '.') AS <function_parameter> ) SELECT s(<function_parameter>, 'a', 1, 'A'), s(<function_parameter>, 'a', 1, 'B'), s(<function_parameter>, 'a', 1, 'C'), s(<function_parameter>, 'a', 1, 'D') FROM <lst_t_parameter>; ",
    "applied_rules": [
        "<function_parameter>",
        "<cte_parameter>",
        "<column_alias_parameter>",
        "<ix_t_parameter>",
        "<lst_t_parameter>",
        "<comparison_operator_parameter>"
    ],
    "Affected Elements": "Function s(), Function s_(), Recursive CTE, array_agg()",
    "Root Cause Analysis": "Incorrect handling of chained function calls leading to exponential performance degradation and incorrect results."
}