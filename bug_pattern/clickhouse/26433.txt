{
    "pattern": "CREATE DATABASE IF NOT EXISTS <database_name_parameter>; CREATE TABLE <table_name_parameter> ( agent_major <numeric_type_parameter>, agent_minor <numeric_type_parameter>, agent_name <low_cardinality_type_parameter>, args <string_type_parameter>, body_bytes_sent <numeric_type_parameter>, bytes_sent <numeric_type_parameter>, client_locality <enum_type_parameter> DEFAULT <enum_default_parameter>, connection_requests <numeric_type_parameter>, connection <numeric_type_parameter>, content_length <numeric_type_parameter>, content_type <low_cardinality_type_parameter>, device_brand <low_cardinality_type_parameter>, device_family <low_cardinality_type_parameter>, device_model <low_cardinality_type_parameter>, host <low_cardinality_type_parameter>, hostname <low_cardinality_type_parameter>, http_referer <string_type_parameter>, http_user_agent <low_cardinality_type_parameter>, ip_geo_country <low_cardinality_type_parameter>, is_args <low_cardinality_type_parameter>, msec <float_type_parameter>, os_major <low_cardinality_type_parameter>, os_minor <numeric_type_parameter>, os_name <low_cardinality_type_parameter>, proxy_addr6 <nullable_type_parameter>, proxy_port <numeric_type_parameter>, rating <numeric_type_parameter>, remote_addr6 <ipv6_type_parameter>, remote_port <numeric_type_parameter>, remote_user <string_type_parameter>, request_completion <low_cardinality_type_parameter>, request_id <string_type_parameter>, request_length <numeric_type_parameter>, request_method <low_cardinality_type_parameter>, request_time <float_type_parameter>, request <string_type_parameter>, response_code <numeric_type_parameter>, server_protocol <low_cardinality_type_parameter>, timestamp <datetime_type_parameter> DEFAULT <function_parameter>(msec), upstream_addr <array_type_parameter>, upstream_response_time <array_type_parameter>, userid <string_type_parameter>, sessionid <string_type_parameter>, url <string_type_parameter> ) ENGINE = <engine_type_parameter> PARTITION BY <function_parameter>(timestamp) PRIMARY KEY (timestamp, client_locality, http_user_agent, remote_addr6, response_code) ORDER BY (timestamp, client_locality, http_user_agent, remote_addr6, response_code); CREATE MATERIALIZED VIEW <materialized_view_name_parameter> ( time_interval <datetime_type_parameter> CODEC(<codec_parameter>, <codec_parameter>), userid <string_type_parameter> CODEC(<codec_parameter>), ips <aggregate_function_parameter> CODEC(<codec_parameter>), user_agents <aggregate_function_parameter> CODEC(<codec_parameter>), requests_count <aggregate_function_parameter> CODEC(<codec_parameter>) ) ENGINE = <engine_type_parameter> PARTITION BY <function_parameter>(time_interval) PRIMARY KEY (time_interval, userid) ORDER BY (time_interval, userid) AS SELECT <function_parameter>(timestamp) AS time_interval, userid, <aggregate_function_parameter>(remote_addr6) AS ips, <aggregate_function_parameter>(http_user_agent) AS user_agents, <aggregate_function_parameter>() AS requests_count FROM <table_name_parameter> WHERE userid <comparison_operator_replace> <string_parameter> GROUP BY <function_parameter>(timestamp), userid; INSERT INTO <table_name_parameter> FORMAT <format_type_parameter> VALUES (<value_parameter>, <value_parameter>, <value_parameter>, <value_parameter>, <value_parameter>, <value_parameter>, <string_parameter>, <value_parameter>, <value_parameter>, <value_parameter>, <string_parameter>, <value_parameter>, <value_parameter>, <value_parameter>, <string_parameter>, <string_parameter>, <string_parameter>, <string_parameter>, <string_parameter>, <string_parameter>, <string_parameter>, <float_parameter>, <string_parameter>, <value_parameter>, <string_parameter>, <value_parameter>, <value_parameter>, <ipv6_type_parameter>, <value_parameter>, <string_parameter>, <string_parameter>, <value_parameter>, <numeric_type_parameter>, <string_parameter>, <numeric_type_parameter>, <string_parameter>, <numeric_type_parameter>, <string_parameter>, <string_parameter>, <float_parameter>, <numeric_type_parameter>, <numeric_type_parameter>, <string_parameter>, <numeric_type_parameter>, <numeric_type_parameter>, <datetime_type_parameter>, <array_type_parameter>, <array_type_parameter>, <string_parameter>, <string_parameter>, <string_parameter>);",
    "applied_rules": [
        "<database_name_parameter>",
        "<table_name_parameter>",
        "<numeric_type_parameter>",
        "<low_cardinality_type_parameter>",
        "<string_type_parameter>",
        "<enum_type_parameter>",
        "<enum_default_parameter>",
        "<float_type_parameter>",
        "<nullable_type_parameter>",
        "<ipv6_type_parameter>",
        "<function_parameter>",
        "<engine_type_parameter>",
        "<codec_parameter>",
        "<aggregate_function_parameter>",
        "<array_type_parameter>",
        "<datetime_type_parameter>",
        "<format_type_parameter>",
        "<value_parameter>",
        "<comparison_operator_replace>",
        "<string_parameter>"
    ],
    "Affected Elements": "AggregateFunction, groupUniqArrayState",
    "Root Cause Analysis": "Incompatibility of AggregateFunction types between ClickHouse versions 21.6.5.37 and 21.7.3.14, specifically related to the handling of the groupUniqArrayState function."
}