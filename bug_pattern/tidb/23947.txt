{
    "pattern": "CREATE TABLE `topics` ( `id` bigint(20) <constraint_type_parameter> AUTO_INCREMENT, `title` varchar(255) COLLATE utf8mb4_unicode_ci <constraint_type_parameter>, `last_posted_at` datetime DEFAULT NULL, `created_at` datetime <constraint_type_parameter>, `updated_at` datetime <constraint_type_parameter>, `views` int(11) <constraint_enforce_replace> DEFAULT '0', `posts_count` int(11) <constraint_enforce_replace> DEFAULT '0', `user_id` int(11) DEFAULT NULL, `last_post_user_id` int(11) <constraint_type_parameter>, `reply_count` int(11) <constraint_enforce_replace> DEFAULT '0', `featured_user1_id` int(11) DEFAULT NULL, `featured_user2_id` int(11) DEFAULT NULL, `featured_user3_id` int(11) DEFAULT NULL, `avg_time` int(11) DEFAULT NULL, `deleted_at` datetime DEFAULT NULL, `highest_post_number` int(11) <constraint_enforce_replace> DEFAULT '0', `image_url` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `like_count` int(11) <constraint_enforce_replace> DEFAULT '0', `incoming_link_count` int(11) <constraint_enforce_replace> DEFAULT '0', `category_id` int(11) DEFAULT NULL, `visible` tinyint(1) <constraint_enforce_replace> DEFAULT '1', `moderator_posts_count` int(11) <constraint_enforce_replace> DEFAULT '0', `closed` tinyint(1) <constraint_enforce_replace> DEFAULT '0', `archived` tinyint(1) <constraint_enforce_replace> DEFAULT '0', `bumped_at` datetime <constraint_type_parameter>, `has_summary` tinyint(1) <constraint_enforce_replace> DEFAULT '0', `archetype` varchar(255) COLLATE utf8mb4_unicode_ci <constraint_enforce_replace> DEFAULT 'regular', `featured_user4_id` int(11) DEFAULT NULL, `notify_moderators_count` int(11) <constraint_enforce_replace> DEFAULT '0', `spam_count` int(11) <constraint_enforce_replace> DEFAULT '0', `pinned_at` datetime DEFAULT NULL, `score` float DEFAULT NULL, `percent_rank` float <constraint_enforce_replace> DEFAULT '1', `subtype` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `slug` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `deleted_by_id` int(11) DEFAULT NULL, `participant_count` int(11) <constraint_enforce_replace> DEFAULT '1', `word_count` int(11) DEFAULT NULL, `excerpt` varchar(1000) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `pinned_globally` tinyint(1) <constraint_enforce_replace> DEFAULT '0', `pinned_until` datetime DEFAULT NULL, `fancy_title` varchar(400) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `highest_staff_post_number` int(11) <constraint_enforce_replace> DEFAULT '0', `featured_link` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL, `reviewable_score` float <constraint_enforce_replace> DEFAULT '0', PRIMARY KEY (`id`), KEY `index_topics_on_bumped_at` (`bumped_at`), KEY `index_topics_on_created_at_and_visible` (`created_at`,`visible`), KEY `index_topics_on_id_and_deleted_at` (`id`,`deleted_at`), KEY `index_topics_on_pinned_at` (`pinned_at`), KEY `index_topics_on_pinned_globally` (`pinned_globally`), KEY `index_topics_on_updated_at_public` (`updated_at`,`visible`,`highest_staff_post_number`,`highest_post_number`,`category_id`,`created_at`,`id`), KEY `idx_topics_user_id_deleted_at` (`user_id`), KEY `idx_topics_front_page_2` (`deleted_at`,`visible`,`archetype`,`category_id`,`id`), KEY `idxtopicslug2` (`slug`)); CREATE TABLE `topic_tags` ( `id` bigint(20) <constraint_type_parameter> AUTO_INCREMENT, `topic_id` int(11) <constraint_enforce_replace>, `tag_id` int(11) <constraint_enforce_replace>, `created_at` datetime <constraint_type_parameter>, `updated_at` datetime <constraint_type_parameter>, PRIMARY KEY (`id`), UNIQUE KEY `index_topic_tags_on_topic_id_and_tag_id` (`topic_id`,`tag_id`)); CREATE TABLE `tags` ( `id` bigint(20) <constraint_type_parameter> AUTO_INCREMENT, `name` varchar(255) COLLATE utf8mb4_unicode_ci <constraint_enforce_replace>, `topic_count` int(11) <constraint_enforce_replace> DEFAULT '0', `created_at` datetime <constraint_type_parameter>, `updated_at` datetime <constraint_type_parameter>, `pm_topic_count` int(11) <constraint_enforce_replace> DEFAULT '0', `lower_tag_name` varchar(255) COLLATE utf8mb4_unicode_ci GENERATED ALWAYS AS (lower(`name`)) STORED, PRIMARY KEY (`id`), UNIQUE KEY `index_tags_on_name` (`name`), UNIQUE KEY `index_tags_on_lower_name` (`lower_tag_name`)); UPDATE tags t INNER JOIN (SELECT COUNT(topics.id) AS topic_count, tags.id AS tag_id FROM tags LEFT JOIN topic_tags ON tags.id = topic_tags.tag_id LEFT JOIN topics ON topics.id = topic_tags.topic_id AND topics.deleted_at IS NULL AND topics.archetype <comparison_operator_replace> 'private_message' GROUP BY tags.id) x ON x.tag_id = t.id AND x.topic_count <comparison_operator_replace> t.topic_count SET t.topic_count = x.topic_count;",
    "applied_rules": [
        "<constraint_type_parameter>",
        "<constraint_enforce_replace>",
        "<comparison_operator_replace>"
    ],
    "Affected Elements": "INNER JOIN, COUNT, GROUP BY",
    "Root Cause Analysis": "The update query fails due to an index out of range error, likely caused by mishandling of the join operation with generated columns in TiDB."
}