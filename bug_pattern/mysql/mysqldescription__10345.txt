{
    "pattern": "CREATE DATABASE IF NOT EXISTS <database_name_parameter>; USE <database_name_parameter>; DELIMITER // CREATE PROCEDURE <procedure_name_parameter>() BEGIN CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); CREATE TABLE IF NOT EXISTS <table_name_parameter> ( <column_definitions_parameter> ); END// DELIMITER ; DELIMITER // CREATE PROCEDURE <procedure_name_parameter>() BEGIN SELECT COUNT(*) INTO @<variable_name_parameter> FROM information_schema.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = <schema_name_parameter> AND TABLE_NAME = <table_name_parameter> AND CONSTRAINT_NAME = <constraint_name_parameter>; IF @<variable_name_parameter> = 0 THEN ALTER TABLE <table_name_parameter> ADD CONSTRAINT <constraint_name_parameter> FOREIGN KEY (<foreign_key_column_parameter>) REFERENCES <referenced_table_name_parameter>(<referenced_column_name_parameter>) ON DELETE <referential_action_parameter> ON UPDATE <referential_action_parameter>; END IF; SELECT COUNT(*) INTO @<variable_name_parameter> FROM information_schema.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = <schema_name_parameter> AND TABLE_NAME = <table_name_parameter> AND CONSTRAINT_NAME = <constraint_name_parameter>; IF @<variable_name_parameter> = 0 THEN ALTER TABLE <table_name_parameter> ADD CONSTRAINT <constraint_name_parameter> FOREIGN KEY (<foreign_key_column_parameter>) REFERENCES <referenced_table_name_parameter>(<referenced_column_name_parameter>) ON DELETE <referential_action_parameter> ON UPDATE <referential_action_parameter>; END IF; SELECT COUNT(*) INTO @<variable_name_parameter> FROM information_schema.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = <schema_name_parameter> AND TABLE_NAME = <table_name_parameter> AND CONSTRAINT_NAME = <constraint_name_parameter>; IF @<variable_name_parameter> = 0 THEN ALTER TABLE <table_name_parameter> ADD CONSTRAINT <constraint_name_parameter> FOREIGN KEY (<foreign_key_column_parameter>) REFERENCES <referenced_table_name_parameter>(<referenced_column_name_parameter>) ON DELETE <referential_action_parameter> ON UPDATE <referential_action_parameter>; END IF; SELECT COUNT(*) INTO @<variable_name_parameter> FROM information_schema.TABLE_CONSTRAINTS WHERE TABLE_SCHEMA = <schema_name_parameter> AND TABLE_NAME = <table_name_parameter> AND CONSTRAINT_NAME = <constraint_name_parameter>; IF @<variable_name_parameter> = 0 THEN ALTER TABLE <table_name_parameter> ADD CONSTRAINT <constraint_name_parameter> FOREIGN KEY (<foreign_key_column_parameter>) REFERENCES <referenced_table_name_parameter>(<referenced_column_name_parameter>) ON DELETE <referential_action_parameter> ON UPDATE <referential_action_parameter>; END IF; END// DELIMITER ; SELECT <column_names_parameter> FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE CONSTRAINT_SCHEMA = <schema_name_parameter> AND REFERENCED_TABLE_NAME IS NOT NULL;",
    "applied_rules": [
        "<database_name_parameter>",
        "<procedure_name_parameter>",
        "<table_name_parameter>",
        "<column_definitions_parameter>",
        "<variable_name_parameter>",
        "<schema_name_parameter>",
        "<constraint_name_parameter>",
        "<foreign_key_column_parameter>",
        "<referenced_table_name_parameter>",
        "<referenced_column_name_parameter>",
        "<referential_action_parameter>",
        "<column_names_parameter>"
    ],
    "Affected Elements": "ALTER TABLE, FOREIGN KEY, REFERENCES",
    "Root Cause Analysis": "MySQL does not properly manage user-defined foreign key constraints, allowing automatic naming of constraints which leads to conflicts and loss of control over database integrity."
}