ID: 11767
Title: After importing data using lightning, TiDB fails to connect PD
Description:
1、使用lightning导入数据后，tidb无法链接pd
<pre>
[2019/08/19 09:32:58.465 +08:00] [INFO] [region_cache.go:827] ["region epoch is ahead of tikv"] [error="region epoch is ahead of tikv. rpc ctx: region ID: 1332486, meta: id:1332486 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\350_r\\200\\000\\000\\000\\010;\\211=\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\350_r\\200\\000\\000\\000\\010G\\361o\" region_epoch:<conf_ver:11 version:5715 > peers:<id:1332487 store_id:1 > peers:<id:1332488 store_id:6 > peers:<id:1332489 store_id:801041 > , peer: id:1332489 store_id:801041 , addr: 10.218.110.59:20160, idx: 2, currentRegions: [id:1332486 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377;\\211=\\000\\000\\000\\000\\000\\372\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377A^\\231\\000\\000\\000\\000\\000\\372\" region_epoch:<conf_ver:11 version:5713 > peers:<id:1332487 store_id:1 > peers:<id:1332488 store_id:6 > peers:<id:1332489 store_id:801041 >  id:1327216 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\3774\\351\\357\\000\\000\\000\\000\\000\\372\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377;\\211=\\000\\000\\000\\000\\000\\372\" region_epoch:<conf_ver:14 version:5712 > peers:<id:1327219 store_id:801042 > peers:<id:1327257 store_id:4 > peers:<id:1327256 store_id:801041 > ]"] [errorVerbose="region epoch is ahead of tikv. rpc ctx: region ID: 1332486, meta: id:1332486 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\350_r\\200\\000\\000\\000\\010;\\211=\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\350_r\\200\\000\\000\\000\\010G\\361o\" region_epoch:<conf_ver:11 version:5715 > peers:<id:1332487 store_id:1 > peers:<id:1332488 store_id:6 > peers:<id:1332489 store_id:801041 > , peer: id:1332489 store_id:801041 , addr: 10.218.110.59:20160, idx: 2, currentRegions: [id:1332486 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377;\\211=\\000\\000\\000\\000\\000\\372\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377A^\\231\\000\\000\\000\\000\\000\\372\" region_epoch:<conf_ver:11 version:5713 > peers:<id:1332487 store_id:1 > peers:<id:1332488 store_id:6 > peers:<id:1332489 store_id:801041 >  id:1327216 start_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\3774\\351\\357\\000\\000\\000\\000\\000\\372\" end_key:\"t\\200\\000\\000\\000\\000\\000\\n\\377\\350_r\\200\\000\\000\\000\\010\\377;\\211=\\000\\000\\000\\000\\000\\372\" region_epoch:<conf_ver:14 version:5712 > peers:<id:1327219 store_id:801042 > peers:<id:1327257 store_id:4 > peers:<id:1327256 store_id:801041 > ]\ngithub.com/pingcap/tidb/store/tikv.(*RegionCache).OnRegionEpochNotMatch\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_cache.go:826\ngithub.com/pingcap/tidb/store/tikv.(*RegionRequestSender).onRegionError\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:252\ngithub.com/pingcap/tidb/store/tikv.(*RegionRequestSender).SendReqCtx\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:128\ngithub.com/pingcap/tidb/store/tikv.(*RegionRequestSender).SendReq\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:72\ngithub.com/pingcap/tidb/store/tikv.(*tikvStore).SendReq\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/kv.go:374\ngithub.com/pingcap/tidb/store/tikv/gcworker.(*GCWorker).resolveLocksForRange\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/gcworker/gc_worker.go:833\ngithub.com/pingcap/tidb/store/tikv/gcworker.(*GCWorker).resolveLocks.func1\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/gcworker/gc_worker.go:786\ngithub.com/pingcap/tidb/store/tikv.(*rangeTaskWorker).run\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/range_task.go:279\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1337"]
</pre>

["Release Version"=v4.0.0-alpha-74-gdb6c36c75] ["Git Commit Hash"=db6c36c75f64d2f6d92f6ef5b810b96ce6a42f09] ["Git Branch"=master]


2、重启tidb，报错无法启动
<pre>
[2019/08/19 09:30:58.085 +08:00] [INFO] [systime_mon.go:25] ["start system time monitor"]
[2019/08/19 09:30:58.087 +08:00] [INFO] [client.go:256] ["[pd] switch leader"] [new-leader=http://10.218.60.210:2379] [old-leader=]
[2019/08/19 09:30:58.087 +08:00] [INFO] [client.go:167] ["[pd] init cluster id"] [cluster-id=6711871066048424412]
[2019/08/19 09:30:58.107 +08:00] [INFO] [store.go:74] ["new store with retry success"]
[2019/08/19 09:31:54.939 +08:00] [WARN] [backoff.go:326] ["pdRPC backoffer.maxSleep 20000ms is exceeded, errors:\nloadRegion from PD failed, key: \"mBootstra\\xffpKey\\x00\\x00\\x00\\x00\\xfb\\x00\\x00\\x00\\x00\\x00\\x00\\x00s\", err: rpc error: code = DeadlineExceeded desc = context deadline exceeded at 2019-08-19T09:31:45.371274478+08:00\nloadRegion from PD failed, key: \"mBootstra\\xffpKey\\x00\\x00\\x00\\x00\\xfb\\x00\\x00\\x00\\x00\\x00\\x00\\x00s\", err: rpc error: code = DeadlineExceeded desc = context deadline exceeded at 2019-08-19T09:31:49.875650747+08:00\nloadRegion from PD failed, key: \"mBootstra\\xffpKey\\x00\\x00\\x00\\x00\\xfb\\x00\\x00\\x00\\x00\\x00\\x00\\x00s\", err: rpc error: code = DeadlineExceeded desc = context deadline exceeded at 2019-08-19T09:31:54.939015454+08:00"]
[2019/08/19 09:31:54.939 +08:00] [FATAL] [session.go:1672] ["check bootstrapped failed"] [error="[tikv:9001]PD server timeout"] [errorVerbose="[tikv:9001]PD server timeout\ngithub.com/pingcap/errors.AddStack\n\t/home/jenkins/workspace/build_tidb_master/go/pkg/mod/github.com/pingcap/errors@v0.11.4/errors.go:174\ngithub.com/pingcap/errors.Trace\n\t/home/jenkins/workspace/build_tidb_master/go/pkg/mod/github.com/pingcap/errors@v0.11.4/juju_adaptor.go:15\ngithub.com/pingcap/tidb/store/tikv.(*RegionCache).loadRegion\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_cache.go:626\ngithub.com/pingcap/tidb/store/tikv.(*RegionCache).findRegionByKey\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_cache.go:358\ngithub.com/pingcap/tidb/store/tikv.(*RegionCache).LocateKey\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/region_cache.go:318\ngithub.com/pingcap/tidb/store/tikv.(*tikvSnapshot).get\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/snapshot.go:244\ngithub.com/pingcap/tidb/store/tikv.(*tikvSnapshot).Get\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/snapshot.go:222\ngithub.com/pingcap/tidb/kv.(*unionStore).Get\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/kv/union_store.go:194\ngithub.com/pingcap/tidb/store/tikv.(*tikvTxn).Get\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/store/tikv/txn.go:149\ngithub.com/pingcap/tidb/structure.(*TxStructure).Get\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/structure/string.go:36\ngithub.com/pingcap/tidb/structure.(*TxStructure).GetInt64\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/structure/string.go:45\ngithub.com/pingcap/tidb/meta.(*Meta).GetBootstrapVersion\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/meta/meta.go:708\ngithub.com/pingcap/tidb/session.getStoreBootstrapVersion.func1\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/session/session.go:1667\ngithub.com/pingcap/tidb/kv.RunInNewTxn\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/kv/txn.go:47\ngithub.com/pingcap/tidb/session.getStoreBootstrapVersion\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/session/session.go:1664\ngithub.com/pingcap/tidb/session.BootstrapSession\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/session/session.go:1503\nmain.createStoreAndDomain\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/tidb-server/main.go:234\nmain.main\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/tidb-server/main.go:176\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:200\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1337"] [stack="github.com/pingcap/tidb/session.getStoreBootstrapVersion\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/session/session.go:1672\ngithub.com/pingcap/tidb/session.BootstrapSession\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/session/session.go:1503\nmain.createStoreAndDomain\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/tidb-server/main.go:234\nmain.main\n\t/home/jenkins/workspace/build_tidb_master/go/src/github.com/pingcap/tidb/tidb-server/main.go:176\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:200"]
</pre>