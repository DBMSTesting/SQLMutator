ID: 30399
Title: wrong plan for Q5 in TPCH workload and timeout
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

<!-- a step by step guide for reproducing the bug. -->
1. import 50G tpch dataset
2. gather statstistics
3. explain q5 and wait 120 seconds to wait for stats ready

### 2. What did you expect to see? (Required)
q5 completes in ~40s, and using below plan, the plan in v5.3.0
```
+-------------------------------------------+--------------+-----------+-----------+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------+---------+
| ID                                        | ESTROWS      | ACTROWS   | TASK      | ACCESS OBJECT  | EXECUTION INFO                                                                                                                                                                                                                                                                                                                                                                                    | OPERATOR INFO                                                                                                                                                                   | MEMORY     | DISK    |
+-------------------------------------------+--------------+-----------+-----------+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------+---------+
| Sort_24                                   | 5.00         | 5         | root      |                | time:46.1s, loops:2                                                                                                                                                                                                                                                                                                                                                                               | Column#49:desc                                                                                                                                                                  | 10.0 KB    | 0 Bytes |
| └─Projection_26                           | 5.00         | 5         | root      |                | time:46.1s, loops:6, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                                              | tpch50.nation.n_name, Column#49                                                                                                                                                 | 2.01 KB    | N/A     |
|   └─HashAgg_27                            | 5.00         | 5         | root      |                | time:46.1s, loops:6, partial_worker:{wall_time:46.12762528s, concurrency:16, task_num:367, tot_wait:12m17.946716809s, tot_exec:91.915578ms, tot_time:12m18.038935266s, max:46.127575805s, p95:46.127575805s}, final_worker:{wall_time:46.127668722s, concurrency:16, task_num:80, tot_wait:12m18.041858256s, tot_exec:276.755µs, tot_time:12m18.042159974s, max:46.127653495s, p95:46.127653495s} | group by:Column#52, funcs:sum(Column#50)->Column#49, funcs:firstrow(Column#51)->tpch50.nation.n_name                                                                            | 3.13 MB    | N/A     |
|     └─Projection_85                       | 11301411.67  | 364651    | root      |                | time:46.1s, loops:368, Concurrency:16                                                                                                                                                                                                                                                                                                                                                             | mul(tpch50.lineitem.l_extendedprice, minus(1, tpch50.lineitem.l_discount))->Column#50, tpch50.nation.n_name, tpch50.nation.n_name                                               | 2.95 MB    | N/A     |
|       └─Projection_28                     | 11301411.67  | 364651    | root      |                | time:46.1s, loops:368, Concurrency:16                                                                                                                                                                                                                                                                                                                                                             | tpch50.lineitem.l_extendedprice, tpch50.lineitem.l_discount, tpch50.nation.n_name                                                                                               | 3.05 MB    | N/A     |
|         └─HashJoin_37                     | 11301411.67  | 364651    | root      |                | time:46.1s, loops:368, build_hash_table:{total:3.29s, fetch:36ms, build:3.25s}, probe:{concurrency:16, total:12m18s, max:46.1s, probe:5.09s, fetch:12m12.9s}                                                                                                                                                                                                                                      | inner join, equal:[eq(tpch50.supplier.s_nationkey, tpch50.customer.c_nationkey) eq(tpch50.orders.o_custkey, tpch50.customer.c_custkey)]                                         | 117.8 MB   | 0 Bytes |
|           ├─TableReader_83(Build)         | 7500000.00   | 7500000   | root      |                | time:28.5ms, loops:7328, cop_task: {num: 17, max: 1.48s, min: 588.8µs, avg: 616.2ms, p95: 1.48s, max_proc_keys: 448521, p95_proc_keys: 448521, tot_proc: 6.54s, tot_wait: 1ms, rpc_num: 17, rpc_time: 10.5s, copr_cache_hit_ratio: 0.24}                                                                                                                                                          | data:TableFullScan_82                                                                                                                                                           | 73.5 MB    | N/A     |
|           │ └─TableFullScan_82            | 7500000.00   | 7500000   | cop[tikv] | table:customer | tikv_task:{proc max:593ms, min:296ms, p80:527ms, p95:593ms, iters:7399, tasks:17}, scan_detail: {total_process_keys: 5706070, total_process_keys_size: 1161105200, total_keys: 5706083, rocksdb: {delete_skipped_count: 0, key_skipped_count: 5706070, block: {cache_hit_count: 0, read_count: 18960, read_byte: 424.7 MB}}}                                                                      | keep order:false                                                                                                                                                                | N/A        | N/A     |
|           └─IndexJoin_46(Probe)           | 11301411.67  | 9115151   | root      |                | time:43.3s, loops:8903, inner:{total:7m6.5s, concurrency:16, task:2354, construct:56.5s, fetch:6m8.1s, build:1.94s}, probe:17s                                                                                                                                                                                                                                                                    | inner join, inner:TableReader_42, outer key:tpch50.lineitem.l_orderkey, inner key:tpch50.orders.o_orderkey, equal cond:eq(tpch50.lineitem.l_orderkey, tpch50.orders.o_orderkey) | 7.53 GB    | N/A     |
|             ├─HashJoin_54(Build)          | 60166741.07  | 60064410  | root      |                | time:9.18s, loops:58669, build_hash_table:{total:34.3ms, fetch:9.79ms, build:24.5ms}, probe:{concurrency:16, total:12m15.8s, max:46s, probe:11m4.5s, fetch:1m11.3s}                                                                                                                                                                                                                               | inner join, equal:[eq(tpch50.supplier.s_suppkey, tpch50.lineitem.l_suppkey)]                                                                                                    | 3.55 MB    | 0 Bytes |
|             │ ├─HashJoin_56(Build)        | 100000.00    | 100102    | root      |                | time:9.83ms, loops:111, build_hash_table:{total:890.8µs, fetch:886.8µs, build:3.96µs}, probe:{concurrency:16, total:508.7ms, max:32.9ms, probe:380.2ms, fetch:128.4ms}                                                                                                                                                                                                                            | inner join, equal:[eq(tpch50.nation.n_nationkey, tpch50.supplier.s_nationkey)]                                                                                                  | 1000 Bytes | 0 Bytes |
|             │ │ ├─HashJoin_69(Build)      | 5.00         | 5         | root      |                | time:863.4µs, loops:2, build_hash_table:{total:698.1µs, fetch:694.2µs, build:3.88µs}, probe:{concurrency:16, total:11.6ms, max:738.7µs, probe:25.8µs, fetch:11.6ms}                                                                                                                                                                                                                               | inner join, equal:[eq(tpch50.region.r_regionkey, tpch50.nation.n_regionkey)]                                                                                                    | 24.5 KB    | 0 Bytes |
|             │ │ │ ├─TableReader_74(Build) | 1.00         | 1         | root      |                | time:665.9µs, loops:2, cop_task: {num: 1, max: 2.06ms, proc_keys: 5, tot_proc: 1ms, tot_wait: 1ms, rpc_num: 1, rpc_time: 2.05ms, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                      | data:Selection_73                                                                                                                                                               | 262 Bytes  | N/A     |
|             │ │ │ │ └─Selection_73        | 1.00         | 1         | cop[tikv] |                | tikv_task:{time:1ms, loops:1}, scan_detail: {total_process_keys: 5, total_process_keys_size: 559, total_keys: 6, rocksdb: {delete_skipped_count: 0, key_skipped_count: 5, block: {cache_hit_count: 0, read_count: 2, read_byte: 448 Bytes}}}                                                                                                                                                      | eq(tpch50.region.r_name, "MIDDLE EAST")                                                                                                                                         | N/A        | N/A     |
|             │ │ │ │   └─TableFullScan_72  | 5.00         | 5         | cop[tikv] | table:region   | tikv_task:{time:0s, loops:1}                                                                                                                                                                                                                                                                                                                                                                      | keep order:false                                                                                                                                                                | N/A        | N/A     |
|             │ │ │ └─TableReader_71(Probe) | 25.00        | 25        | root      |                | time:37.3µs, loops:2, cop_task: {num: 1, max: 1.24ms, proc_keys: 25, rpc_num: 1, rpc_time: 1.2ms, copr_cache_hit_ratio: 0.00}                                                                                                                                                                                                                                                                     | data:TableFullScan_70                                                                                                                                                           | 1009 Bytes | N/A     |
|             │ │ │   └─TableFullScan_70    | 25.00        | 25        | cop[tikv] | table:nation   | tikv_task:{time:0s, loops:1}, scan_detail: {total_process_keys: 25, total_process_keys_size: 3109, total_keys: 26, rocksdb: {delete_skipped_count: 0, key_skipped_count: 25, block: {cache_hit_count: 0, read_count: 2, read_byte: 1.38 KB}}}                                                                                                                                                     | keep order:false                                                                                                                                                                | N/A        | N/A     |
|             │ │ └─TableReader_76(Probe)   | 500000.00    | 500000    | root      |                | time:8.5ms, loops:490, cop_task: {num: 1, max: 1.02ms, proc_keys: 0, rpc_num: 1, rpc_time: 1.01ms, copr_cache_hit_ratio: 1.00}                                                                                                                                                                                                                                                                    | data:TableFullScan_75                                                                                                                                                           | 7.64 MB    | N/A     |
|             │ │   └─TableFullScan_75      | 500000.00    | 500000    | cop[tikv] | table:supplier | tikv_task:{time:573ms, loops:493}                                                                                                                                                                                                                                                                                                                                                                 | keep order:false                                                                                                                                                                | N/A        | N/A     |
|             │ └─TableReader_78(Probe)     | 300005811.00 | 300005811 | root      |                | time:5.33s, loops:293268, cop_task: {num: 655, max: 1.47s, min: 445.8ms, avg: 704.4ms, p95: 974ms, max_proc_keys: 465701, p95_proc_keys: 458353, tot_proc: 4m59.8s, tot_wait: 2.44s, rpc_num: 655, rpc_time: 7m41.4s, copr_cache_hit_ratio: 0.00}                                                                                                                                                 | data:TableFullScan_77                                                                                                                                                           | 629.6 MB   | N/A     |
|             └─TableReader_42(Probe)       | 0.15         | 6249310   | root      |                | time:5m47.7s, loops:9399, cop_task: {num: 3193, max: 933.6ms, min: 654.8µs, avg: 118ms, p95: 331.1ms, max_proc_keys: 17731, p95_proc_keys: 17633, tot_proc: 3m42.6s, tot_wait: 10.5s, rpc_num: 3193, rpc_time: 6m16.7s, copr_cache_hit_ratio: 0.00}                                                                                                                                               | data:Selection_41                                                                                                                                                               | N/A        | N/A     |
|               └─Selection_41              | 0.15         | 6249310   | cop[tikv] |                | tikv_task:{proc max:181ms, min:0s, p80:95ms, p95:107ms, iters:54857, tasks:3193}, scan_detail: {total_process_keys: 41180041, total_process_keys_size: 6254842293, total_keys: 51647834, rocksdb: {delete_skipped_count: 0, key_skipped_count: 30193530, block: {cache_hit_count: 32186357, read_count: 93573, read_byte: 1.64 GB}}}                                                              | ge(tpch50.orders.o_orderdate, 1994-01-01 00:00:00.000000), lt(tpch50.orders.o_orderdate, 1995-01-01)                                                                            | N/A        | N/A     |
|                 └─TableRangeScan_40       | 1.00         | 41180041  | cop[tikv] | table:orders   | tikv_task:{proc max:180ms, min:0s, p80:94ms, p95:106ms, iters:54857, tasks:3193}                                                                                                                                                                                                                                                                                                                  | range: decided by [tpch50.lineitem.l_orderkey], keep order:false                                                                                                                | N/A        | N/A     |
+-------------------------------------------+--------------+-----------+-----------+----------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+------------+---------+

```

### 3. What did you see instead (Required)
wrong join method on lineitem, IndexHashJoin is used, rather then HashJoin, causing the plan never return
```
+-------------------------------------------+-------------+-----------+---------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| id                                        | estRows     | task      | access object                                           | operator info                                                                                                                                                                                                                 |
+-------------------------------------------+-------------+-----------+---------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
| Sort_24                                   | 1.00        | root      |                                                         | Column#49:desc                                                                                                                                                                                                                |
| ??Projection_26                           | 1.00        | root      |                                                         | test.nation.n_name, Column#49                                                                                                                                                                                                 |
|   ??HashAgg_27                            | 1.00        | root      |                                                         | group by:Column#57, funcs:sum(Column#55)->Column#49, funcs:firstrow(Column#56)->test.nation.n_name                                                                                                                            |
|     ??Projection_76                       | 70836835.40 | root      |                                                         | mul(test.lineitem.l_extendedprice, minus(1, test.lineitem.l_discount))->Column#55, test.nation.n_name, test.nation.n_name                                                                                                     |
|       ??Projection_28                     | 70836835.40 | root      |                                                         | test.lineitem.l_extendedprice, test.lineitem.l_discount, test.nation.n_name                                                                                                                                                   |
|         ??IndexHashJoin_34                | 70836835.40 | root      |                                                         | inner join, inner:IndexLookUp_31, outer key:test.orders.o_orderkey, inner key:test.lineitem.l_orderkey, equal cond:eq(test.orders.o_orderkey, test.lineitem.l_orderkey), eq(test.supplier.s_suppkey, test.lineitem.l_suppkey) |
|           ??HashJoin_42(Build)            | 56669468.32 | root      |                                                         | inner join, equal:[eq(test.customer.c_custkey, test.orders.o_custkey)]                                                                                                                                                        |
|           ? ??TableReader_72(Build)       | 11333939.00 | root      |                                                         | data:Selection_71                                                                                                                                                                                                             |
|           ? ? ??Selection_71              | 11333939.00 | cop[tikv] |                                                         | ge(test.orders.o_orderdate, 1994-01-01 00:00:00.000000), lt(test.orders.o_orderdate, 1995-01-01)                                                                                                                              |
|           ? ?   ??TableFullScan_70        | 75000000.00 | cop[tikv] | table:orders                                            | keep order:false                                                                                                                                                                                                              |
|           ? ??HashJoin_45(Probe)          | 37499850.00 | root      |                                                         | inner join, equal:[eq(test.supplier.s_nationkey, test.customer.c_nationkey)]                                                                                                                                                  |
|           ?   ??HashJoin_47(Build)        | 125.00      | root      |                                                         | inner join, equal:[eq(test.nation.n_nationkey, test.supplier.s_nationkey)]                                                                                                                                                    |
|           ?   ? ??HashJoin_60(Build)      | 0.01        | root      |                                                         | inner join, equal:[eq(test.region.r_regionkey, test.nation.n_regionkey)]                                                                                                                                                      |
|           ?   ? ? ??TableReader_65(Build) | 0.01        | root      |                                                         | data:Selection_64                                                                                                                                                                                                             |
|           ?   ? ? ? ??Selection_64        | 0.01        | cop[tikv] |                                                         | eq(test.region.r_name, "MIDDLE EAST")                                                                                                                                                                                         |
|           ?   ? ? ?   ??TableFullScan_63  | 5.00        | cop[tikv] | table:region                                            | keep order:false                                                                                                                                                                                                              |
|           ?   ? ? ??TableReader_62(Probe) | 25.00       | root      |                                                         | data:TableFullScan_61                                                                                                                                                                                                         |
|           ?   ? ?   ??TableFullScan_61    | 25.00       | cop[tikv] | table:nation                                            | keep order:false                                                                                                                                                                                                              |
|           ?   ? ??TableReader_67(Probe)   | 500000.00   | root      |                                                         | data:TableFullScan_66                                                                                                                                                                                                         |
|           ?   ?   ??TableFullScan_66      | 500000.00   | cop[tikv] | table:supplier                                          | keep order:false                                                                                                                                                                                                              |
|           ?   ??TableReader_69(Probe)     | 7500000.00  | root      |                                                         | data:TableFullScan_68                                                                                                                                                                                                         |
|           ?     ??TableFullScan_68        | 7500000.00  | cop[tikv] | table:customer                                          | keep order:false                                                                                                                                                                                                              |
|           ??IndexLookUp_31(Probe)         | 1.25        | root      |                                                         |                                                                                                                                                                                                                               |
|             ??IndexRangeScan_29(Build)    | 1.25        | cop[tikv] | table:lineitem, index:PRIMARY(L_ORDERKEY, L_LINENUMBER) | range: decided by [eq(test.lineitem.l_orderkey, test.orders.o_orderkey)], keep order:false                                                                                                                                    |
|             ??TableRowIDScan_30(Probe)    | 1.25        | cop[tikv] | table:lineitem                                          | keep order:false                                                                                                                                                                                                              |
+-------------------------------------------+-------------+-----------+---------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
25 rows in set (0.005 sec)
```

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

```
Release Version: v5.4.0-alpha-278-ga04601477
Edition: Community
Git Commit Hash: a04601477600b6804d7a4a2bd31a923bed7817c7
Git Branch: master
UTC Build Time: 2021-12-01 03:36:18
GoVersion: go1.16.4
Race Enabled: false
TiKV Min Version: v3.0.0-60965b006877ca7234adaced7890d7b029ed1306
Check Table Before Drop: false```
