ID: 45005
Title: import into 10T data to tidb cluster fail for "batch split regions failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing: dial tcp 10.200.1.124:20160: connect: connection refused"; "
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

IMPORT INTO big.items  FROM "s3://tmp/9T-csv/*.csv?access-key=minioadmin&secret-access-key=minioadmin&endpoint=http%3a%2f%2f10.2.12.100%3a32762&force-path-style=true" with thread=16,detached;


### 2. What did you expect to see? (Required)
import successfully
### 3. What did you see instead (Required)
```
|  30001 | s3://tmp/9T-csv/*.csv?access-key=xxxxxx&endpoint=http%3A%2F%2Fminio-peer.import-into-20t-tps-1809273-1-798.svc%3A9000&force-path-style=true&secret-access-key=xxxxxx | `big`.`items` |      106 | importing | failed | 9.672TB          |          NULL | batch split regions failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing: dial tcp 10.200.1.124:20160: connect: connection refused"; batch split regions failed: split region failed: err=message:"peer is not leader for region 7385837, leader may None" not_leader:<region_id:7385837 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7385837, leader may None" not_leader:<region_id:7385837 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7385837, leader may None" not_leader:<region_id:7385837 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7385837, leader may None" not_leader:<region_id:7385837 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 26091165, leader may None" not_leader:<region_id:26091165 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26091165, leader may None" not_leader:<region_id:26091165 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26091165, leader may None" not_leader:<region_id:26091165 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26091165, leader may None" not_leader:<region_id:26091165 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 8631730, leader may None" not_leader:<region_id:8631730 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8631730, leader may None" not_leader:<region_id:8631730 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8631730, leader may None" not_leader:<region_id:8631730 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8631730, leader may None" not_leader:<region_id:8631730 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 23263701, leader may None" not_leader:<region_id:23263701 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23263701, leader may None" not_leader:<region_id:23263701 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23263701, leader may None" not_leader:<region_id:23263701 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23263701, leader may None" not_leader:<region_id:23263701 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 15756359, leader may None" not_leader:<region_id:15756359 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15756359, leader may None" not_leader:<region_id:15756359 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15756359, leader may None" not_leader:<region_id:15756359 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15756359, leader may None" not_leader:<region_id:15756359 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 7041685, leader may None" not_leader:<region_id:7041685 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7041685, leader may None" not_leader:<region_id:7041685 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7041685, leader may None" not_leader:<region_id:7041685 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7041685, leader may None" not_leader:<region_id:7041685 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 21921802, leader may None" not_leader:<region_id:21921802 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 21921802, leader may None" not_leader:<region_id:21921802 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 21921802, leader may None" not_leader:<region_id:21921802 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 21921802, leader may None" not_leader:<region_id:21921802 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 9145383, leader may None" not_leader:<region_id:9145383 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9145383, leader may None" not_leader:<region_id:9145383 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9145383, leader may None" not_leader:<region_id:9145383 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9145383, leader may None" not_leader:<region_id:9145383 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: rpc error: code = Unavailable desc = connection error: desc = "transport: Error while dialing: dial tcp 10.200.1.124:20160: connect: connection refused"; batch split regions failed: split region failed: err=message:"peer is not leader for region 26793855, leader may None" not_leader:<region_id:26793855 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26793855, leader may None" not_leader:<region_id:26793855 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26793855, leader may None" not_leader:<region_id:26793855 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26793855, leader may None" not_leader:<region_id:26793855 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 25839172, leader may None" not_leader:<region_id:25839172 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25839172, leader may None" not_leader:<region_id:25839172 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25839172, leader may None" not_leader:<region_id:25839172 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25839172, leader may None" not_leader:<region_id:25839172 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 7753871, leader may None" not_leader:<region_id:7753871 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7753871, leader may None" not_leader:<region_id:7753871 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7753871, leader may None" not_leader:<region_id:7753871 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7753871, leader may None" not_leader:<region_id:7753871 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 6976713, leader may None" not_leader:<region_id:6976713 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6976713, leader may None" not_leader:<region_id:6976713 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6976713, leader may None" not_leader:<region_id:6976713 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6976713, leader may None" not_leader:<region_id:6976713 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 23647631, leader may None" not_leader:<region_id:23647631 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23647631, leader may None" not_leader:<region_id:23647631 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23647631, leader may None" not_leader:<region_id:23647631 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23647631, leader may None" not_leader:<region_id:23647631 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 15744719, leader may None" not_leader:<region_id:15744719 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15744719, leader may None" not_leader:<region_id:15744719 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15744719, leader may None" not_leader:<region_id:15744719 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 15744719, leader may None" not_leader:<region_id:15744719 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 26164613, leader may None" not_leader:<region_id:26164613 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26164613, leader may None" not_leader:<region_id:26164613 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26164613, leader may None" not_leader:<region_id:26164613 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 26164613, leader may None" not_leader:<region_id:26164613 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 8051303, leader may None" not_leader:<region_id:8051303 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8051303, leader may None" not_leader:<region_id:8051303 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8051303, leader may None" not_leader:<region_id:8051303 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8051303, leader may None" not_leader:<region_id:8051303 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 8585656, leader may None" not_leader:<region_id:8585656 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8585656, leader may None" not_leader:<region_id:8585656 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8585656, leader may None" not_leader:<region_id:8585656 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8585656, leader may None" not_leader:<region_id:8585656 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 6844796, leader may None" not_leader:<region_id:6844796 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844796, leader may None" not_leader:<region_id:6844796 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844796, leader may None" not_leader:<region_id:6844796 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844796, leader may None" not_leader:<region_id:6844796 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 27176913, leader may None" not_leader:<region_id:27176913 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27176913, leader may None" not_leader:<region_id:27176913 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27176913, leader may None" not_leader:<region_id:27176913 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27176913, leader may None" not_leader:<region_id:27176913 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 7723723, leader may None" not_leader:<region_id:7723723 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7723723, leader may None" not_leader:<region_id:7723723 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7723723, leader may None" not_leader:<region_id:7723723 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7723723, leader may None" not_leader:<region_id:7723723 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 7060987, leader may None" not_leader:<region_id:7060987 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7060987, leader may None" not_leader:<region_id:7060987 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7060987, leader may None" not_leader:<region_id:7060987 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7060987, leader may None" not_leader:<region_id:7060987 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 7764049, leader may None" not_leader:<region_id:7764049 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7764049, leader may None" not_leader:<region_id:7764049 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7764049, leader may None" not_leader:<region_id:7764049 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 7764049, leader may None" not_leader:<region_id:7764049 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 23697979, leader may None" not_leader:<region_id:23697979 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23697979, leader may None" not_leader:<region_id:23697979 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23697979, leader may None" not_leader:<region_id:23697979 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23697979, leader may None" not_leader:<region_id:23697979 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 8652940, leader may None" not_leader:<region_id:8652940 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8652940, leader may None" not_leader:<region_id:8652940 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8652940, leader may None" not_leader:<region_id:8652940 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 8652940, leader may None" not_leader:<region_id:8652940 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 23643143, leader may None" not_leader:<region_id:23643143 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23643143, leader may None" not_leader:<region_id:23643143 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23643143, leader may None" not_leader:<region_id:23643143 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 23643143, leader may None" not_leader:<region_id:23643143 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 25861786, leader may None" not_leader:<region_id:25861786 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25861786, leader may None" not_leader:<region_id:25861786 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25861786, leader may None" not_leader:<region_id:25861786 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 25861786, leader may None" not_leader:<region_id:25861786 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 6844216, leader may None" not_leader:<region_id:6844216 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844216, leader may None" not_leader:<region_id:6844216 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844216, leader may None" not_leader:<region_id:6844216 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 6844216, leader may None" not_leader:<region_id:6844216 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 9197482, leader may None" not_leader:<region_id:9197482 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9197482, leader may None" not_leader:<region_id:9197482 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9197482, leader may None" not_leader:<region_id:9197482 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 9197482, leader may None" not_leader:<region_id:9197482 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; batch split regions failed: split region failed: err=message:"peer is not leader for region 27736223, leader may None" not_leader:<region_id:27736223 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27736223, leader may None" not_leader:<region_id:27736223 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27736223, leader may None" not_leader:<region_id:27736223 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region; split region failed: err=message:"peer is not leader for region 27736223, leader may None" not_leader:<region_id:27736223 > : [BR:Restore:ErrRestoreSplitFailed]fail to split region | 2023-06-27 09:54:07.505566 | 2023-06-27 09:54:07.689515 | 2023-06-27 20:03:27.460498 | root@%     |
+--------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------------+----------+-----------+--------+------------------+---------------+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
```
### 4. What is your TiDB version? (Required)

sh-5.1# ./tidb-server -V
Release Version: v7.2.0-reproduce
Edition: Community
Git Commit Hash: c9b720fec264f06c628d07bcde2480b53d150b3f
Git Branch: heads/refs/tags/v7.2.0-reproduce
UTC Build Time: 2023-06-27 09:40:26
GoVersion: go1.20.5
Race Enabled: false
Check Table Before Drop: false
Store: unistore
sh-5.1# 

