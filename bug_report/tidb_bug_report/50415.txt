ID: 50415
Title: flaky test in the brietest
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

```
[2024/01/15 05:08:48.944 +00:00] [ERROR] [handle.go:190] ["handle ddl event fail"] [category=stats] [error="previous statement: insert into mysql.stats_histograms (table_id, is_index, hist_id, distinct_count, version) values(2893, 0, 3, 0, 447032937371926530): [domain:8027]Information schema is out of date: schema failed to update in 1 lease, please make sure TiDB can connect to TiKV"] [errorVerbose="[domain:8027]Information schema is out of date: schema failed to update in 1 lease, please make sure TiDB can connect to TiKV\ngithub.com/tikv/client-go/v2/txnkv/transaction.(*twoPhaseCommitter).checkSchemaValid\n\texternal/com_github_tikv_client_go_v2/txnkv/transaction/2pc.go:1811\ngithub.com/tikv/client-go/v2/txnkv/transaction.(*twoPhaseCommitter).execute\n\texternal/com_github_tikv_client_go_v2/txnkv/transaction/2pc.go:1636\ngithub.com/tikv/client-go/v2/txnkv/transaction.(*KVTxn).Commit\n\texternal/com_github_tikv_client_go_v2/txnkv/transaction/txn.go:508\ngithub.com/pingcap/tidb/pkg/store/driver/txn.(*tikvTxn).Commit\n\tpkg/store/driver/txn/txn_driver.go:99\ngithub.com/pingcap/tidb/pkg/session.(*LazyTxn).Commit\n\tpkg/session/txn.go:435\ngithub.com/pingcap/tidb/pkg/session.(*session).commitTxnWithTemporaryData\n\tpkg/session/session.go:740\ngithub.com/pingcap/tidb/pkg/session.(*session).doCommit\n\tpkg/session/session.go:621\ngithub.com/pingcap/tidb/pkg/session.(*session).doCommitWithRetry\n\tpkg/session/session.go:874\ngithub.com/pingcap/tidb/pkg/session.(*session).CommitTxn\n\tpkg/session/session.go:1001\ngithub.com/pingcap/tidb/pkg/session.autoCommitAfterStmt\n\tpkg/session/tidb.go:298\ngithub.com/pingcap/tidb/pkg/session.finishStmt\n\tpkg/session/tidb.go:260\ngithub.com/pingcap/tidb/pkg/session.runStmt\n\tpkg/session/session.go:2399\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecuteStmt\n\tpkg/session/session.go:2239\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecuteInternalStmt\n\tpkg/session/session.go:2089\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecRestrictedSQL.func1\n\tpkg/session/session.go:2054\ngithub.com/pingcap/tidb/pkg/session.(*session).withRestrictedSQLExecutor\n\tpkg/session/session.go:2040\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecRestrictedSQL\n\tpkg/session/session.go:2044\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.ExecRows\n\tpkg/statistics/handle/util/util.go:221\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.finishTransaction\n\tpkg/statistics/handle/util/util.go:65\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.WrapTxn.func1\n\tpkg/statistics/handle/util/util.go:183\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.WrapTxn\n\tpkg/statistics/handle/util/util.go:186\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.CallWithSCtx\n\tpkg/statistics/handle/util/util.go:101\ngithub.com/pingcap/tidb/pkg/statistics/handle/storage.(*statsReadWriter).InsertTableStats2KV\n\tpkg/statistics/handle/storage/stats_read_writer.go:129\ngithub.com/pingcap/tidb/pkg/statistics/handle/ddl.(*ddlHandlerImpl).HandleDDLEvent\n\tpkg/statistics/handle/ddl/ddl.go:59\ngithub.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:189\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400\nruntime.goexit\n\tsrc/runtime/asm_amd64.s:1650\ngithub.com/pingcap/errors.AddStack\n\texternal/com_github_pingcap_errors/errors.go:174\ngithub.com/pingcap/errors.Trace\n\texternal/com_github_pingcap_errors/juju_adaptor.go:15\ngithub.com/pingcap/tidb/pkg/store/driver/error.ToTiDBErr\n\tpkg/store/driver/error/error.go:186\ngithub.com/pingcap/tidb/pkg/store/driver/txn.extractKeyErr\n\tpkg/store/driver/txn/error.go:164\ngithub.com/pingcap/tidb/pkg/store/driver/txn.(*tikvTxn).extractKeyErr\n\tpkg/store/driver/txn/txn_driver.go:322\ngithub.com/pingcap/tidb/pkg/store/driver/txn.(*tikvTxn).Commit\n\tpkg/store/driver/txn/txn_driver.go:100\ngithub.com/pingcap/tidb/pkg/session.(*LazyTxn).Commit\n\tpkg/session/txn.go:435\ngithub.com/pingcap/tidb/pkg/session.(*session).commitTxnWithTemporaryData\n\tpkg/session/session.go:740\ngithub.com/pingcap/tidb/pkg/session.(*session).doCommit\n\tpkg/session/session.go:621\ngithub.com/pingcap/tidb/pkg/session.(*session).doCommitWithRetry\n\tpkg/session/session.go:874\ngithub.com/pingcap/tidb/pkg/session.(*session).CommitTxn\n\tpkg/session/session.go:1001\ngithub.com/pingcap/tidb/pkg/session.autoCommitAfterStmt\n\tpkg/session/tidb.go:298\ngithub.com/pingcap/tidb/pkg/session.finishStmt\n\tpkg/session/tidb.go:260\ngithub.com/pingcap/tidb/pkg/session.runStmt\n\tpkg/session/session.go:2399\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecuteStmt\n\tpkg/session/session.go:2239\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecuteInternalStmt\n\tpkg/session/session.go:2089\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecRestrictedSQL.func1\n\tpkg/session/session.go:2054\ngithub.com/pingcap/tidb/pkg/session.(*session).withRestrictedSQLExecutor\n\tpkg/session/session.go:2040\ngithub.com/pingcap/tidb/pkg/session.(*session).ExecRestrictedSQL\n\tpkg/session/session.go:2044\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.ExecRows\n\tpkg/statistics/handle/util/util.go:221\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.finishTransaction\n\tpkg/statistics/handle/util/util.go:65\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.WrapTxn.func1\n\tpkg/statistics/handle/util/util.go:183\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.WrapTxn\n\tpkg/statistics/handle/util/util.go:186\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.CallWithSCtx\n\tpkg/statistics/handle/util/util.go:101\ngithub.com/pingcap/tidb/pkg/statistics/handle/storage.(*statsReadWriter).InsertTableStats2KV\n\tpkg/statistics/handle/storage/stats_read_writer.go:129\ngithub.com/pingcap/tidb/pkg/statistics/handle/ddl.(*ddlHandlerImpl).HandleDDLEvent\n\tpkg/statistics/handle/ddl/ddl.go:59\ngithub.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:189\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400\nruntime.goexit\n\tsrc/runtime/asm_amd64.s:1650\nprevious statement: insert into mysql.stats_histograms (table_id, is_index, hist_id, distinct_count, version) values(2893, 0, 3, 0, 447032937371926530)"] [stack="github.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:190\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400"]
[2024/01/15 05:08:48.945 +00:00] [ERROR] [handle.go:190] ["handle ddl event fail"] [category=stats] [error="session pool closed"] [errorVerbose="session pool closed\ngithub.com/pingcap/tidb/pkg/domain.(*sessionPool).Get\n\tpkg/domain/domain.go:1576\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.CallWithSCtx\n\tpkg/statistics/handle/util/util.go:80\ngithub.com/pingcap/tidb/pkg/statistics/handle/storage.(*statsReadWriter).InsertTableStats2KV\n\tpkg/statistics/handle/storage/stats_read_writer.go:129\ngithub.com/pingcap/tidb/pkg/statistics/handle/ddl.(*ddlHandlerImpl).HandleDDLEvent\n\tpkg/statistics/handle/ddl/ddl.go:59\ngithub.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:189\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400\nruntime.goexit\n\tsrc/runtime/asm_amd64.s:1650"] [stack="github.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:190\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400"]
[2024/01/15 05:08:48.946 +00:00] [ERROR] [handle.go:190] ["handle ddl event fail"] [category=stats] [error="session pool closed"] [errorVerbose="session pool closed\ngithub.com/pingcap/tidb/pkg/domain.(*sessionPool).Get\n\tpkg/domain/domain.go:1576\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.CallWithSCtx\n\tpkg/statistics/handle/util/util.go:80\ngithub.com/pingcap/tidb/pkg/statistics/handle/storage.(*statsReadWriter).InsertTableStats2KV\n\tpkg/statistics/handle/storage/stats_read_writer.go:129\ngithub.com/pingcap/tidb/pkg/statistics/handle/ddl.(*ddlHandlerImpl).HandleDDLEvent\n\tpkg/statistics/handle/ddl/ddl.go:59\ngithub.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:189\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400\nruntime.goexit\n\tsrc/runtime/asm_amd64.s:1650"] [stack="github.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:190\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400"]
[2024/01/15 05:08:48.947 +00:00] [ERROR] [handle.go:190] ["handle ddl event fail"] [category=stats] [error="session pool closed"] [errorVerbose="session pool closed\ngithub.com/pingcap/tidb/pkg/domain.(*sessionPool).Get\n\tpkg/domain/domain.go:1576\ngithub.com/pingcap/tidb/pkg/statistics/handle/util.CallWithSCtx\n\tpkg/statistics/handle/util/util.go:80\ngithub.com/pingcap/tidb/pkg/statistics/handle/storage.(*statsReadWriter).InsertTableStats2KV\n\tpkg/statistics/handle/storage/stats_read_writer.go:129\ngithub.com/pingcap/tidb/pkg/statistics/handle/ddl.(*ddlHandlerImpl).HandleDDLEvent\n\tpkg/statistics/handle/ddl/ddl.go:59\ngithub.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:189\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400\nruntime.goexit\n\tsrc/runtime/asm_amd64.s:1650"] [stack="github.com/pingcap/tidb/pkg/statistics/handle.(*Handle).FlushStats\n\tpkg/statistics/handle/handle.go:190\ngithub.com/pingcap/tidb/pkg/domain.(*Domain).updateStatsWorkerExitPreprocessing.func1\n\tpkg/domain/domain.go:2400"]
```

https://do.pingcap.net/jenkins/blue/organizations/jenkins/pingcap%2Ftidb%2Fghpr_check2/detail/ghpr_check2/1620/pipeline/291

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

