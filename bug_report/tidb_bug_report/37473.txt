ID: 37473
Title: DATA RACE in the TrxHistoryRecorder.OnTrxEnd
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

```
 WARNING: DATA RACE
Read at 0x0000090a72a8 by goroutine 491929:
  github.com/pingcap/tidb/session/txninfo.(*TrxHistoryRecorder).OnTrxEnd()
      session/txninfo/summary.go:127 +0x164
  github.com/pingcap/tidb/session.(*LazyTxn).changeToInvalid()
      session/txn.go:285 +0x30a
  github.com/pingcap/tidb/session.(*session).doCommit.func1()
      session/session.go:580 +0x3d
  runtime.deferreturn()
      GOROOT/src/runtime/panic.go:476 +0x32
  github.com/pingcap/tidb/session.(*session).doCommitWithRetry()
      session/session.go:925 +0x3a4
  github.com/pingcap/tidb/session.(*session).CommitTxn()
      session/session.go:991 +0x2c4
  github.com/pingcap/tidb/session.autoCommitAfterStmt()
      session/tidb.go:283 +0x3da
  github.com/pingcap/tidb/session.finishStmt()
      session/tidb.go:249 +0x3ab
  github.com/pingcap/tidb/session.(*execStmtResult).Close()
      session/session.go:2250 +0x16e
  github.com/pingcap/tidb/util/sqlexec.RecordSet.Close-fm()
      <autogenerated>:1 +0x48
  github.com/pingcap/tidb/parser/terror.Call()
      parser/terror/terror.go:304 +0x4a
  github.com/pingcap/tidb/ddl.(*session).execute.func2()
      ddl/ddl.go:1652 +0x39
  runtime.deferreturn()
      GOROOT/src/runtime/panic.go:476 +0x32
  github.com/pingcap/tidb/ddl.(*ddl).getJob()
      ddl/job_table.go:98 +0x1aa
  github.com/pingcap/tidb/ddl.(*ddl).getReorgJob()
      ddl/job_table.go:146 +0x69
  github.com/pingcap/tidb/ddl.(*ddl).getReorgJob-fm()
      <autogenerated>:1 +0x44
  github.com/pingcap/tidb/ddl.(*ddl).loadDDLJobAndRun()
      ddl/job_table.go:204 +0x41d
  github.com/pingcap/tidb/ddl.(*ddl).startDispatchLoop()
      ddl/job_table.go:189 +0xb05
  github.com/pingcap/tidb/ddl.(*ddl).startDispatchLoop-fm()
      <autogenerated>:1 +0x39
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run.func1()
      util/wait_group_wrapper.go:33 +0x73
Previous write at 0x0000090a72a8 by goroutine 481867:
  github.com/pingcap/tidb/session/txninfo.(*TrxHistoryRecorder).SetMinDuration()
      session/txninfo/summary.go:151 +0x7c
  github.com/pingcap/tidb/infoschema_test.TestTiDBTrxSummary()
      infoschema/tables_test.go:1434 +0x22b
  testing.tRunner()
      GOROOT/src/testing/testing.go:1446 +0x216
  testing.(*T).Run.func1()
      GOROOT/src/testing/testing.go:1493 +0x47
Goroutine 491929 (running) created at:
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run()
      util/wait_group_wrapper.go:31 +0xe4
  github.com/pingcap/tidb/ddl.(*ddl).prepareWorkers4ConcurrencyDDL()
      ddl/ddl.go:624 +0x45e
  github.com/pingcap/tidb/ddl.(*ddl).Start()
      ddl/ddl.go:660 +0x5f4
  github.com/pingcap/tidb/domain.(*Domain).Init()
      domain/domain.go:891 +0x134c
  github.com/pingcap/tidb/session.(*domainMap).Get.func1()
      session/tidb.go:93 +0x6c4
  github.com/pingcap/tidb/util.RunWithRetry()
      util/misc.go:69 +0x93
  github.com/pingcap/tidb/session.(*domainMap).Get()
      session/tidb.go:76 +0x258
  github.com/pingcap/tidb/session.createSessionWithOpt()
      session/session.go:2946 +0x75
  github.com/pingcap/tidb/session.createSession()
      session/session.go:2942 +0x84
  github.com/pingcap/tidb/session.createSessions()
      session/session.go:2931 +0x6e
  github.com/pingcap/tidb/session.BootstrapSession()
      session/session.go:2809 +0x317
  github.com/pingcap/tidb/testkit.bootstrap()
      testkit/mockstore.go:69 +0x8c
  github.com/pingcap/tidb/testkit.CreateMockStoreAndDomain()
      testkit/mockstore.go:63 +0x10f
  github.com/pingcap/tidb/testkit.CreateMockStore()
      testkit/mockstore.go:55 +0x356
  github.com/pingcap/tidb/infoschema_test.TestTiDBTrxSummary()
      infoschema/tables_test.go:1425 +0x58
  testing.tRunner()
      GOROOT/src/testing/testing.go:1446 +0x216
  testing.(*T).Run.func1()
      GOROOT/src/testing/testing.go:1493 +0x47
Goroutine 481867 (running) created at:
  testing.(*T).Run()
      GOROOT/src/testing/testing.go:1493 +0x75d
  testing.runTests.func1()
      GOROOT/src/testing/testing.go:1846 +0x99
  testing.tRunner()
      GOROOT/src/testing/testing.go:1446 +0x216
  testing.runTests()
      GOROOT/src/testing/testing.go:1844 +0x7ec
  testing.(*M).Run()
      GOROOT/src/testing/testing.go:1726 +0xa84
  go.uber.org/goleak.VerifyTestMain()
      external/org_uber_go_goleak/testmain.go:53 +0x59
  github.com/pingcap/tidb/infoschema.TestMain()
      infoschema/main_test.go:31 +0x31b
  main.main()
      bazel-out/k8-fastbuild/bin/infoschema/infoschema_test_/testmain.go:212 +0x5e8 
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

