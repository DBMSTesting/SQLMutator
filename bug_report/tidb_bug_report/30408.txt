ID: 30408
Title: Time complexity of appendPoints2Ranges() is proportional to the square of the number of partitions
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

Table：
 CREATE TABLE `base_table` ( `fdate` varchar(30) NOT NULL,
`accountid` int(11) NOT NULL,
`buid` int(11) NOT NULL,
`planid` int(11) NOT NULL,
`shopid` bigint(20) NOT NULL,
`launchid` bigint(20) NOT NULL,
`targetid` bigint(20) NOT NULL,
`imp` bigint(20) NOT NULL,
`click` bigint(20) NOT NULL,
`reach` bigint(20) NOT NULL,
`actcount` bigint(20) NOT NULL,
`charge` double NOT NULL,
`cash` double NOT NULL,
`redpack` double NOT NULL,
`discount_amt` double NOT NULL,
UNIQUE KEY `uni_daily` (`accountid`,`buid`,`planid`,`shopid`,`launchid`,`targetid`,`fdate`),
KEY `idx_acc_shop` (`accountid`,`shopid`),
KEY `idx_launch_target` (`launchid`,`targetid`) )
PARTITION BY RANGE COLUMNS(fdate)
( PARTITION p20190916 VALUES LESS THAN ("2019-09-17"),
PARTITION p20190917 VALUES LESS THAN ("2019-09-18"),
PARTITION p20190918 VALUES LESS THAN ("2019-09-19"),
PARTITION p20190919 VALUES LESS THAN ("2019-09-20"))

create more partitions， the test result is more obvious.

SQL:
select   fdate,  
launchid,   targetid,   sum(imp) as imp,   sum(actcount) as click,   convert(sum(charge), decimal(25,6)) as
charge,   convert(sum(cash),
decimal(25,6)) as cash,  
convert(sum(redpack), decimal(25,6)) as redpack from   rpt_daily_account_launch_target_base where
fdate between '2021-11-12' and '2021-11-25'  
and launchid in (31257887,31257886,31257880,31257878,31257873,31257871,31257865,31257864,31257858,31257855,31257852,31257847,31257844,31257843,31257841,31257837,31257835,31257833,31257828,31257827,31257824,31257818,31257817,31257816,31257813,31257811,31257807,31257806,31257805,31257801,31257800,31257799,31257798,31257794,31257790,31257789,31257788,31257787,31257786,31257781,31257780,31257777,31257776,31257775,31257769,31257768,31257767,31257766,31257765,31257757,31257756,31257755,31257754,31257753,31257750,31257746,31257744,31257743,31257742,31257739,31257738,31257737,31257735,31257731,31257727,31257726,31257725,31257724,31257723,31257717,31257715,31257714,31257713,31257712,31257706,31257705,31257704,31257703,31257700,31257695,31257694,31257693,31257692,31257691,31257684,31257683,31257682,31257681,31257680,31257677,31257675,31257674,31257672,31257671,31257667,31257666,31257664,31257663,31257662,31257656,31257655,31257654,31257653,31257652,31257646,31257645,31257643,31257642,31257641,31257636,31257635,31257634,31257633,31257631,31257625,31257624,31257623,31257622,31257621,31257614,31257613,31257612,31257611,31257610,30988465,30988464,30988463,30988462,30988461,30988460,30988459,30988458,30988456,30988455,30988454,30988453,30988452,30988451,30988450,30988449,30988448,30988447,30988446,30988445,30988444,30988443,30988442,30988441,30988440,30988439,30988438,30988437,30988436,30988435,30988434,30988433,30988432,30988431,30988430,30988429,30988428,30988427,30988426,30988425,30988424,30988423,30988422,30988421,30988420,30988419,30988418,30988417,30988416,30988415,30988414,30988413,30988412,30988411,30988410,30988409,30988408,30988407,30988406,30988405,30988404,30988403,30988402,30988401,30988400,30988399,30988398,30988397,30988396,30988395,30988394,30988393,30988392,30988391,30988390,30988389,30988388,30988387,30988386,30988385,30988384,30988383,30988382,30988381,30988380,30988379,30988378,30988377,30988376,30988375,30988374,30988373,30988372,30988371,30988370,30988369,30988368,30988367,30988366,30988365,30988363,30988362,30988361,30988360,30988359,30988358,30988357,30988356,30988355,30988354,30988353,30988352,30988351,30988350,30988349,30988348,30988347,30988346,30988345,30988344,30988343,30988342,30988341,30988340,30988339,30988338,30988337,30988336,30988335,30988334,30988333,30988332,30988331,30988330,30988329,30988328,30988327,30988326,30988325,30988324,30988302,30988301,30988300,30988299,30988298,30988297,30988296,30988295,30988294,30988293,30988292,30988291,30988290,30988289,30988288,30988287,30988284,30988283,30988282,30988281,30988280,30988279,30988278,30988277,30988276,30988274,30988273,30988272,30545947,30534423,30534420,30534416,30534409,30534404,30534402,30534399,30534395,30534392,30534388,30534384,30534377,30534370,30534366,30534361,30534358,30534352,30534348,30534342,30534330,30534323,30534320,30534316,30534279,30534272,30534265,30534252,30534244,30534230,30534222,30534216,30534202,30534163,30534039,30533910,30533606,30533599,30533581,30533572,30533562,30533557,30533551,30533542,30533535,30533527,30533520,30533500,30533443,30533439,30533435,30533429,30533422,30533417,30533412,30533405,30533392,30533384,30532547,30404399,30404121,30404111,30404105,30404094,30404085,30404077,30404056,30404012,30404003,30403996,30403979,30403973,30403968,30403961,30403944,30403926,30403911,30403897,30403888,30403880,30403874,30403863,30403846,30403833,30403823,30403817,30403804,30403684,30403679,30403675,30403667,30403658,30403639,30403633,30403622,30403610,30403598,30403586,30403574,30403549,30403540,30403528,30403517,30403509,30403470,30403421,30403393,30403371,30403363,30403350,30403345,30403325,30403274)   and targetid in
(22085958,22086113,22086171,22086190,22086222,22086242,22086312,22086408,22086530,22086637,22086645,22086661,22086680,22086706,22086775,22086806,22086836,22086870,22086895,22086920,22086936,22086982,22087004,22087024,22087034,22087050,22087367,22087386,22087401,22087417,22087447,22087490,22087510,22087524,22087542,22087560,22087594,22087630,22087686,22087736,22087764,22087800,22087812,22087872,22087888,22087912,22088022,22088068,22088086,22088108,22088128,22088146,22088166,22088866,22383865,22385987,22386017,22386047,22386061,22386070,22386082,22386105,22386119,22386129,22386141,22386286,22386335,22386343,22386357,22386373,22386383,22386397,22386417,22386447,22386471,22386522,22386542,22387176,22387437,22387683,22387766,22387798,22387811,22387835,22387861,22387880,22387914,22387930,22387952,22388028,22388036,22388042,22388057,22388075,22388088,22388097,22388110,22388115,22388121,22388130,22388146,22388158,22388164,22388169,22388179,22388191,22388199,22388205,22388219,22388233,22388244,22388252,22415466,23372480,23372482,23372484,23372488,23372490,23372492,23372494,23372496,23372498,23372500,23372502,23372504,23372506,23372507,23372510,23372512,23372514,23372516,23372518,23372522,23372520,23372524,23372526,23372528,23372530,23372532,23372534,23372536,23372615,23372616,23372618,23372621,23372623,23372625,23372627,23372628,23372631,23372633,23372635,23372637,23372639,23372641,23372643,23372645,23372647,23372649,23372651,23372653,23372655,23372657,23372659,23372661,23372663,23372665,23372669,23372667,23372671,23372673,23372675,23372677,23372681,23372679,23372682,23372685,23372687,23372689,23372691,23372693,23372699,23372701,23372703,23372705,23372707,23372709,23372711,23372713,23372715,23372717,23372719,23372721,23372723,23372725,23372727,23372729,23372731,23372733,23372735,23372737,23372739,23372741,23372743,23372747,23372745,23372749,23372751,23372753,23372755,23372757,23372761,23372763,23372765,23372767,23372769,23372773,23372775,23372777,23372779,23372781,23372783,23372785,23372787,23372789,23372791,23372795,23372797,23372799,23372801,23372803,23372805,23372807,23372809,23372811,23372813,23372815,23372817,23372819,23372823,23372821,23372825,23372827,23372829,23372831,23372833,23372835,23372837,23372839,23372843,23372845,23372847,23372849,23372851,23372853,23372855,23372857,23372859,23372861,23372863,23372865,23372867,23372869,23372873,23372871,23372875,23372877,23372879,23372881,23372883,23372885,23372887,23372889,23372893,23372895,23372897,23372899,23372903,23372905,23372907,23372909,23941087,23941088,23941091,23941093,23941094,23941109,23941111,23941115,23941113,23941117,23941131,23941132,23941135,23941137,23941138,23941151,23941149,23941153,23941159,23941157,23941171,23941173,23941175,23941177,23941179,23941191,23941193,23941194,23941199,23941201,23941207,23941211,23941215,23941217,23941221,23941229,23941231,23941233,23941235,23941237,23941251,23941253,23941255,23941257,23941259,23941271,23941275,23941277,23941279,23941281,23941293,23941295,23941297,23941299,23941303,23941315,23941317,23941319,23941321,23941323,23941331,23941339,23941343,23941347,23941345,23941353,23941355,23941357,23941361,23941369,23941375,23941377,23941379,23941381,23941383,23941398,23941400,23941402,23941404,23941406,23941418,23941420,23941422,23941428,23941430,23941440,23941442,23941444,23941446,23941448,23941456,23941464,23941466,23941468,23941470,23941477,23941479,23941481,23941489,23941492,23941499,23941501,23941503,23941515,23941521,23941523,23941533,23941537,23941541,23941549,23941553,23941555,23941561,23941571,23941577,23941583,23941595,23941597,23941609,23941613,23941623,23941627,23941639,23941641)
group by fdate, launchid, targetid ; 

the compile time of this sql is about 7 seconds when the number of partitions is about 800.

<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)
the compile time should be short enough.

### 3. What did you see instead (Required)

trace this sql, I get:
  executor.Compile          | 11:58:37.944278 | 6.880550238s

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->
TIDB 3.0.5
TIDB 5.2.2
all versions 