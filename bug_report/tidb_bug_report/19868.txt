ID: 19868
Title: DATA RACE detected at unistore
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

<!-- a step by step guide for reproducing the bug. -->

```
[2020-09-08T05:00:22.780Z] ==================
[2020-09-08T05:00:22.780Z] WARNING: DATA RACE
[2020-09-08T05:00:22.780Z] Write at 0x00c024d5b418 by goroutine 211:
[2020-09-08T05:00:22.780Z]   github.com/ngaut/unistore/util/lockwaiter.(*Manager).WakeUp()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/ngaut/unistore@v0.0.0-20200828072424-1c0ede06a3fc/util/lockwaiter/lockwaiter.go:192 +0x777
[2020-09-08T05:00:22.780Z]   github.com/ngaut/unistore/tikv.(*MVCCStore).PessimisticRollback()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/ngaut/unistore@v0.0.0-20200828072424-1c0ede06a3fc/tikv/mvcc.go:342 +0x346
[2020-09-08T05:00:22.780Z]   github.com/ngaut/unistore/tikv.(*Server).KVPessimisticRollback()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/ngaut/unistore@v0.0.0-20200828072424-1c0ede06a3fc/tikv/server.go:243 +0x3fe
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/mockstore/unistore.(*RPCClient).SendRequest()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/mockstore/unistore/rpc.go:110 +0x1f6a
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.reqCollapse.SendRequest()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/client_collapse.go:49 +0x17d
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*reqCollapse).SendRequest()
[2020-09-08T05:00:22.780Z]       <autogenerated>:1 +0xc5
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).sendReqToRegion()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:413 +0x2bc
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).SendReqCtx()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:304 +0x5ef
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*tikvStore).SendReq()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:203 +0x170
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.actionPessimisticRollback.handleSingleBatch()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/pessimistic.go:201 +0x345
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*actionPessimisticRollback).handleSingleBatch()
[2020-09-08T05:00:22.780Z]       <autogenerated>:1 +0xbf
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnBatches()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:533 +0x144
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnGroupMutations()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:514 +0x841
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnMutations()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:391 +0x17d
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.(*tikvTxn).asyncPessimisticRollback.func1()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/pessimistic.go:225 +0x397
[2020-09-08T05:00:22.780Z] 
[2020-09-08T05:00:22.780Z] Previous read at 0x00c024d5b418 by goroutine 496:
[2020-09-08T05:00:22.780Z]   github.com/ngaut/unistore/tikv.(*Server).KvPessimisticLock()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/ngaut/unistore@v0.0.0-20200828072424-1c0ede06a3fc/tikv/server.go:191 +0x623
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/mockstore/unistore.(*RPCClient).SendRequest()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/mockstore/unistore/rpc.go:108 +0x1e5a
[2020-09-08T05:00:22.780Z]   github.com/pingcap/tidb/store/tikv.reqCollapse.SendRequest()
[2020-09-08T05:00:22.780Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/client_collapse.go:49 +0x17d
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*reqCollapse).SendRequest()
[2020-09-08T05:00:22.781Z]       <autogenerated>:1 +0xc5
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).sendReqToRegion()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:413 +0x2bc
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).SendReqCtx()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:304 +0x5ef
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*tikvStore).SendReq()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:203 +0x170
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.actionPessimisticLock.handleSingleBatch()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/pessimistic.go:99 +0x1179
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnBatches()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:533 +0x144
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnGroupMutations()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:487 +0xd4a
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*twoPhaseCommitter).doActionOnMutations()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/2pc.go:391 +0x17d
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*tikvTxn).LockKeys()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/pessimistic.go:221 +0xccd
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.(*TxnState).LockKeys()
[2020-09-08T05:00:22.781Z]       <autogenerated>:1 +0xb4
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.doLockKeys()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/executor.go:978 +0x20b
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.LockKeys()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/batch_point_get.go:345 +0x177
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*BatchPointGetExec).initialize()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/batch_point_get.go:295 +0xbda
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*BatchPointGetExec).Next()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/batch_point_get.go:141 +0x819
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.Next()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/executor.go:268 +0x27d
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).runPessimisticSelectForUpdate()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:472 +0x471
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).handlePessimisticSelectForUpdate()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:453 +0x70
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:350 +0x6db
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.runStmt()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/session.go:1220 +0x2c1
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.(*session).ExecuteStmt()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/session.go:1185 +0xa57
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/util/testkit.(*TestKit).Exec()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/util/testkit/testkit.go:160 +0x2f1
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/util/testkit.(*TestKit).ExecToErr()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/util/testkit/testkit.go:278 +0x91
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session_test.(*testPessimisticSuite).TestSelectForUpdateWaitSeconds.func3()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/pessimistic_test.go:1771 +0x62
[2020-09-08T05:00:22.781Z] 
[2020-09-08T05:00:22.781Z] Goroutine 211 (running) created at:
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*tikvTxn).asyncPessimisticRollback()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/txn.go:510 +0x3b6
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/store/tikv.(*tikvTxn).LockKeys()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/store/tikv/txn.go:447 +0xef2
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.(*TxnState).LockKeys()
[2020-09-08T05:00:22.781Z]       <autogenerated>:1 +0xb4
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.doLockKeys()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/executor.go:978 +0x20b
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*PointGetExecutor).lockKeyIfNeeded()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/point_get.go:294 +0x253
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*PointGetExecutor).getAndLock()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/point_get.go:274 +0x367
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*PointGetExecutor).Next()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/point_get.go:233 +0x1bf
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.Next()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/executor.go:268 +0x27d
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).runPessimisticSelectForUpdate()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:472 +0x471
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).handlePessimisticSelectForUpdate()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:453 +0x70
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/executor/adapter.go:350 +0x6db
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.runStmt()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/session.go:1220 +0x2c1
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session.(*session).ExecuteStmt()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/session.go:1185 +0xa57
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/util/testkit.(*TestKit).Exec()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/util/testkit/testkit.go:160 +0x2f1
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/util/testkit.(*TestKit).ExecToErr()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/util/testkit/testkit.go:278 +0x91
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session_test.(*testPessimisticSuite).TestSelectForUpdateWaitSeconds.func1()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/pessimistic_test.go:1761 +0x62
[2020-09-08T05:00:22.781Z] 
[2020-09-08T05:00:22.781Z] Goroutine 496 (running) created at:
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session_test.(*testPessimisticSuite).TestSelectForUpdateWaitSeconds()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/pessimistic_test.go:1769 +0x78b
[2020-09-08T05:00:22.781Z]   github.com/pingcap/tidb/session_test.(*testPessimisticSuite).TestSelectForUpdateWaitSeconds()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/src/github.com/pingcap/tidb/session/pessimistic_test.go:1744 +0x16f
[2020-09-08T05:00:22.781Z]   runtime.call32()
[2020-09-08T05:00:22.781Z]       /usr/local/go/src/runtime/asm_amd64.s:539 +0x3a
[2020-09-08T05:00:22.781Z]   reflect.Value.Call()
[2020-09-08T05:00:22.781Z]       /usr/local/go/src/reflect/value.go:321 +0xd3
[2020-09-08T05:00:22.781Z]   github.com/pingcap/check.(*suiteRunner).forkTest.func1()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:850 +0x9aa
[2020-09-08T05:00:22.781Z]   github.com/pingcap/check.(*suiteRunner).forkCall.func1()
[2020-09-08T05:00:22.781Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test@2/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x113
[2020-09-08T05:00:22.781Z] ==================

```

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

