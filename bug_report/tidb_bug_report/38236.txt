ID: 38236
Title: DATA RACE in the temptable.AttachLocalTemporaryTableInfoSchema
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

```

==================
WARNING: DATA RACE
Write at 0x00c00784e190 by goroutine 225719:
  github.com/pingcap/tidb/table/temptable.AttachLocalTemporaryTableInfoSchema()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/table/temptable/infoschema.go:29 +0xc6
  github.com/pingcap/tidb/session.(*session).GetInfoSchema()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/session/session.go:3333 +0x3fb
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker.func2.1()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:316 +0x983
  github.com/pingcap/tidb/util.WithRecovery()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/util/misc.go:96 +0x6d
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker.func2()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:285 +0x255

Previous write at 0x00c00784e190 by goroutine 225718:
  github.com/pingcap/tidb/table/temptable.AttachLocalTemporaryTableInfoSchema()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/table/temptable/infoschema.go:29 +0xc6
  github.com/pingcap/tidb/session.(*session).GetInfoSchema()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/session/session.go:3333 +0x3fb
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker.func2.1()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:316 +0x983
  github.com/pingcap/tidb/util.WithRecovery()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/util/misc.go:96 +0x6d
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker.func2()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:285 +0x255

Goroutine 225719 (running) created at:
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:282 +0x4d5
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startWorkers()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:221 +0x1ce
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:644 +0x91
  github.com/pingcap/tidb/executor.Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*TopNExec).loadChunksUntilTotalLimit()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/sort.go:433 +0x647
  github.com/pingcap/tidb/executor.(*TopNExec).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/sort.go:399 +0x278
  github.com/pingcap/tidb/executor.Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/adapter.go:987 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/server.(*tidbResultSet).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/driver_tidb.go:407 +0x61
  github.com/pingcap/tidb/server.(*clientConn).writeChunks()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2261 +0x1ed
  github.com/pingcap/tidb/server.(*clientConn).writeResultset()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2204 +0x2d4
  github.com/pingcap/tidb/server.(*clientConn).handleStmt()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2071 +0x470
  github.com/pingcap/tidb/server.(*clientConn).handleQuery()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1904 +0x94f
  github.com/pingcap/tidb/server.(*clientConn).dispatch()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1359 +0x14a6
  github.com/pingcap/tidb/server.(*clientConn).Run()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1104 +0x304
  github.com/pingcap/tidb/server.(*Server).onConn()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/server.go:563 +0x2086
  github.com/pingcap/tidb/server.(*Server).startNetworkListener.func2()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/server.go:454 +0x47

Goroutine 225718 (running) created at:
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startPartialIndexWorker()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:282 +0x4d5
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).startWorkers()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:221 +0x1ce
  github.com/pingcap/tidb/executor.(*IndexMergeReaderExecutor).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/index_merge_reader.go:644 +0x91
  github.com/pingcap/tidb/executor.Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*TopNExec).loadChunksUntilTotalLimit()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/sort.go:433 +0x647
  github.com/pingcap/tidb/executor.(*TopNExec).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/sort.go:399 +0x278
  github.com/pingcap/tidb/executor.Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/adapter.go:987 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/server.(*tidbResultSet).Next()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/driver_tidb.go:407 +0x61
  github.com/pingcap/tidb/server.(*clientConn).writeChunks()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2261 +0x1ed
  github.com/pingcap/tidb/server.(*clientConn).writeResultset()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2204 +0x2d4
  github.com/pingcap/tidb/server.(*clientConn).handleStmt()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:2071 +0x470
  github.com/pingcap/tidb/server.(*clientConn).handleQuery()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1904 +0x94f
  github.com/pingcap/tidb/server.(*clientConn).dispatch()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1359 +0x14a6
  github.com/pingcap/tidb/server.(*clientConn).Run()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/conn.go:1104 +0x304
  github.com/pingcap/tidb/server.(*Server).onConn()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/server.go:563 +0x2086
  github.com/pingcap/tidb/server.(*Server).startNetworkListener.func2()
      /home/jenkins/agent/workspace/pingcap/tidb/ghpr_check2/tidb/server/server.go:454 +0x47
==================
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

