ID: 38372
Title: DATA RACE in the ScanDetail.ProcessedKeys
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

```
==================
WARNING: DATA RACE
Write at 0x00c000b14188 by goroutine 663127:
  sync/atomic.AddInt64()
      src/runtime/race_amd64.s:289 +0xb
  sync/atomic.AddInt64()
      <autogenerated>:1 +0x1b
  github.com/pingcap/tidb/sessionctx/stmtctx.(*StatementContext).MergeScanDetail()
      sessionctx/stmtctx/stmtctx.go:822 +0x124
  github.com/pingcap/tidb/sessionctx/stmtctx.(*StatementContext).MergeExecDetails()
      sessionctx/stmtctx/stmtctx.go:800 +0x244
  github.com/pingcap/tidb/distsql.(*selectResult).fetchResp()
      distsql/select_result.go:243 +0x7b0
  github.com/pingcap/tidb/distsql.(*selectResult).Next()
      distsql/select_result.go:256 +0x198
  github.com/pingcap/tidb/executor.(*IndexReaderExecutor).Next()
      executor/distsql.go:239 +0x135
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*HashJoinExec).fetchBuildSideRows()
      executor/join.go:297 +0x3a4
  github.com/pingcap/tidb/executor.(*HashJoinExec).fetchAndBuildHashTable.func2()
      executor/join.go:1163 +0xea
  github.com/pingcap/tidb/util.WithRecovery()
      util/misc.go:96 +0x6d
  github.com/pingcap/tidb/executor.(*HashJoinExec).fetchAndBuildHashTable.func4()
      executor/join.go:1160 +0x47
Previous read at 0x00c000b14188 by goroutine 649130:
  github.com/pingcap/tidb/executor.(*ExecStmt).FinishExecuteStmt()
      executor/adapter.go:1221 +0x4ee
  github.com/pingcap/tidb/executor.(*ExecStmt).CloseRecordSet()
      executor/adapter.go:1263 +0x50
  github.com/pingcap/tidb/executor.(*recordSet).Close()
      executor/adapter.go:183 +0xbd
  github.com/pingcap/tidb/session.(*execStmtResult).Close()
      session/session.go:2268 +0x6f
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1571 +0xb8a
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).prepare()
      executor/projection.go:257 +0x934
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:208 +0xd6
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).prepare()
      executor/projection.go:257 +0x934
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:208 +0xd6
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:223 +0x651
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeCurGroupRowsAndFetchChild()
      executor/aggregate.go:1396 +0x2f5
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1342 +0x70c
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/tidb/executor.(*HashAggExec).Open()
      executor/aggregate.go:314 +0x3f1
  github.com/pingcap/tidb/executor.(*ExecStmt).openExecutor()
      executor/adapter.go:983 +0xe9
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      executor/adapter.go:493 +0x996
  github.com/pingcap/tidb/session.runStmt()
      session/session.go:2213 +0x761
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      session/session.go:2077 +0x1005
  github.com/pingcap/tidb/testkit.(*TestKit).ExecWithContext()
      testkit/testkit.go:279 +0x5bb
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      testkit/testkit.go:254 +0xaca
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1568 +0xa8d
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*MergeJoinExec).Next()
      executor/merge_join.go:325 +0x34e
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).prepare()
      executor/projection.go:257 +0x934
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:208 +0xd6
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:223 +0x651
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*ProjectionExec).parallelExecute()
      executor/projection.go:223 +0x651
  github.com/pingcap/tidb/executor.(*ProjectionExec).Next()
      executor/projection.go:181 +0xcc
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).Open()
      executor/aggregate.go:1293 +0x7fd
  github.com/pingcap/tidb/executor.(*ExecStmt).openExecutor()
      executor/adapter.go:983 +0xe9
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      executor/adapter.go:493 +0x996
  github.com/pingcap/tidb/session.runStmt()
      session/session.go:2213 +0x761
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      session/session.go:2077 +0x1005
  github.com/pingcap/tidb/testkit.(*TestKit).ExecWithContext()
      testkit/testkit.go:279 +0x5bb
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      testkit/testkit.go:254 +0xaca
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1568 +0xa8d
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeGroupRows()
      executor/aggregate.go:1381 +0x124
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1360 +0xad1
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*StreamAggExec).appendResult2Chunk()
      executor/aggregate.go:1428 +0x276
  github.com/pingcap/tidb/executor.(*StreamAggExec).consumeOneGroup()
      executor/aggregate.go:1365 +0xb24
  github.com/pingcap/tidb/executor.(*StreamAggExec).Next()
      executor/aggregate.go:1312 +0x215
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1003 +0x269
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  github.com/pingcap/failpoint.Eval()
      external/com_github_pingcap_failpoint/failpoints.go:271 +0x44
  github.com/pingcap/tidb/executor.(*HashAggExec).getPartialResults()
      executor/aggregate.go:1119 +0x1de
  github.com/pingcap/tidb/executor.(*HashAggExec).execute()
      executor/aggregate.go:1037 +0xee9
  github.com/pingcap/tidb/executor.(*HashAggExec).unparallelExec()
      executor/aggregate.go:962 +0x17a
  github.com/pingcap/tidb/executor.(*HashAggExec).Next()
      executor/aggregate.go:781 +0x106
  github.com/pingcap/tidb/executor.Next()
      executor/executor.go:324 +0x5c3
  github.com/pingcap/tidb/executor.(*ExecStmt).next()
      executor/adapter.go:990 +0x89
  github.com/pingcap/tidb/executor.(*recordSet).Next()
      executor/adapter.go:153 +0x164
  github.com/pingcap/tidb/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x76
  github.com/pingcap/tidb/session.GetRows4Test()
      session/tidb.go:336 +0xea
  github.com/pingcap/tidb/executor_test.TestRandomPanicConsume()
      executor/aggregate_test.go:1570 +0xb64
  testing.tRunner()
      GOROOT/src/testing/testing.go:1446 +0x216
  testing.(*T).Run.func1()
      GOROOT/src/testing/testing.go:1493 +0x47
Goroutine 663127 (running) created at:
  github.com/pingcap/tidb/executor.(*HashJoinExec).fetchAndBuildHashTable()
      executor/join.go:1160 +0x3d6
  github.com/pingcap/tidb/executor.(*HashJoinExec).Next.func1()
      executor/join.go:1119 +0xbc
  github.com/pingcap/tidb/util.WithRecovery()
      util/misc.go:96 +0x6d
  github.com/pingcap/tidb/executor.(*HashJoinExec).Next.func2()
      executor/join.go:1117 +0x47
Goroutine 649130 (running) created at:
  testing.(*T).Run()
      GOROOT/src/testing/testing.go:1493 +0x75d
  testing.runTests.func1()
      GOROOT/src/testing/testing.go:1846 +0x99
  testing.tRunner()
      GOROOT/src/testing/testing.go:1446 +0x216
  testing.runTests()
      GOROOT/src/testing/testing.go:1844 +0x7ec
  testing.(*M).Run()
      GOROOT/src/testing/testing.go:1726 +0xa84
  github.com/pingcap/tidb/testkit/testmain.(*testingM).Run()
      testkit/testmain/wrapper.go:27 +0x42
  go.uber.org/goleak.VerifyTestMain()
      external/org_uber_go_goleak/testmain.go:53 +0x70
  github.com/pingcap/tidb/executor_test.TestMain()
      executor/main_test.go:68 +0x9ab
  main.main()
      bazel-out/k8-fastbuild/bin/executor/executor_test_/testmain.go:2262 +0x5e8
================== 
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

