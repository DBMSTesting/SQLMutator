ID: 56623
Title: TPC-H Query 5 Performance Issue
Description:
## Bug Report

For query 5 in the TPC-H benchmark, I found that we can obtain a more efficient query plan with 90% reduced execution time by tuning this IF condition: https://github.com/pingcap/tidb/blob/master/pkg/planner/core/rule_join_reorder.go#L96

### 1. Minimal reproduce step (Required)

Query 5:
```sql
select n_name, sum(l_extendedprice * (1 - l_discount)) as revenue from CUSTOMER, ORDERS, LINEITEM, SUPPLIER, NATION, REGION where c_custkey = o_custkey and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'MIDDLE EAST' and o_orderdate >= date '1994-01-01' and o_orderdate < date '1994-01-01' + interval '1' year group by n_name order by revenue desc;

```

By applying this patch:
```patch
diff --git a/pkg/planner/core/rule_join_reorder.go b/pkg/planner/core/rule_join_reorder.go
index 1bd970609d..f08cd9d276 100644
--- a/pkg/planner/core/rule_join_reorder.go
+++ b/pkg/planner/core/rule_join_reorder.go
@@ -93,7 +93,7 @@ func extractJoinGroup(p base.LogicalPlan) *joinGroupResult {
        // If the left child has the hint, it means there are some join method hints want to specify the join method based on the left child.
        // For example: `select .. from t1 join t2 join (select .. from t3 join t4) t5 where ..;` If there are some join method hints related to `t5`, we can't split `t5` into `t3` and `t4`.
        // So we don't need to split the left child part. The right child part is the same.
-       if join.JoinType != logicalop.RightOuterJoin && !leftHasHint {
+       if !(join.JoinType != logicalop.RightOuterJoin && !leftHasHint) {
                lhsJoinGroupResult := extractJoinGroup(join.Children()[0])
                lhsGroup, lhsEqualConds, lhsOtherConds, lhsJoinTypes, lhsJoinOrderHintInfo, lhsJoinMethodHintInfo, lhsHasOuterJoin := lhsJoinGroupResult.group, lhsJoinGroupResult.eqEdges, lhsJoinGroupResult.otherConds, lhsJoinGroupResult.joinTypes, lhsJoinGroupResult.joinOrderHintInfo, lhsJoinGroupResult.joinMethodHintInfo, lhsJoinGroupResult.hasOuterJoin
                noExpand := false
```

We can observe a significant performance improvement, so perhaps there is somewhere we can optimize the code to generate the more efficient query plan in default for TiDB?

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)
Before:
```text
EXPLAIN ANALYZE FORMAT=verbose:
+--------------------------------------------------------+------------+---------------+----------+-----------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+---------+
| id                                                     | estRows    | estCost       | actRows  | task      | access object  | execution info                                                                                                                                                                                                                                                                                                                                                        | operator info                                                                                                                 | memory    | disk    |
+--------------------------------------------------------+------------+---------------+----------+-----------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+---------+
| Sort_24                                                | 1.00       | 576926559.76  | 5        | root      |                | time:9.47s, loops:2, RU:10801.782716                                                                                                                                                                                                                                                                                                                                  | Column#54:desc                                                                                                                | 1.53 KB   | 0 Bytes |
| └─Projection_26                                        | 1.00       | 576926546.76  | 5        | root      |                | time:9.47s, loops:5, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                  | tpch.nation.n_name, Column#54                                                                                                 | 2.02 KB   | N/A     |
|   └─HashAgg_27                                         | 1.00       | 576926546.56  | 5        | root      |                | time:9.47s, loops:5, partial_worker:{wall_time:9.466326132s, concurrency:5, task_num:10, tot_wait:47.328918507s, tot_exec:1.785786ms, tot_time:47.330726586s, max:9.466157997s, p95:9.466157997s}, final_worker:{wall_time:9.466337712s, concurrency:5, task_num:21, tot_wait:18.09µs, tot_exec:17.27µs, tot_time:47.33091836s, max:9.466189098s, p95:9.466189098s}   | group by:Column#56, funcs:sum(Column#55)->Column#54, funcs:firstrow(Column#56)->tpch.nation.n_name                            | 867.0 KB  | 0 Bytes |
|     └─Projection_54                                    | 0.02       | 576925026.55  | 7251     | root      |                | time:9.47s, loops:11, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                 | mul(tpch.lineitem.l_extendedprice, minus(1, tpch.lineitem.l_discount))->Column#55, tpch.nation.n_name->Column#56              | 173.9 KB  | N/A     |
|       └─Projection_28                                  | 0.02       | 576925026.39  | 7251     | root      |                | time:9.47s, loops:11, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                 | tpch.lineitem.l_extendedprice, tpch.lineitem.l_discount, tpch.nation.n_name                                                   | 453.1 KB  | N/A     |
|         └─HashJoin_30                                  | 0.02       | 576925026.39  | 7251     | root      |                | time:9.47s, loops:11, build_hash_table:{total:8.87s, fetch:1.58s, build:7.28s}, probe:{concurrency:5, total:47.3s, max:9.47s, probe:1.94s, fetch and wait:45.4s}                                                                                                                                                                                                      | inner join, equal:[eq(tpch.orders.o_orderkey, tpch.lineitem.l_orderkey) eq(tpch.supplier.s_suppkey, tpch.lineitem.l_suppkey)] | 1.95 GB   | 0 Bytes |
|           ├─HashJoin_32(Build)                         | 0.01       | 51709306.41   | 18164405 | root      |                | time:1.57s, loops:17741, build_hash_table:{total:1.52s, fetch:36.2ms, build:1.49s}, probe:{concurrency:5, total:44.1s, max:8.87s, probe:3.36s, fetch and wait:40.8s}                                                                                                                                                                                                  | inner join, equal:[eq(tpch.customer.c_custkey, tpch.orders.o_custkey)]                                                        | 567.6 MB  | 0 Bytes |
|           │ ├─HashJoin_34(Build)                       | 0.01       | 8156523.63    | 12071746 | root      |                | time:42.9ms, loops:11791, build_hash_table:{total:5.39ms, fetch:5.05ms, build:340.7µs}, probe:{concurrency:5, total:7.56s, max:1.52s, probe:2.74s, fetch and wait:4.82s}                                                                                                                                                                                              | inner join, equal:[eq(tpch.supplier.s_nationkey, tpch.customer.c_nationkey)]                                                  | 143.3 KB  | 0 Bytes |
|           │ │ ├─HashJoin_36(Build)                     | 0.01       | 530303.29     | 2019     | root      |                | time:5.17ms, loops:6, build_hash_table:{total:388.1µs, fetch:381.2µs, build:6.93µs}, probe:{concurrency:5, total:23.8ms, max:4.96ms, probe:2.61ms, fetch and wait:21.2ms}                                                                                                                                                                                             | inner join, equal:[eq(tpch.nation.n_nationkey, tpch.supplier.s_nationkey)]                                                    | 2.21 KB   | 0 Bytes |
|           │ │ │ ├─HashJoin_38(Build)                   | 0.01       | 3659.60       | 5        | root      |                | time:322.9µs, loops:2, build_hash_table:{total:123.3µs, fetch:117.4µs, build:5.84µs}, probe:{concurrency:5, total:462.3µs, max:129.6µs, probe:25µs, fetch and wait:437.3µs}                                                                                                                                                                                           | inner join, equal:[eq(tpch.region.r_regionkey, tpch.nation.n_regionkey)]                                                      | 25.7 KB   | 0 Bytes |
|           │ │ │ │ ├─TableReader_41(Build)              | 0.01       | 216.57        | 1        | root      |                | time:67.7µs, loops:2, cop_task: {num: 1, max: 263.4µs, proc_keys: 0, copr_cache_hit_ratio: 0.00, build_task_duration: 10.5µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:1, total_time:227µs}}                                                                                                                                                               | data:Selection_40                                                                                                             | 239 Bytes | N/A     |
|           │ │ │ │ │ └─Selection_40                     | 0.01       | 3247.59       | 1        | cop[tikv] |                | tikv_task:{time:188.9µs, loops:0}                                                                                                                                                                                                                                                                                                                                     | eq(tpch.region.r_name, "MIDDLE EAST")                                                                                         | N/A       | N/A     |
|           │ │ │ │ │   └─TableFullScan_39               | 5.00       | 2998.09       | 5        | cop[tikv] | table:REGION   | tikv_task:{time:188.9µs, loops:0}                                                                                                                                                                                                                                                                                                                                     | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
|           │ │ │ │ └─TableReader_43(Probe)              | 25.00      | 1446.48       | 25       | root      |                | time:89µs, loops:2, cop_task: {num: 1, max: 204.3µs, proc_keys: 0, copr_cache_hit_ratio: 0.00, build_task_duration: 3.96µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:1, total_time:172.6µs}}                                                                                                                                                               | data:TableFullScan_42                                                                                                         | 990 Bytes | N/A     |
|           │ │ │ │   └─TableFullScan_42                 | 25.00      | 15262.19      | 25       | cop[tikv] | table:NATION   | tikv_task:{time:130.9µs, loops:0}                                                                                                                                                                                                                                                                                                                                     | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
|           │ │ │ └─TableReader_45(Probe)                | 10000.00   | 325546.02     | 10000    | root      |                | time:4.62ms, loops:11, cop_task: {num: 7, max: 1.78ms, min: 209µs, avg: 678.9µs, p95: 1.78ms, tot_proc: 1ms, copr_cache_hit_ratio: 0.00, build_task_duration: 2.22µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:7, total_time:4.67ms}}                                                                                                                      | data:TableFullScan_44                                                                                                         | 101.4 KB  | N/A     |
|           │ │ │   └─TableFullScan_44                   | 10000.00   | 3615990.34    | 10000    | cop[tikv] | table:SUPPLIER | tikv_task:{proc max:1.71ms, min:96.4µs, avg: 611.8µs, p80:785.1µs, p95:1.71ms, iters:0, tasks:7}, time_detail: {total_process_time: 1ms}                                                                                                                                                                                                                              | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
|           │ │ └─TableReader_47(Probe)                  | 150000.00  | 4630722.50    | 150000   | root      |                | time:7.67ms, loops:148, cop_task: {num: 11, max: 21.8ms, min: 227.9µs, avg: 5.97ms, p95: 21.8ms, tot_proc: 58ms, copr_cache_hit_ratio: 0.00, build_task_duration: 2.6µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:11, total_time:65.4ms}}                                                                                                                  | data:TableFullScan_46                                                                                                         | 1.34 MB   | N/A     |
|           │ │   └─TableFullScan_46                     | 150000.00  | 50452837.55   | 150000   | cop[tikv] | table:CUSTOMER | tikv_task:{proc max:21.2ms, min:182.1µs, avg: 5.76ms, p80:13.4ms, p95:21.2ms, iters:0, tasks:11}, time_detail: {total_process_time: 58ms}                                                                                                                                                                                                                             | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
|           │ └─TableReader_50(Probe)                    | 37500.00   | 42802784.73   | 227597   | root      |                | time:13ms, loops:223, cop_task: {num: 62, max: 76.1ms, min: 491.1µs, avg: 16.4ms, p95: 71.2ms, tot_proc: 978ms, copr_cache_hit_ratio: 0.00, build_task_duration: 18.7µs, max_distsql_concurrency: 7}, rpc_info:{Cop:{num_rpc:62, total_time:1.02s}}                                                                                                                   | data:Selection_49                                                                                                             | 2.73 MB   | N/A     |
|           │   └─Selection_49                           | 37500.00   | 634913770.89  | 227597   | cop[tikv] |                | tikv_task:{proc max:75.8ms, min:456.4µs, avg: 16.3ms, p80:34.7ms, p95:70.8ms, iters:0, tasks:62}, time_detail: {total_process_time: 978ms}                                                                                                                                                                                                                            | ge(tpch.orders.o_orderdate, 1994-01-01), lt(tpch.orders.o_orderdate, 1995-01-01)                                              | N/A       | N/A     |
|           │     └─TableFullScan_48                     | 1500000.00 | 485213770.89  | 1500000  | cop[tikv] | table:ORDERS   | tikv_task:{proc max:75.8ms, min:456.4µs, avg: 16.3ms, p80:34.7ms, p95:70.8ms, iters:0, tasks:62}                                                                                                                                                                                                                                                                      | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
|           └─TableReader_52(Probe)                      | 6001215.00 | 345537843.95  | 6001215  | root      |                | time:283.7ms, loops:5862, cop_task: {num: 407, max: 44.5ms, min: 166.9µs, avg: 9.61ms, p95: 31.5ms, tot_proc: 3.59s, copr_cache_hit_ratio: 0.00, build_task_duration: 48.7µs, max_distsql_concurrency: 15}, rpc_info:{Cop:{num_rpc:407, total_time:3.9s}}                                                                                                             | data:TableFullScan_51                                                                                                         | 52.1 MB   | N/A     |
|             └─TableFullScan_51                         | 6001215.00 | 2141171800.01 | 6001215  | cop[tikv] | table:LINEITEM | tikv_task:{proc max:43.5ms, min:144.6µs, avg: 9.3ms, p80:23.8ms, p95:30.7ms, iters:0, tasks:407}, time_detail: {total_process_time: 3.59s}                                                                                                                                                                                                                            | keep order:false, stats:pseudo                                                                                                | N/A       | N/A     |
+--------------------------------------------------------+------------+---------------+----------+-----------+----------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------------------------------------------------------------------------------------------------------------+-----------+---------+

```
```bash
mysql> select n_name, sum(l_extendedprice * (1 - l_discount)) as revenue from CUSTOMER, ORDERS, LINEITEM, SUPPLIER, NATION, REGION where c_custkey = o_custkey and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'MIDDLE EAST' and o_orderdate >= date '1994-01-01' and o_orderdate < date '1994-01-01' + interval '1' year group by n_name order by revenue desc;
+--------------+---------------+
| n_name       | revenue       |
+--------------+---------------+
| IRAQ         | 58232553.2776 |
| SAUDI ARABIA | 53335013.3675 |
| EGYPT        | 53293463.6888 |
| IRAN         | 50487778.1438 |
| JORDAN       | 48801457.3985 |
+--------------+---------------+
5 rows in set (10.56 sec)
```

After:
```text
EXPLAIN ANALYZE FORMAT=verbose:
| id                                                   | estRows    | estCost       | actRows | task      | access object  | execution info                                                                                                                                                                                                                                                                                                                                                         | operator info                                                                                                                     | memory    | disk    |
+------------------------------------------------------+------------+---------------+---------+-----------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------+---------+
| Sort_25                                              | 1.00       | 528547158.62  | 5       | root      |                | time:753.8ms, loops:2, RU:10804.449474                                                                                                                                                                                                                                                                                                                                 | Column#54:desc                                                                                                                    | 1.53 KB   | 0 Bytes |
| └─Projection_27                                      | 1.00       | 528547145.62  | 5       | root      |                | time:753.8ms, loops:5, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                 | tpch.nation.n_name, Column#54                                                                                                     | 2.02 KB   | N/A     |
|   └─HashAgg_28                                       | 1.00       | 528547145.42  | 5       | root      |                | time:753.7ms, loops:5, partial_worker:{wall_time:753.731804ms, concurrency:5, task_num:10, tot_wait:3.765979693s, tot_exec:1.86083ms, tot_time:3.767862953s, max:753.580641ms, p95:753.580641ms}, final_worker:{wall_time:753.754625ms, concurrency:5, task_num:21, tot_wait:23.331µs, tot_exec:21.841µs, tot_time:3.768014545s, max:753.612191ms, p95:753.612191ms}   | group by:Column#56, funcs:sum(Column#55)->Column#54, funcs:firstrow(Column#56)->tpch.nation.n_name                                | 853.4 KB  | 0 Bytes |
|     └─Projection_58                                  | 0.01       | 528545625.63  | 7251    | root      |                | time:753.5ms, loops:11, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                | mul(tpch.lineitem.l_extendedprice, minus(1, tpch.lineitem.l_discount))->Column#55, tpch.nation.n_name->Column#56                  | 209.8 KB  | N/A     |
|       └─HashJoin_31                                  | 0.01       | 528545625.55  | 7251    | root      |                | time:752.7ms, loops:11, build_hash_table:{total:187.3µs, fetch:181µs, build:6.28µs}, probe:{concurrency:5, total:3.76s, max:753.1ms, probe:4.88ms, fetch and wait:3.76s}                                                                                                                                                                                               | inner join, equal:[eq(tpch.region.r_regionkey, tpch.nation.n_regionkey)]                                                          | 25.7 KB   | 0 Bytes |
|         ├─TableReader_34(Build)                      | 0.01       | 216.57        | 1       | root      |                | time:157.6µs, loops:2, cop_task: {num: 1, max: 124.6µs, proc_keys: 0, copr_cache_hit_ratio: 0.00, build_task_duration: 6.99µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:1, total_time:105.4µs}}                                                                                                                                                             | data:Selection_33                                                                                                                 | 239 Bytes | N/A     |
|         │ └─Selection_33                             | 0.01       | 3247.59       | 1       | cop[tikv] |                | tikv_task:{time:87.8µs, loops:0}                                                                                                                                                                                                                                                                                                                                       | eq(tpch.region.r_name, "MIDDLE EAST")                                                                                             | N/A       | N/A     |
|         │   └─TableFullScan_32                       | 5.00       | 2998.09       | 5       | cop[tikv] | table:REGION   | tikv_task:{time:87.8µs, loops:0}                                                                                                                                                                                                                                                                                                                                       | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
|         └─Projection_35(Probe)                       | 31.25      | 528543287.68  | 36236   | root      |                | time:752.9ms, loops:39, Concurrency:OFF                                                                                                                                                                                                                                                                                                                                | tpch.lineitem.l_extendedprice, tpch.lineitem.l_discount, tpch.nation.n_name, tpch.nation.n_regionkey                              | 650.2 KB  | N/A     |
|           └─HashJoin_37                              | 31.25      | 528543275.20  | 36236   | root      |                | time:752.8ms, loops:39, build_hash_table:{total:119.5µs, fetch:109.8µs, build:9.68µs}, probe:{concurrency:5, total:3.76s, max:752.7ms, probe:12ms, fetch and wait:3.75s}                                                                                                                                                                                               | inner join, equal:[eq(tpch.nation.n_nationkey, tpch.supplier.s_nationkey)]                                                        | 33.9 KB   | 0 Bytes |
|             ├─TableReader_39(Build)                  | 25.00      | 1446.48       | 25      | root      |                | time:89.6µs, loops:2, cop_task: {num: 1, max: 108.2µs, proc_keys: 0, copr_cache_hit_ratio: 0.00, build_task_duration: 2.66µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:1, total_time:88.8µs}}                                                                                                                                                               | data:TableFullScan_38                                                                                                             | 990 Bytes | N/A     |
|             │ └─TableFullScan_38                     | 25.00      | 15262.19      | 25      | cop[tikv] | table:NATION   | tikv_task:{time:69.1µs, loops:0}                                                                                                                                                                                                                                                                                                                                       | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
|             └─Projection_40(Probe)                   | 10000.00   | 528337911.72  | 36236   | root      |                | time:752.2ms, loops:39, Concurrency:5                                                                                                                                                                                                                                                                                                                                  | tpch.lineitem.l_extendedprice, tpch.lineitem.l_discount, tpch.supplier.s_nationkey                                                | 900.4 KB  | N/A     |
|               └─HashJoin_42                          | 10000.00   | 528334917.72  | 36236   | root      |                | time:752.1ms, loops:39, build_hash_table:{total:5.47ms, fetch:2.76ms, build:2.71ms}, probe:{concurrency:5, total:3.76s, max:751.9ms, probe:156.9ms, fetch and wait:3.6s}                                                                                                                                                                                               | inner join, equal:[eq(tpch.supplier.s_suppkey, tpch.lineitem.l_suppkey) eq(tpch.supplier.s_nationkey, tpch.customer.c_nationkey)] | 861.8 KB  | 0 Bytes |
|                 ├─TableReader_44(Build)              | 10000.00   | 325546.02     | 10000   | root      |                | time:3.74ms, loops:11, cop_task: {num: 7, max: 1.6ms, min: 171.2µs, avg: 621.5µs, p95: 1.6ms, tot_proc: 1ms, copr_cache_hit_ratio: 0.00, build_task_duration: 2.24µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:7, total_time:4.28ms}}                                                                                                                       | data:TableFullScan_43                                                                                                             | 101.4 KB  | N/A     |
|                 │ └─TableFullScan_43                 | 10000.00   | 3615990.34    | 10000   | cop[tikv] | table:SUPPLIER | tikv_task:{proc max:1.57ms, min:128.6µs, avg: 563.6µs, p80:779.3µs, p95:1.57ms, iters:0, tasks:7}, time_detail: {total_process_time: 1ms}                                                                                                                                                                                                                              | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
|                 └─HashJoin_46(Probe)                 | 58593.75   | 524692577.83  | 910519  | root      |                | time:750.7ms, loops:893, build_hash_table:{total:234.5ms, fetch:171.4ms, build:63.1ms}, probe:{concurrency:5, total:3.76s, max:751.5ms, probe:1.2s, fetch and wait:2.56s}                                                                                                                                                                                              | inner join, equal:[eq(tpch.orders.o_orderkey, tpch.lineitem.l_orderkey)]                                                          | 16.0 MB   | 0 Bytes |
|                   ├─Projection_47(Build)             | 46875.00   | 54540860.48   | 227597  | root      |                | time:178ms, loops:226, Concurrency:5                                                                                                                                                                                                                                                                                                                                   | tpch.customer.c_nationkey, tpch.orders.o_orderkey                                                                                 | 167.3 KB  | N/A     |
|                   │ └─HashJoin_49                    | 46875.00   | 54531504.23   | 227597  | root      |                | time:201.4ms, loops:226, build_hash_table:{total:155.5ms, fetch:98.7ms, build:56.7ms}, probe:{concurrency:5, total:1.16s, max:232.1ms, probe:212.3ms, fetch and wait:945.3ms}                                                                                                                                                                                          | inner join, equal:[eq(tpch.orders.o_custkey, tpch.customer.c_custkey)]                                                            | 14.8 MB   | 0 Bytes |
|                   │   ├─TableReader_52(Build)        | 37500.00   | 42802784.73   | 227597  | root      |                | time:110ms, loops:223, cop_task: {num: 62, max: 65.2ms, min: 634.6µs, avg: 15.6ms, p95: 64.4ms, tot_proc: 933ms, copr_cache_hit_ratio: 0.00, build_task_duration: 13.6µs, max_distsql_concurrency: 7}, rpc_info:{Cop:{num_rpc:62, total_time:964.5ms}}                                                                                                                 | data:Selection_51                                                                                                                 | 1.20 MB   | N/A     |
|                   │   │ └─Selection_51               | 37500.00   | 634913770.89  | 227597  | cop[tikv] |                | tikv_task:{proc max:64.9ms, min:608.6µs, avg: 15.5ms, p80:32.9ms, p95:64.2ms, iters:0, tasks:62}, time_detail: {total_process_time: 933ms}                                                                                                                                                                                                                             | ge(tpch.orders.o_orderdate, 1994-01-01), lt(tpch.orders.o_orderdate, 1995-01-01)                                                  | N/A       | N/A     |
|                   │   │   └─TableFullScan_50         | 1500000.00 | 485213770.89  | 1500000 | cop[tikv] | table:ORDERS   | tikv_task:{proc max:64.9ms, min:608.6µs, avg: 15.5ms, p80:32.9ms, p95:64.2ms, iters:0, tasks:62}                                                                                                                                                                                                                                                                       | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
|                   │   └─TableReader_54(Probe)        | 150000.00  | 4630722.50    | 150000  | root      |                | time:26.2ms, loops:148, cop_task: {num: 11, max: 19.4ms, min: 151.7µs, avg: 5.14ms, p95: 19.4ms, tot_proc: 52ms, copr_cache_hit_ratio: 0.00, build_task_duration: 2.5µs, max_distsql_concurrency: 1}, rpc_info:{Cop:{num_rpc:11, total_time:56.4ms}}                                                                                                                   | data:TableFullScan_53                                                                                                             | 1.34 MB   | N/A     |
|                   │     └─TableFullScan_53           | 150000.00  | 50452837.55   | 150000  | cop[tikv] | table:CUSTOMER | tikv_task:{proc max:19.1ms, min:130.6µs, avg: 5.04ms, p80:11.1ms, p95:19.1ms, iters:0, tasks:11}, time_detail: {total_process_time: 52ms}                                                                                                                                                                                                                              | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
|                   └─TableReader_56(Probe)            | 6001215.00 | 345537843.95  | 6001215 | root      |                | time:308ms, loops:5862, cop_task: {num: 407, max: 44.4ms, min: 136.4µs, avg: 9.79ms, p95: 32.5ms, tot_proc: 3.65s, copr_cache_hit_ratio: 0.00, build_task_duration: 41.2µs, max_distsql_concurrency: 15}, rpc_info:{Cop:{num_rpc:407, total_time:3.98s}}                                                                                                               | data:TableFullScan_55                                                                                                             | 39.3 MB   | N/A     |
|                     └─TableFullScan_55               | 6001215.00 | 2141171800.01 | 6001215 | cop[tikv] | table:LINEITEM | tikv_task:{proc max:43.3ms, min:118.7µs, avg: 9.42ms, p80:22.7ms, p95:30.3ms, iters:0, tasks:407}, time_detail: {total_process_time: 3.65s}                                                                                                                                                                                                                            | keep order:false, stats:pseudo                                                                                                    | N/A       | N/A     |
+------------------------------------------------------+------------+---------------+---------+-----------+----------------+------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------+-----------+---------+

```
```bash
mysql> select n_name, sum(l_extendedprice * (1 - l_discount)) as revenue from CUSTOMER, ORDERS, LINEITEM, SUPPLIER, NATION, REGION where c_custkey = o_custkey and l_orderkey = o_orderkey and l_suppkey = s_suppkey and c_nationkey = s_nationkey and s_nationkey = n_nationkey and n_regionkey = r_regionkey and r_name = 'MIDDLE EAST' and o_orderdate >= date '1994-01-01' and o_orderdate < date '1994-01-01' + interval '1' year group by n_name order by revenue desc;
+--------------+---------------+
| n_name       | revenue       |
+--------------+---------------+
| IRAQ         | 58232553.2776 |
| SAUDI ARABIA | 53335013.3675 |
| EGYPT        | 53293463.6888 |
| IRAN         | 50487778.1438 |
| JORDAN       | 48801457.3985 |
+--------------+---------------+
5 rows in set (0.84 sec)
```

### 4. What is your TiDB version? (Required)
```
| Release Version: v8.4.0-alpha-382-g3dfc47f2cc-dirty
Edition: Community
Git Commit Hash: 3dfc47f2cc289a4f39843393f98da926f0c7ba1e
Git Branch: HEAD
UTC Build Time: 2024-10-13 19:19:05
GoVersion: go1.23.2
Race Enabled: false
Check Table Before Drop: false
Store: unistore |
```

I generated 1 GB of data for TPC-H and shared my data directory in [Google drive](https://drive.google.com/file/d/1-CGqmtV9Fwn3XslmT3vUVGdVGh1q4Zid/view?usp=sharing) for your analysis.
