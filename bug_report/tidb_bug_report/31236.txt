ID: 31236
Title: DATA RACE in the ```parser/charset```
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

make race 

```
 WARNING: DATA RACE
Write at 0x00c000256660 by goroutine 568:
  runtime.mapassign_faststr()
      /usr/local/go/src/runtime/map_faststr.go:202 +0x0
  github.com/pingcap/tidb/parser/charset.AddCharset()
      /go/tidb/parser/charset/charset.go:483 +0x10a
  github.com/pingcap/tidb/util/collate.addCharset()
      /go/tidb/util/collate/charset.go:52 +0xb3
  github.com/pingcap/tidb/util/collate.SetCharsetFeatEnabledForTest()
      /go/tidb/util/collate/charset.go:39 +0x52
  github.com/pingcap/tidb/ddl.(*testColumnSuite).TestModifyColumn()
      /go/tidb/ddl/column_test.go:1164 +0x4f
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).forkTest.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:850 +0xa54
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Previous read at 0x00c000256660 by goroutine 674:
  runtime.mapaccess2_faststr()
      /usr/local/go/src/runtime/map_faststr.go:107 +0x0
  github.com/pingcap/tidb/parser/charset.GetCharsetInfo()
      /go/tidb/parser/charset/charset.go:147 +0x77
  github.com/pingcap/tidb/sessionctx/variable.glob..func36()
      /go/tidb/sessionctx/variable/sysvar.go:218 +0x44
  github.com/pingcap/tidb/sessionctx/variable.(*SysVar).SetSessionFromHook()
      /go/tidb/sessionctx/variable/variable.go:182 +0xaf
  github.com/pingcap/tidb/sessionctx/variable.(*SessionVars).SetSystemVar()
      /go/tidb/sessionctx/variable/session.go:1634 +0x59
  github.com/pingcap/tidb/util/mock.NewContext()
      /go/tidb/util/mock/context.go:367 +0x67d
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.newClosureExecutor()
      /go/tidb/store/mockstore/unistore/cophandler/closure_exec.go:243 +0x1e7
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.buildClosureExecutor()
      /go/tidb/store/mockstore/unistore/cophandler/closure_exec.go:170 +0x10c
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.handleCopDAGRequest()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:116 +0x4a6
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.HandleCopRequestWithMPPCtx()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:69 +0xad
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.HandleCopRequest()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:57 +0x3ee
  github.com/pingcap/tidb/store/mockstore/unistore/tikv.(*Server).Coprocessor()
      /go/tidb/store/mockstore/unistore/tikv/server.go:559 +0x38f
  github.com/pingcap/tidb/store/mockstore/unistore.(*RPCClient).SendRequest()
      /go/tidb/store/mockstore/unistore/rpc.go:236 +0x3273
  github.com/pingcap/tidb/store/mockstore.(*clientRedirector).SendRequest()
      /go/tidb/store/mockstore/redirector.go:61 +0x176
  github.com/tikv/client-go/v2/internal/client.interceptedClient.SendRequest()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/client/client_interceptor.go:42 +0x20b
  github.com/tikv/client-go/v2/internal/client.(*interceptedClient).SendRequest()
      <autogenerated>:1 +0xb6
  github.com/tikv/client-go/v2/internal/client.reqCollapse.SendRequest()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/client/client_collapse.go:74 +0x130
  github.com/tikv/client-go/v2/internal/client.(*reqCollapse).SendRequest()
      <autogenerated>:1 +0xb6
  github.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).sendReqToRegion()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/locate/region_request.go:1130 +0xd4e
  github.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).SendReqCtx()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/locate/region_request.go:982 +0x196e
  github.com/tikv/client-go/v2/txnkv/txnsnapshot.(*ClientHelper).SendReqCtx()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/txnkv/txnsnapshot/client_helper.go:109 +0x33a
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce()
      /go/tidb/store/copr/coprocessor.go:756 +0x1397
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask()
      /go/tidb/store/copr/coprocessor.go:668 +0x1fc
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).run()
      /go/tidb/store/copr/coprocessor.go:410 +0x184
  github.com/pingcap/tidb/store/copr.(*copIterator).open·dwrap·8()
      /go/tidb/store/copr/coprocessor.go:442 +0x58
Goroutine 568 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).forkTest()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:832 +0x164
  github.com/pingcap/check.(*suiteRunner).doRun()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:666 +0x1fa
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:650 +0x104
Goroutine 674 (finished) created at:
  github.com/pingcap/tidb/store/copr.(*copIterator).open()
      /go/tidb/store/copr/coprocessor.go:442 +0xb9
  github.com/pingcap/tidb/store/copr.(*CopClient).Send()
      /go/tidb/store/copr/coprocessor.go:140 +0x1044
  github.com/pingcap/tidb/distsql.Select()
      /go/tidb/distsql/distsql.go:96 +0x838
  github.com/pingcap/tidb/distsql.SelectWithRuntimeStats()
      /go/tidb/distsql/distsql.go:145 +0xbb
  github.com/pingcap/tidb/executor.(*IndexLookUpExecutor).startIndexWorker.func1()
      /go/tidb/executor/distsql.go:595 +0xac5
==================
==================
WARNING: DATA RACE
Write at 0x00c000256600 by goroutine 568:
  runtime.mapassign_fast64()
      /usr/local/go/src/runtime/map_fast64.go:92 +0x0
  github.com/pingcap/tidb/parser/charset.AddCollation()
      /go/tidb/parser/charset/charset.go:495 +0x47b
  github.com/pingcap/tidb/util/collate.addCharset()
      /go/tidb/util/collate/charset.go:55 +0x431
  github.com/pingcap/tidb/util/collate.SetCharsetFeatEnabledForTest()
      /go/tidb/util/collate/charset.go:39 +0x52
  github.com/pingcap/tidb/ddl.(*testColumnSuite).TestModifyColumn()
      /go/tidb/ddl/column_test.go:1164 +0x4f
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).forkTest.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:850 +0xa54
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Previous read at 0x00c000256600 by goroutine 674:
  runtime.mapaccess2_fast64()
      /usr/local/go/src/runtime/map_fast64.go:52 +0x0
  github.com/pingcap/tidb/parser/charset.GetCharsetInfoByID()
      /go/tidb/parser/charset/charset.go:159 +0x76
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.fieldTypeFromPBColumn()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:449 +0x5e
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.(*evalContext).setColumnInfo()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:203 +0x1cc
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.newClosureExecutor()
      /go/tidb/store/mockstore/unistore/cophandler/closure_exec.go:255 +0x3c8
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.buildClosureExecutor()
      /go/tidb/store/mockstore/unistore/cophandler/closure_exec.go:170 +0x10c
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.handleCopDAGRequest()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:116 +0x4a6
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.HandleCopRequestWithMPPCtx()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:69 +0xad
  github.com/pingcap/tidb/store/mockstore/unistore/cophandler.HandleCopRequest()
      /go/tidb/store/mockstore/unistore/cophandler/cop_handler.go:57 +0x3ee
  github.com/pingcap/tidb/store/mockstore/unistore/tikv.(*Server).Coprocessor()
      /go/tidb/store/mockstore/unistore/tikv/server.go:559 +0x38f
  github.com/pingcap/tidb/store/mockstore/unistore.(*RPCClient).SendRequest()
      /go/tidb/store/mockstore/unistore/rpc.go:236 +0x3273
  github.com/pingcap/tidb/store/mockstore.(*clientRedirector).SendRequest()
      /go/tidb/store/mockstore/redirector.go:61 +0x176
  github.com/tikv/client-go/v2/internal/client.interceptedClient.SendRequest()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/client/client_interceptor.go:42 +0x20b
  github.com/tikv/client-go/v2/internal/client.(*interceptedClient).SendRequest()
      <autogenerated>:1 +0xb6
  github.com/tikv/client-go/v2/internal/client.reqCollapse.SendRequest()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/client/client_collapse.go:74 +0x130
  github.com/tikv/client-go/v2/internal/client.(*reqCollapse).SendRequest()
      <autogenerated>:1 +0xb6
  github.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).sendReqToRegion()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/locate/region_request.go:1130 +0xd4e
  github.com/tikv/client-go/v2/internal/locate.(*RegionRequestSender).SendReqCtx()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/internal/locate/region_request.go:982 +0x196e
  github.com/tikv/client-go/v2/txnkv/txnsnapshot.(*ClientHelper).SendReqCtx()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.0-rc.0.20211229051614-62d6b4a2e8f7/txnkv/txnsnapshot/client_helper.go:109 +0x33a
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTaskOnce()
      /go/tidb/store/copr/coprocessor.go:756 +0x1397
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).handleTask()
      /go/tidb/store/copr/coprocessor.go:668 +0x1fc
  github.com/pingcap/tidb/store/copr.(*copIteratorWorker).run()
      /go/tidb/store/copr/coprocessor.go:410 +0x184
  github.com/pingcap/tidb/store/copr.(*copIterator).open·dwrap·8()
      /go/tidb/store/copr/coprocessor.go:442 +0x58
Goroutine 568 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).forkTest()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:832 +0x164
  github.com/pingcap/check.(*suiteRunner).doRun()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:666 +0x1fa
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:650 +0x104
Goroutine 674 (finished) created at:
  github.com/pingcap/tidb/store/copr.(*copIterator).open()
      /go/tidb/store/copr/coprocessor.go:442 +0xb9
  github.com/pingcap/tidb/store/copr.(*CopClient).Send()
      /go/tidb/store/copr/coprocessor.go:140 +0x1044
  github.com/pingcap/tidb/distsql.Select()
      /go/tidb/distsql/distsql.go:96 +0x838
  github.com/pingcap/tidb/distsql.SelectWithRuntimeStats()
      /go/tidb/distsql/distsql.go:145 +0xbb
  github.com/pingcap/tidb/executor.(*IndexLookUpExecutor).startIndexWorker.func1()
      /go/tidb/executor/distsql.go:595 +0xac5
================== 
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

