ID: 33910
Title: data race for session manager in ci test
Description:
## Bug Report

https://ci.pingcap.net/blue/organizations/jenkins/tidb_ghpr_check_2/detail/tidb_ghpr_check_2/73484/pipeline/

```sh
[2022-04-13T04:26:28.565Z] ==================
[2022-04-13T04:26:28.565Z] WARNING: DATA RACE
[2022-04-13T04:26:28.565Z] Read at 0x00c000d2f4d8 by goroutine 92:
[2022-04-13T04:26:28.565Z]   github.com/pingcap/tidb/domain/infosync.(*InfoSyncer).GetSessionManager()
[2022-04-13T04:26:28.565Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/infosync/info.go:218 +0x49
[2022-04-13T04:26:28.565Z]   github.com/pingcap/tidb/domain/infosync.StoreInternalSession()
[2022-04-13T04:26:28.565Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/infosync/info.go:1067 +0x3d
[2022-04-13T04:26:28.565Z]   github.com/pingcap/tidb/session.(*session).getInternalSession()
[2022-04-13T04:26:28.565Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1724 +0x5a9
[2022-04-13T04:26:28.565Z]   github.com/pingcap/tidb/session.(*session).withRestrictedSQLExecutor()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1755 +0x2f4
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.(*session).ExecRestrictedSQL()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1773 +0x124
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/bindinfo.(*BindHandle).Update()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/bindinfo/handle.go:138 +0x1e9
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop.func1()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1119 +0x2be
[2022-04-13T04:26:28.566Z] 
[2022-04-13T04:26:28.566Z] Previous write at 0x00c000d2f4d8 by main goroutine:
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain/infosync.(*InfoSyncer).SetSessionManager()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/infosync/info.go:213 +0x593
[2022-04-13T04:26:28.566Z]   main.createServer()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:695 +0x58a
[2022-04-13T04:26:28.566Z]   main.main()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:205 +0x604
[2022-04-13T04:26:28.566Z] 
[2022-04-13T04:26:28.566Z] Goroutine 92 (running) created at:
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1102 +0xef
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).LoadBindInfoLoop()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1095 +0x1a4
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.BootstrapSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:2824 +0x4a5
[2022-04-13T04:26:28.566Z]   main.createStoreAndDomain()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:298 +0x113
[2022-04-13T04:26:28.566Z]   main.main()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:204 +0x5e9
[2022-04-13T04:26:28.566Z] ==================
[2022-04-13T04:26:28.566Z] ==================
[2022-04-13T04:26:28.566Z] WARNING: DATA RACE
[2022-04-13T04:26:28.566Z] Write at 0x00c000e8a8ac by goroutine 92:
[2022-04-13T04:26:28.566Z]   sync/atomic.CompareAndSwapInt32()
[2022-04-13T04:26:28.566Z]       /usr/local/go/src/runtime/race_amd64.s:308 +0xb
[2022-04-13T04:26:28.566Z]   sync/atomic.CompareAndSwapInt32()
[2022-04-13T04:26:28.566Z]       <autogenerated>:1 +0x1e
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/server.(*Server).StoreInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/server/server.go:808 +0x48
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain/infosync.StoreInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/infosync/info.go:1071 +0x6b
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.(*session).getInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1724 +0x5a9
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.(*session).withRestrictedSQLExecutor()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1755 +0x2f4
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.(*session).ExecRestrictedSQL()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1773 +0x124
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/bindinfo.(*BindHandle).Update()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/bindinfo/handle.go:138 +0x1e9
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop.func1()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1119 +0x2be
[2022-04-13T04:26:28.566Z] 
[2022-04-13T04:26:28.566Z] Previous write at 0x00c000e8a8a8 by main goroutine:
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/server.NewServer()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/server/server.go:192 +0x1b9
[2022-04-13T04:26:28.566Z]   main.createServer()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:686 +0xdc
[2022-04-13T04:26:28.566Z]   main.main()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:205 +0x604
[2022-04-13T04:26:28.566Z] 
[2022-04-13T04:26:28.566Z] Goroutine 92 (running) created at:
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1102 +0xef
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain.(*Domain).LoadBindInfoLoop()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1095 +0x1a4
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.BootstrapSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:2824 +0x4a5
[2022-04-13T04:26:28.566Z]   main.createStoreAndDomain()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:298 +0x113
[2022-04-13T04:26:28.566Z]   main.main()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:204 +0x5e9
[2022-04-13T04:26:28.566Z] ==================
[2022-04-13T04:26:28.566Z] ==================
[2022-04-13T04:26:28.566Z] WARNING: DATA RACE
[2022-04-13T04:26:28.566Z] Read at 0x00c000e8a8b8 by goroutine 92:
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/server.(*Server).StoreInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/server/server.go:809 +0x6d
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/domain/infosync.StoreInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/infosync/info.go:1071 +0x6b
[2022-04-13T04:26:28.566Z]   github.com/pingcap/tidb/session.(*session).getInternalSession()
[2022-04-13T04:26:28.566Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1724 +0x5a9
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/session.(*session).withRestrictedSQLExecutor()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1755 +0x2f4
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/session.(*session).ExecRestrictedSQL()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:1773 +0x124
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/bindinfo.(*BindHandle).Update()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/bindinfo/handle.go:138 +0x1e9
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop.func1()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1119 +0x2be
[2022-04-13T04:26:28.567Z] 
[2022-04-13T04:26:28.567Z] Previous write at 0x00c000e8a8b8 by main goroutine:
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/server.NewServer()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/server/server.go:192 +0x1b9
[2022-04-13T04:26:28.567Z]   main.createServer()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:686 +0xdc
[2022-04-13T04:26:28.567Z]   main.main()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:205 +0x604
[2022-04-13T04:26:28.567Z] 
[2022-04-13T04:26:28.567Z] Goroutine 92 (running) created at:
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/domain.(*Domain).globalBindHandleWorkerLoop()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1102 +0xef
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/domain.(*Domain).LoadBindInfoLoop()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/domain/domain.go:1095 +0x1a4
[2022-04-13T04:26:28.567Z]   github.com/pingcap/tidb/session.BootstrapSession()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/session/session.go:2824 +0x4a5
[2022-04-13T04:26:28.567Z]   main.createStoreAndDomain()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:298 +0x113
[2022-04-13T04:26:28.567Z]   main.main()
[2022-04-13T04:26:28.567Z]       /home/jenkins/agent/workspace/tidb_ghpr_check_2/go/src/github.com/pingcap/tidb/tidb-server/main.go:204 +0x5e9
[2022-04-13T04:26:28.567Z] ==================
```
