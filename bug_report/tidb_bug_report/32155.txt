ID: 32155
Title: DATA RACE in the ```testIntegrationSuite2```
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

```
==================
WARNING: DATA RACE
Write at 0x00c0001103d0 by goroutine 136:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:22 +0x8b
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setUpSuite()
      /go/tidb/ddl/db_test.go:120 +0x2fc
  github.com/pingcap/tidb/ddl_test.(*testDBSuite).SetUpSuite()
      /go/tidb/ddl/db_test.go:142 +0x36
  github.com/pingcap/tidb/ddl_test.(*testDBSuite5).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Previous write at 0x00c0001103d0 by goroutine 124:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:22 +0x8b
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setupIntegrationSuite()
      /go/tidb/ddl/db_integration_test.go:88 +0x26f
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite).SetUpSuite()
      /go/tidb/ddl/db_integration_test.go:114 +0x36
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite2).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Goroutine 136 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
Goroutine 124 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
==================
==================
WARNING: DATA RACE
Write at 0x000007ed9428 by goroutine 136:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:26 +0x1ef
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setUpSuite()
      /go/tidb/ddl/db_test.go:120 +0x2fc
  github.com/pingcap/tidb/ddl_test.(*testDBSuite).SetUpSuite()
      /go/tidb/ddl/db_test.go:142 +0x36
  github.com/pingcap/tidb/ddl_test.(*testDBSuite5).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Previous write at 0x000007ed9428 by goroutine 124:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:26 +0x1ef
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setupIntegrationSuite()
      /go/tidb/ddl/db_integration_test.go:88 +0x26f
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite).SetUpSuite()
      /go/tidb/ddl/db_integration_test.go:114 +0x36
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite2).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Goroutine 136 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
Goroutine 124 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
==================
==================
WARNING: DATA RACE
Write at 0x000007ed8428 by goroutine 136:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:27 +0x28f
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setUpSuite()
      /go/tidb/ddl/db_test.go:120 +0x2fc
  github.com/pingcap/tidb/ddl_test.(*testDBSuite).SetUpSuite()
      /go/tidb/ddl/db_test.go:142 +0x36
  github.com/pingcap/tidb/ddl_test.(*testDBSuite5).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Previous write at 0x000007ed8428 by goroutine 124:
  github.com/pingcap/tidb/util/collate.switchDefaultCollation()
      /go/tidb/util/collate/charset.go:27 +0x28f
  github.com/pingcap/tidb/util/collate.SetNewCollationEnabledForTest()
      /go/tidb/util/collate/collate.go:84 +0x26
  github.com/pingcap/tidb/session.BootstrapSession()
      /go/tidb/session/session.go:2657 +0x32d
  github.com/pingcap/tidb/ddl_test.setupIntegrationSuite()
      /go/tidb/ddl/db_integration_test.go:88 +0x26f
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite).SetUpSuite()
      /go/tidb/ddl/db_integration_test.go:114 +0x36
  github.com/pingcap/tidb/ddl_test.(*testIntegrationSuite2).SetUpSuite()
      <autogenerated>:1 +0x56
  runtime.call16()
      /usr/local/go/src/runtime/asm_amd64.s:625 +0x48
  reflect.Value.Call()
      /usr/local/go/src/reflect/value.go:339 +0xd7
  github.com/pingcap/check.(*suiteRunner).runFixture.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:799 +0x245
  github.com/pingcap/check.(*suiteRunner).forkCall.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x12b
Goroutine 136 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
Goroutine 124 (running) created at:
  github.com/pingcap/check.(*suiteRunner).forkCall()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x5e4
  github.com/pingcap/check.(*suiteRunner).runFunc()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:751 +0x67
  github.com/pingcap/check.(*suiteRunner).runFixture()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:795 +0x45
  github.com/pingcap/check.(*suiteRunner).asyncRun.func1()
      /home/prow/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:647 +0x84
================== 
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

