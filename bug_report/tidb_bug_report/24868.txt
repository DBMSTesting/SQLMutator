ID: 24868
Title: v4.0.13 report inconsistent index handles
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)
MySQL [tptest]> select txn, seq, stmt, is_query from stmt where test_id = "37b7a23b-af9e-4e8f-82d4-76699d877361";
ERROR 1105 (HY000): inconsistent index PRIMARY handle count 146 isn't equal to value count 0
MySQL [tptest]> 

-----------------------------------------------------------------------------------------------------------------------------------------------------------+
| stmt  | CREATE TABLE `stmt` (
  `test_id` char(36) NOT NULL,
  `seq` int(11) NOT NULL,
  `txn` int(11) NOT NULL,
  `stmt` text NOT NULL,
  `is_query` tinyint(1) DEFAULT NULL,
  PRIMARY KEY (`test_id`,`seq`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_bin |
+-------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)
[2021/05/24 22:28:35.006 +08:00] [ERROR] [distsql.go:1044] ["inconsistent index handles"] [conn=10] [index=PRIMARY] [index_cnt=146] [table_cnt=0] [missing_handles="[612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049,612489557912322049]"] ...
[2021/05/24 22:28:35.007 +08:00] [INFO] [conn.go:800] ["command dispatched failed"] [conn=10] [connInfo="id:10, addr:172.16.5.197:38870 status:11, collation:utf8mb4_general_ci, user:root"] [command=Execute] [status="inTxn:1, autocommit:1"] [sql="select txn, seq, stmt, is_query from stmt where test_id = ? order by txn, seq [arguments: 37b7a23b-af9e-4e8f-82d4-76699d877361]"] [txn_mode=PESSIMISTIC] [err="inconsistent index PRIMARY handle count 146 isn't equal to value count 0\ngithub.com/pingcap/tidb/executor.(*tableWorker).executeTask\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/executor/distsql.go:1051\ngithub.com/pingcap/tidb/executor.(*tableWorker).pickAndExecTask\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/executor/distsql.go:867\ngithub.com/pingcap/tidb/executor.(*IndexLookUpExecutor).startTableWorker.func1\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/executor/distsql.go:524\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1357\nselect txn, seq, stmt, is_query from stmt where test_id = ? order by txn, seq [arguments: 37b7a23b-af9e-4e8f-82d4-76699d877361]"]

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

| Release Version: v4.0.13
Edition: Community
Git Commit Hash: 57fa70a90d62222578a8f050a0ba24547d91327c
Git Branch: heads/refs/tags/v4.0.13
UTC Build Time: 2021-05-24 09:13:43
GoVersion: go1.13
Race Enabled: false
TiKV Min Version: v3.0.0-60965b006877ca7234adaced7890d7b029ed1306
Check Table Before Drop: false |