ID: 17700
Title: data race in TestNoneAccessPathsFoundByIsolationRead
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

<!-- a step by step guide for reproducing the bug. -->
```
[2020-06-05T02:04:52.544Z] ==================

[2020-06-05T02:04:52.544Z] WARNING: DATA RACE

[2020-06-05T02:04:52.544Z] Write at 0x00c00023ced0 by goroutine 279:

[2020-06-05T02:04:52.544Z]   github.com/pingcap/tidb/planner/core_test.(*testIntegrationSerialSuite).TestNoneAccessPathsFoundByIsolationRead()

[2020-06-05T02:04:52.544Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/planner/core/integration_test.go:304 +0x614

[2020-06-05T02:04:52.544Z]   github.com/pingcap/tidb/planner/core_test.(*testIntegrationSerialSuite).TestNoneAccessPathsFoundByIsolationRead()

[2020-06-05T02:04:52.544Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/planner/core/integration_test.go:286 +0x166

[2020-06-05T02:04:52.544Z]   runtime.call32()

[2020-06-05T02:04:52.544Z]       /usr/local/go/src/runtime/asm_amd64.s:539 +0x3a

[2020-06-05T02:04:52.545Z]   reflect.Value.Call()

[2020-06-05T02:04:52.545Z]       /usr/local/go/src/reflect/value.go:321 +0xd3

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkTest.func1()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:850 +0x9aa

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkCall.func1()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x113

[2020-06-05T02:04:52.545Z] 

[2020-06-05T02:04:52.545Z] Previous read at 0x00c00023ced0 by goroutine 332:

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/sessionctx/variable.NewSessionVars()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/sessionctx/variable/session.go:760 +0x1093

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/util/mock.NewContext()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/util/mock/context.go:272 +0x9f

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/mockstore/unistore/cophandler.newClosureExecutor()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/mockstore/unistore/cophandler/closure_exec.go:117 +0x1ec

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/mockstore/unistore/cophandler.buildClosureExecutor()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/mockstore/unistore/cophandler/closure_exec.go:56 +0x60

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/mockstore/unistore/cophandler.handleCopDAGRequest()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/mockstore/unistore/cophandler/cop_handler.go:75 +0x1cb

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/mockstore/unistore/cophandler.HandleCopRequest()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/mockstore/unistore/cophandler/cop_handler.go:47 +0x269

[2020-06-05T02:04:52.545Z]   github.com/ngaut/unistore/tikv.(*Server).Coprocessor()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/ngaut/unistore@v0.0.0-20200604061006-d8e9dc0ad154/tikv/server.go:474 +0x3ff

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/mockstore/unistore.(*RPCClient).SendRequest()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/mockstore/unistore/rpc.go:161 +0x2cde

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.reqCollapse.SendRequest()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/client_collapse.go:49 +0x17d

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*reqCollapse).SendRequest()

[2020-06-05T02:04:52.545Z]       <autogenerated>:1 +0xc5

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).sendReqToRegion()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:253 +0x1d0

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*RegionRequestSender).SendReqCtx()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/region_request.go:216 +0x52f

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*clientHelper).SendReqCtx()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:844 +0x1fd

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*copIteratorWorker).handleTaskOnce()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:751 +0x948

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*copIteratorWorker).handleTask()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:686 +0x205

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*copIteratorWorker).run()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:493 +0x141

[2020-06-05T02:04:52.545Z] 

[2020-06-05T02:04:52.545Z] Goroutine 279 (running) created at:

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkCall()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:734 +0x4a3

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkTest()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:832 +0x1b9

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).doRun()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:666 +0x13a

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).run()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:696 +0x13f

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.Run()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/run.go:150 +0x5a

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.RunAll()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/run.go:136 +0x906

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.TestingT()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/run.go:99 +0x751

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/planner/core.TestT()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/planner/core/logical_plan_test.go:45 +0x4f

[2020-06-05T02:04:52.545Z]   testing.tRunner()

[2020-06-05T02:04:52.545Z]       /usr/local/go/src/testing/testing.go:909 +0x199

[2020-06-05T02:04:52.545Z] 

[2020-06-05T02:04:52.545Z] Goroutine 332 (finished) created at:

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*copIterator).open()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:528 +0x12a

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/store/tikv.(*CopClient).Send()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/store/tikv/coprocessor.go:93 +0x83b

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/distsql.Select()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/distsql/distsql.go:48 +0x223

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/distsql.SelectWithRuntimeStats()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/distsql/distsql.go:96 +0xb8

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/executor.selectResultHook.SelectResult()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/executor/table_reader.go:51 +0x233

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/executor.(*TableReaderExecutor).buildResp()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/executor/table_reader.go:212 +0x7fc

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/executor.(*TableReaderExecutor).Open()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/executor/table_reader.go:137 +0x5d8

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/executor.(*ExecStmt).Exec()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/executor/adapter.go:324 +0x25f

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/session.runStmt()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/session/tidb.go:276 +0x365

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/session.(*session).executeStatement()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/session/session.go:1043 +0xe7

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/session.(*session).execute()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/session/session.go:1243 +0xb2b

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/session.(*session).Execute()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/session/session.go:1086 +0xee

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/util/testkit.(*TestKit).Exec()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/util/testkit/testkit.go:151 +0x103

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/planner/core_test.(*testIntegrationSerialSuite).TestNoneAccessPathsFoundByIsolationRead()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/planner/core/integration_test.go:288 +0x19d

[2020-06-05T02:04:52.545Z]   github.com/pingcap/tidb/planner/core_test.(*testIntegrationSerialSuite).TestNoneAccessPathsFoundByIsolationRead()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/src/github.com/pingcap/tidb/planner/core/integration_test.go:286 +0x166

[2020-06-05T02:04:52.545Z]   runtime.call32()

[2020-06-05T02:04:52.545Z]       /usr/local/go/src/runtime/asm_amd64.s:539 +0x3a

[2020-06-05T02:04:52.545Z]   reflect.Value.Call()

[2020-06-05T02:04:52.545Z]       /usr/local/go/src/reflect/value.go:321 +0xd3

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkTest.func1()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:850 +0x9aa

[2020-06-05T02:04:52.545Z]   github.com/pingcap/check.(*suiteRunner).forkCall.func1()

[2020-06-05T02:04:52.545Z]       /home/jenkins/agent/workspace/tidb_ghpr_unit_test/go/pkg/mod/github.com/pingcap/check@v0.0.0-20200212061837-5e12011dc712/check.go:739 +0x113

[2020-06-05T02:04:52.545Z] ==================


```

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. Affected version (Required)

<!-- v3.0.0, v4.0.0, etc -->
https://internal.pingcap.net/idc-jenkins/blue/organizations/jenkins/tidb_ghpr_unit_test/detail/tidb_ghpr_unit_test/38790/pipeline/

Seen at https://github.com/pingcap/tidb/pull/16819
### 5. Root Cause Analysis


<!-- should be filled by the investigator before it's closed -->
