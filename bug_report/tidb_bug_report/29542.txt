ID: 29542
Title: Dumpling disconnected during the chunk division stage without retrying, causing the backup to fail
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

**1. Minimal reproduce step (Required)**

Dumpling disconnected during the chunk division stage without retrying, causing the backup to fail

**2. What did you expect to see? (Required)**
You can try again after the network is disconnected

**3. What did you see instead (Required)**
dumpling logï¼š

[2021/11/05 08:19:02.948 +08:00] [INFO] [status.go:38] [progress] [tables="508/691 (73.5%)"] ["finished rows"=12773265170] ["estimate total rows"=13676037182] ["finished size"=2.302TB] ["average speed(MiB/s)"=79.39659101555272]
[2021/11/05 08:21:02.948 +08:00] [INFO] [status.go:38] [progress] [tables="513/691 (74.2%)"] ["finished rows"=12847763818] ["estimate total rows"=13676037182] ["finished size"=2.312TB] ["average speed(MiB/s)"=78.26378799489348]
[mysql] 2021/11/05 08:22:10 packets.go:36: read tcp 10.162.13.150:42654->10.148.5.87:22300: i/o timeout
[2021/11/05 08:22:10.232 +08:00] [INFO] [collector.go:188] ["backup Failed summary : total backup ranges: 0, total success: 0, total failed: 0"]
[2021/11/05 08:22:14.389 +08:00] [ERROR] [writer_util.go:199] ["fail to scan from sql.Row"] [error="context canceled"] [errorVerbose="context canceled\ngithub.com/pingcap/errors.AddStack\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/errors.go:174\ngithub.com/pingcap/errors.Trace\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/juju_adaptor.go:15\ngithub.com/pingcap/dumpling/v4/export.decodeFromRows\n\tgithub.com/pingcap/dumpling@/v4/export/ir.go:68\ngithub.com/pingcap/dumpling/v4/export.(*multiQueriesChunkIter).Decode\n\tgithub.com/pingcap/dumpling@/v4/export/ir_impl.go:139\ngithub.com/pingcap/dumpling/v4/export.WriteInsert\n\tgithub.com/pingcap/dumpling@/v4/export/writer_util.go:198\ngithub.com/pingcap/dumpling/v4/export.FileFormat.WriteInsert\n\tgithub.com/pingcap/dumpling@/v4/export/writer_util.go:600\ngithub.com/pingcap/dumpling/v4/export.(*Writer).tryToWriteTableData\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:204\ngithub.com/pingcap/dumpling/v4/export.(*Writer).WriteTableData.func1\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:189\ngithub.com/pingcap/br/pkg/utils.WithRetry\n\tgithub.com/pingcap/br@v4.0.0-beta.2.0.20210203034957-7bc483ab69d5+incompatible/pkg/utils/retry.go:34\ngithub.com/pingcap/dumpling/v4/export.(*Writer).WriteTableData\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:160\ngithub.com/pingcap/dumpling/v4/export.(*Writer).handleTask\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:103\ngithub.com/pingcap/dumpling/v4/export.(*Writer).run\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:85\ngithub.com/pingcap/dumpling/v4/export.(*Dumper).startWriters.func4\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:273\ngolang.org/x/sync/errgroup.(*Group).Go.func1\n\tgolang.org/x/sync@v0.0.0-20201020160332-67f06af15bc9/errgroup/errgroup.go:57\nruntime.goexit\n\truntime/asm_amd64.s:1357"]
[2021/11/05 08:22:14.390 +08:00] [ERROR] [writer_util.go:199] ["fail to scan from sql.Row"] [error="context canceled"] [errorVerbose="context canceled\ngithub.com/pingcap/errors.AddStack\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/errors.go:174\ngithub.com/pingcap/errors.Trace\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/juju_adaptor.go:15\ngithub.com/pingcap/dumpling/v4/export.decodeFromRows\n\tgithub.com/pingcap/dumpling@/v4/export/ir.go:68\ngithub.com/pingcap/dumpling/v4/export.(*multiQueriesChunkIter).Decode\n\tgithub.com/pingcap/dumpling@/v4/export/ir_impl.go:139\ngithub.com/pingcap/dumpling/v4/export.WriteInsert\n\tgithub.com/pingcap/dumpling@/v4/export/writer_util.go:198\ngithub.com/pingcap/dumpling/v4/export.FileFormat.WriteInsert\n\tgithub.com/pingcap/dumpling@/v4/export/writer_util.go:600\ngithub.com/pingcap/dumpling/v4/export.(*Writer).tryToWriteTableData\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:204\ngithub.com/pingcap/dumpling/v4/export.(*Writer).WriteTableData.func1\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:189\ngithub.com/pingcap/br/pkg/utils.WithRetry\n\tgithub.com/pingcap/br@v4.0.0-beta.2.0.20210203034957-7bc483ab69d5+incompatible/pkg/utils/retry.go:34\ngithub.com/pingcap/dumpling/v4/export.(*Writer).WriteTableData\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:160\ngithub.com/pingcap/dumpling/v4/export.(*Writer).handleTask\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:103\ngithub.com/pingcap/dumpling/v4/export.(*Writer).run\n\tgithub.com/pingcap/dumpling@/v4/export/writer.go:85\ngithub.com/pingcap/dumpling/v4/export.(*Dumper).startWriters.func4\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:273\ngolang.org/x/sync/errgroup.(*Group).Go.func1\n\tgolang.org/x/sync@v0.0.0-20201020160332-67f06af15bc9/errgroup/errgroup.go:57\nruntime.goexit\n\truntime/asm_amd64.s:1357"]
[2021/11/05 08:22:14.390 +08:00] [ERROR] [main.go:77] ["dump failed error stack info"] [error="invalid connection"] [errorVerbose="invalid connection\ngithub.com/pingcap/errors.AddStack\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/errors.go:174\ngithub.com/pingcap/errors.Trace\n\tgithub.com/pingcap/errors@v0.11.5-0.20201126102027-b0a155152ca3/juju_adaptor.go:15\ngithub.com/pingcap/dumpling/v4/export.selectTiDBTableSample\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:676\ngithub.com/pingcap/dumpling/v4/export.(*Dumper).concurrentDumpTiDBTables\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:584\ngithub.com/pingcap/dumpling/v4/export.(*Dumper).concurrentDumpTable\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:446\ngithub.com/pingcap/dumpling/v4/export.(*Dumper).buildConcatTask.func1\n\tgithub.com/pingcap/dumpling@/v4/export/dump.go:347\nruntime.goexit\n\truntime/asm_amd64.s:1357"]


tidb log:
[2021/11/05 08:22:14.390 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42656: write: connection reset by peer"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeChunks\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1907\ngithub.com/pingcap/tidb/server.(*clientConn).writeResultset\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1823\ngithub.com/pingcap/tidb/server.(*clientConn).handleStmt\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1717\ngithub.com/pingcap/tidb/server.(*clientConn).handleQuery\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1563\ngithub.com/pingcap/tidb/server.(*clientConn).dispatch\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1097\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:860\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:14.391 +08:00] [WARN] [conn.go:846] ["read packet failed, close this connection"] [conn=354499] [error="read tcp 10.148.5.87:22300->10.162.13.150:42658: read: connection reset by peer"]
[2021/11/05 08:22:14.391 +08:00] [INFO] [conn.go:877] ["command dispatched failed"] [conn=354495] [connInfo="id:354495, addr:10.162.13.150:42656 status:11, collation:utf8mb4_general_ci, user:dba"] [command=Query] [status="inTxn:1, autocommit:1"] [sql="SELECT * FROM `tdb58_dw_db`.`da_the_house_source_from_claim_daily` WHERE `id`>=73187196 and `id`<74615854 ORDER BY `id`"] [txn_mode=PESSIMISTIC] [err="connection was bad\ngithub.com/pingcap/parser/mysql.init\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/mysql/error.go:24\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6309\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6286\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:208\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1371"]
[2021/11/05 08:22:14.391 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42660: write: connection reset by peer"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeChunks\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1907\ngithub.com/pingcap/tidb/server.(*clientConn).writeResultset\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1823\ngithub.com/pingcap/tidb/server.(*clientConn).handleStmt\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1717\ngithub.com/pingcap/tidb/server.(*clientConn).handleQuery\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1563\ngithub.com/pingcap/tidb/server.(*clientConn).dispatch\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1097\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:860\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:14.391 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42656: write: connection reset by peer"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeError\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1253\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:885\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:14.391 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="connection was bad"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:886\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:14.391 +08:00] [INFO] [conn.go:877] ["command dispatched failed"] [conn=354503] [connInfo="id:354503, addr:10.162.13.150:42660 status:11, collation:utf8mb4_general_ci, user:dba"] [command=Query] [status="inTxn:1, autocommit:1"] [sql="SELECT * FROM `tdb58_dw_db`.`da_broker_authorize_ldt_daily` WHERE `id`>=1563341723 and `id`<1564215510 ORDER BY `id`"] [txn_mode=PESSIMISTIC] [err="connection was bad\ngithub.com/pingcap/parser/mysql.init\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/mysql/error.go:24\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6309\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6286\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:208\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1371"]
[2021/11/05 08:22:14.392 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42660: write: connection reset by peer"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeError\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1253\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:885\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:14.392 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="connection was bad"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:886\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.316 +08:00] [INFO] [coprocessor.go:807] ["[TIME_COP_PROCESS] resp_time:1.891872786s txnStartTS:428879228955262977 region_id:859641 store_addr:10.135.4.165:22320 kv_process_ms:1419 kv_wait_ms:1 kv_read_ms:1048 processed_versions:376692 total_versions:376693 rocksdb_delete_skipped_count:0 rocksdb_key_skipped_count:380348 rocksdb_cache_hit_count:30 rocksdb_read_count:1528 rocksdb_read_byte:30376595"]
[2021/11/05 08:22:15.319 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42659: write: broken pipe"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeChunks\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1907\ngithub.com/pingcap/tidb/server.(*clientConn).writeResultset\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1823\ngithub.com/pingcap/tidb/server.(*clientConn).handleStmt\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1717\ngithub.com/pingcap/tidb/server.(*clientConn).handleQuery\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1563\ngithub.com/pingcap/tidb/server.(*clientConn).dispatch\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1097\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:860\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.320 +08:00] [INFO] [conn.go:877] ["command dispatched failed"] [conn=354501] [connInfo="id:354501, addr:10.162.13.150:42659 status:11, collation:utf8mb4_general_ci, user:dba"] [command=Query] [status="inTxn:1, autocommit:1"] [sql="SELECT * FROM `tdb58_dw_db`.`da_qf_v20_apply_panshi_company_detail_daily` WHERE `id`>=317933772 and `id`<318310464 ORDER BY `id`"] [txn_mode=PESSIMISTIC] [err="connection was bad\ngithub.com/pingcap/parser/mysql.init\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/mysql/error.go:24\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6309\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6286\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:208\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1371"]
[2021/11/05 08:22:15.320 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42659: write: broken pipe"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeError\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1253\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:885\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.320 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="connection was bad"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:886\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.551 +08:00] [INFO] [coprocessor.go:807] ["[TIME_COP_PROCESS] resp_time:2.232372532s txnStartTS:428879228955262977 region_id:2197438 store_addr:10.135.8.215:22320 kv_process_ms:1652 kv_wait_ms:0 kv_read_ms:1160 processed_versions:532868 total_versions:532869 rocksdb_delete_skipped_count:0 rocksdb_key_skipped_count:532946 rocksdb_cache_hit_count:33 rocksdb_read_count:1569 rocksdb_read_byte:17672201"]
[2021/11/05 08:22:15.554 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42657: write: broken pipe"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeChunks\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1907\ngithub.com/pingcap/tidb/server.(*clientConn).writeResultset\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1823\ngithub.com/pingcap/tidb/server.(*clientConn).handleStmt\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1717\ngithub.com/pingcap/tidb/server.(*clientConn).handleQuery\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1563\ngithub.com/pingcap/tidb/server.(*clientConn).dispatch\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1097\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:860\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.555 +08:00] [INFO] [conn.go:877] ["command dispatched failed"] [conn=354497] [connInfo="id:354497, addr:10.162.13.150:42657 status:11, collation:utf8mb4_general_ci, user:dba"] [command=Query] [status="inTxn:1, autocommit:1"] [sql="SELECT * FROM `tdb58_dw_db`.`da_aifang_company_detail_npms_daily` WHERE `id`>=273059302 and `id`<273706186 ORDER BY `id`"] [txn_mode=PESSIMISTIC] [err="connection was bad\ngithub.com/pingcap/parser/mysql.init\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/mysql/error.go:24\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6309\nruntime.doInit\n\t/usr/local/go/src/runtime/proc.go:6286\nruntime.main\n\t/usr/local/go/src/runtime/proc.go:208\nruntime.goexit\n\t/usr/local/go/src/runtime/asm_amd64.s:1371"]
[2021/11/05 08:22:15.555 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="write tcp 10.148.5.87:22300->10.162.13.150:42657: write: broken pipe"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*packetIO).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/packetio.go:173\ngithub.com/pingcap/tidb/server.(*clientConn).writePacket\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:370\ngithub.com/pingcap/tidb/server.(*clientConn).writeError\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:1253\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:885\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:15.555 +08:00] [ERROR] [terror.go:291] ["encountered error"] [error="connection was bad"] [stack="github.com/pingcap/parser/terror.Log\n\t/nfs/cache/mod/github.com/pingcap/parser@v0.0.0-20210618053735-57843e8185c4/terror/terror.go:291\ngithub.com/pingcap/tidb/server.(*clientConn).Run\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/conn.go:886\ngithub.com/pingcap/tidb/server.(*Server).onConn\n\t/home/jenkins/agent/workspace/optimization-build-tidb-linux-amd/go/src/github.com/pingcap/tidb/server/server.go:485"]
[2021/11/05 08:22:18.439 +08:00] [INFO] [grpclogger.go:77] ["ccResolverWrapper: sending new addresses to cc: [{http://10.132.24.5:22350  <nil> 0 <nil>} {http://10.132.6.89:22350  <nil> 0 <nil>} {http://10.132.98.25:22350  <nil> 0 <nil>}]"] [system=grpc] [grpc_log=true]
[2021/11/05 08:22:24.546 +08:00] [WARN] [grpclogger.go:85] ["grpc: Server.Serve failed to create ServerTransport: connection error: desc = \"transport: http2Server.HandleStreams failed to receive the preface from client: EOF\""] [system=grpc] [grpc_log=true]



**4. What is your TiDB version? (Required)**
dumpling:v5.0.2
