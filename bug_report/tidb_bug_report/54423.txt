ID: 54423
Title: DATA RACE at the infoschema_v2.Data.specials
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

```
==================
WARNING: DATA RACE
Write at 0x00c0266de978 by goroutine 77687:
  github.com/pingcap/tidb/pkg/infoschema.(*Data).addSpecialDB()
      pkg/infoschema/infoschema_v2.go:226 +0x1da
  github.com/pingcap/tidb/pkg/infoschema.(*Builder).addDB()
      pkg/infoschema/builder.go:942 +0x150
  github.com/pingcap/tidb/pkg/infoschema.(*Builder).createSchemaTablesForDB()
      pkg/infoschema/builder.go:934 +0x5c4
  github.com/pingcap/tidb/pkg/infoschema.(*Builder).initVirtualTables()
      pkg/infoschema/builder.go:849 +0xc9
  github.com/pingcap/tidb/pkg/infoschema.(*Builder).InitWithDBInfos()
      pkg/infoschema/builder.go:882 +0x346
  github.com/pingcap/tidb/pkg/domain.(*Domain).loadInfoSchema()
      pkg/domain/domain.go:322 +0xb46
  github.com/pingcap/tidb/pkg/domain.(*Domain).Reload()
      pkg/domain/domain.go:628 +0x258
  github.com/pingcap/tidb/pkg/domain.(*Domain).loadSchemaInLoop()
      pkg/domain/domain.go:936 +0x558
  github.com/pingcap/tidb/pkg/domain.(*Domain).Init.func2()
      pkg/domain/domain.go:1310 +0x54
  github.com/pingcap/tidb/pkg/util.(*WaitGroupEnhancedWrapper).Run.func1()
      pkg/util/wait_group_wrapper.go:99 +0xd2
Previous read at 0x00c0266de978 by goroutine 40878:
  github.com/pingcap/tidb/pkg/infoschema.(*infoschemaV2).allSchemas()
      pkg/infoschema/infoschema_v2.go:593 +0x186
  github.com/pingcap/tidb/pkg/infoschema.(*infoschemaV2).AllSchemaNames()
      pkg/infoschema/infoschema_v2.go:607 +0xeb
  github.com/pingcap/tidb/pkg/infoschema.(*SessionExtendedInfoSchema).AllSchemaNames()
      <autogenerated>:1 +0x43
  github.com/pingcap/tidb/pkg/executor.(*memtableRetriever).retrieve()
      pkg/executor/infoschema_reader.go:115 +0x74d
  github.com/pingcap/tidb/pkg/executor.(*MemTableReaderExec).Next()
      pkg/executor/memtable_reader.go:120 +0x44e
  github.com/pingcap/tidb/pkg/executor/internal/exec.Next()
      pkg/executor/internal/exec/executor.go:410 +0x418
  github.com/pingcap/tidb/pkg/executor.(*ExecStmt).next()
      pkg/executor/adapter.go:1241 +0x84
  github.com/pingcap/tidb/pkg/executor.(*recordSet).Next()
      pkg/executor/adapter.go:169 +0x219
  github.com/pingcap/tidb/pkg/session.(*execStmtResult).Next()
      <autogenerated>:1 +0x6c
  github.com/pingcap/tidb/pkg/session.GetRows4Test()
      pkg/session/tidb.go:346 +0xd2
  github.com/pingcap/tidb/pkg/session.ResultSetToStringSlice()
      pkg/session/tidb.go:364 +0xa7
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).ResultSetToResultWithCtx()
      pkg/testkit/testkit.go:273 +0xac
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).MustQueryWithContext()
      pkg/testkit/testkit.go:199 +0x2e4
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).MustQuery()
      pkg/testkit/testkit.go:174 +0x106
  pkg/infoschema/test/clustertablestest/clustertablestest_test.TestAttributes()
      pkg/infoschema/test/clustertablestest/tables_test.go:1288 +0x1ac
  github.com/pingcap/tidb/pkg/sessionctx/variable.(*SysVar).Validate()
      pkg/sessionctx/variable/variable.go:305 +0x123
  github.com/pingcap/tidb/pkg/session.(*session).SetGlobalSysVar()
      pkg/session/session.go:1343 +0xd2
  github.com/pingcap/tidb/pkg/executor.(*SetExecutor).setSysVariable()
      pkg/executor/set.go:155 +0x74d
  github.com/pingcap/tidb/pkg/executor.(*SetExecutor).Next()
      pkg/executor/set.go:105 +0xee6
  github.com/pingcap/tidb/pkg/executor/internal/exec.Next()
      pkg/executor/internal/exec/executor.go:410 +0x418
  github.com/pingcap/tidb/pkg/executor.(*ExecStmt).next()
      pkg/executor/adapter.go:1241 +0x84
  github.com/pingcap/tidb/pkg/executor.(*ExecStmt).handleNoDelayExecutor()
      pkg/executor/adapter.go:990 +0x55b
  github.com/pingcap/tidb/pkg/executor.(*ExecStmt).handleNoDelay()
      pkg/executor/adapter.go:824 +0x3ca
  github.com/pingcap/tidb/pkg/executor.(*ExecStmt).Exec()
      pkg/executor/adapter.go:588 +0x12a6
  github.com/pingcap/tidb/pkg/session.runStmt()
      pkg/session/session.go:2296 +0x5d3
  github.com/pingcap/tidb/pkg/session.(*session).ExecuteStmt()
      pkg/session/session.go:2157 +0x1ac4
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).ExecWithContext()
      pkg/testkit/testkit.go:385 +0xe29
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).MustExecWithContext()
      pkg/testkit/testkit.go:157 +0xab
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).MustExec()
      pkg/testkit/testkit.go:152 +0x128
  github.com/pingcap/tidb/pkg/testkit.(*TestKit).RefreshSession()
      pkg/testkit/testkit.go:124 +0x3a5
  github.com/pingcap/tidb/pkg/testkit.NewTestKit()
      pkg/testkit/testkit.go:84 +0x49d
  pkg/infoschema/test/clustertablestest/clustertablestest_test.newTestKitWithRoot()
      pkg/infoschema/test/clustertablestest/tables_test.go:53 +0x54
  pkg/infoschema/test/clustertablestest/clustertablestest_test.TestAttributes()
      pkg/infoschema/test/clustertablestest/tables_test.go:1282 +0x5c
  github.com/pingcap/tidb/pkg/sessionctx/variable.parseMemoryLimit()
      pkg/sessionctx/variable/varsutil.go:375 +0x18b
  github.com/pingcap/tidb/pkg/sessionctx/variable.glob..func208()
      pkg/sessionctx/variable/sysvar.go:1099 +0x50
  github.com/pingcap/tidb/pkg/domain.(*Domain).rebuildSysVarCache()
      pkg/domain/sysvar_cache.go:146 +0x974
  github.com/pingcap/tidb/pkg/sessionctx/variable.glob..func207()
      pkg/sessionctx/variable/sysvar.go:1092 +0x58
  github.com/pingcap/tidb/pkg/sessionctx/variable.(*SysVar).ValidateWithRelaxedValidation()
      pkg/sessionctx/variable/variable.go:365 +0x23e
  github.com/pingcap/tidb/pkg/domain.(*Domain).rebuildSysVarCache()
      pkg/domain/sysvar_cache.go:145 +0x904
  github.com/pingcap/tidb/pkg/domain.(*Domain).LoadSysVarCacheLoop()
      pkg/domain/domain.go:1761 +0x93
  github.com/pingcap/tidb/pkg/session.bootstrapSessionImpl()
      pkg/session/session.go:3484 +0x864
  github.com/pingcap/tidb/pkg/sessionctx/variable.glob..func597()
      pkg/sessionctx/variable/sysvar.go:3153 +0x50
  github.com/pingcap/tidb/pkg/domain.(*Domain).rebuildSysVarCache()
      pkg/domain/sysvar_cache.go:146 +0x974
  github.com/pingcap/tidb/pkg/sessionctx/variable.glob..func596()
      pkg/sessionctx/variable/sysvar.go:3145 +0x58
  github.com/pingcap/tidb/pkg/sessionctx/variable.(*SysVar).ValidateWithRelaxedValidation()
      pkg/sessionctx/variable/variable.go:365 +0x23e
  github.com/pingcap/tidb/pkg/domain.(*Domain).rebuildSysVarCache()
      pkg/domain/sysvar_cache.go:145 +0x904
  github.com/pingcap/tidb/pkg/domain.(*Domain).rebuildSysVarCacheIfNeeded()
      pkg/domain/sysvar_cache.go:50 +0x1d5
  github.com/pingcap/tidb/pkg/domain.(*Domain).GetSessionCache()
      pkg/domain/sysvar_cache.go:61 +0x50
  github.com/pingcap/tidb/pkg/session.(*session).loadCommonGlobalVariablesIfNeeded()
      pkg/session/session.go:3856 +0x2ce
  github.com/pingcap/tidb/pkg/session.(*session).ExecuteStmt()
      pkg/session/session.go:2019 +0x184
  github.com/pingcap/tidb/pkg/session.(*session).ExecuteInternal()
      pkg/session/session.go:1530 +0x3b9
  github.com/pingcap/tidb/pkg/domain.(*Domain).LoadPrivilegeLoop()
      pkg/domain/domain.go:1704 +0x108
  github.com/pingcap/tidb/pkg/session.bootstrapSessionImpl()
      pkg/session/session.go:3477 +0x804
  github.com/pingcap/tidb/pkg/session.BootstrapSession()
      pkg/session/session.go:3376 +0xad
  github.com/pingcap/tidb/pkg/testkit.bootstrap()
      pkg/testkit/mockstore.go:254 +0x94
  github.com/pingcap/tidb/pkg/testkit.CreateMockStoreAndDomain()
      pkg/testkit/mockstore.go:225 +0xd2
  github.com/pingcap/tidb/pkg/testkit.CreateMockStore()
      pkg/testkit/mockstore.go:70 +0x3dd
  pkg/infoschema/test/clustertablestest/clustertablestest_test.TestAttributes()
      pkg/infoschema/test/clustertablestest/tables_test.go:1278 +0x49
  testing.tRunner()
      GOROOT/src/testing/testing.go:1595 +0x261
  testing.(*T).Run.func1()
      GOROOT/src/testing/testing.go:1648 +0x44
Goroutine 77687 (running) created at:
  github.com/pingcap/tidb/pkg/util.(*WaitGroupEnhancedWrapper).Run()
      pkg/util/wait_group_wrapper.go:94 +0x145
  github.com/pingcap/tidb/pkg/domain.(*Domain).Init()
      pkg/domain/domain.go:1309 +0x1ea4
  github.com/pingcap/tidb/pkg/session.(*domainMap).Get.func1()
      pkg/session/tidb.go:92 +0x559
  github.com/pingcap/tidb/pkg/util.RunWithRetry()
      pkg/util/misc.go:70 +0x84
  github.com/pingcap/tidb/pkg/session.(*domainMap).Get()
      pkg/session/tidb.go:79 +0x2eb
  github.com/pingcap/tidb/pkg/session.createSessionWithOpt()
      pkg/session/session.go:3696 +0x6c
  github.com/pingcap/tidb/pkg/session.createSession()
      pkg/session/session.go:3688 +0x35
  github.com/pingcap/tidb/pkg/session.createSessionsImpl()
      pkg/session/session.go:3673 +0x81
  github.com/pingcap/tidb/pkg/session.createSessions()
      pkg/session/session.go:3660 +0x44
  github.com/pingcap/tidb/pkg/session.bootstrapSessionImpl()
      pkg/session/session.go:3444 +0x4cd
  github.com/pingcap/tidb/pkg/session.BootstrapSession()
      pkg/session/session.go:3376 +0xad
  github.com/pingcap/tidb/pkg/testkit.bootstrap()
      pkg/testkit/mockstore.go:254 +0x94
  github.com/pingcap/tidb/pkg/testkit.CreateMockStoreAndDomain()
      pkg/testkit/mockstore.go:225 +0xd2
  github.com/pingcap/tidb/pkg/testkit.CreateMockStore()
      pkg/testkit/mockstore.go:70 +0x3dd
  pkg/infoschema/test/clustertablestest/clustertablestest_test.TestAttributes()
      pkg/infoschema/test/clustertablestest/tables_test.go:1278 +0x49
  testing.tRunner()
      GOROOT/src/testing/testing.go:1595 +0x261
  testing.(*T).Run.func1()
      GOROOT/src/testing/testing.go:1648 +0x44
Goroutine 40878 (running) created at:
  testing.(*T).Run()
      GOROOT/src/testing/testing.go:1648 +0x845
  testing.runTests.func1()
      GOROOT/src/testing/testing.go:2054 +0x84
  testing.tRunner()
      GOROOT/src/testing/testing.go:1595 +0x261
  testing.runTests()
      GOROOT/src/testing/testing.go:2052 +0x8ad
  testing.(*M).Run()
      GOROOT/src/testing/testing.go:1925 +0xcd7
  go.uber.org/goleak.VerifyTestMain()
      external/org_uber_go_goleak/testmain.go:53 +0x64
  pkg/infoschema/test/clustertablestest/clustertablestest_test.TestMain()
      pkg/infoschema/test/clustertablestest/main_test.go:33 +0x52a
  main.main()
      bazel-out/k8-fastbuild/bin/pkg/infoschema/test/clustertablestest/clustertablestest_test_/testmain.go:235 +0x6dc
================== 
```

https://tiprow.hawkingrei.com/view/gs/pingcapprow/logs/tidb_data_race/1808455497896955904#1:build-log.txt%3A32774

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

