ID: 33005
Title: DATA RACE in the TestTiFlashBatchRateLimiter
Description:
## Bug Report

Please answer these questions before submitting your issue. Thanks!

### 1. Minimal reproduce step (Required)

https://prow.pingcap.net/view/gs/pingcapprow/logs/tidb_race/1502117109595901952#1:build-log.txt%3A26004

```
==================
WARNING: DATA RACE
Read at 0x00c00b2e0610 by goroutine 309:
  github.com/pingcap/tidb/session.(*LazyTxn).Valid()
      /go/tidb/session/txn.go:159 +0x20b
  github.com/pingcap/tidb/session.(*session).RollbackTxn()
      /go/tidb/session/session.go:980 +0x1f1
  github.com/pingcap/tidb/session.(*session).Close()
      /go/tidb/session/session.go:2560 +0x484
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter.func4()
      /go/tidb/ddl/ddl_tiflash_test.go:890 +0x57
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run.func1()
      /go/tidb/util/wait_group_wrapper.go:33 +0x7e
Previous write at 0x00c00b2e0610 by goroutine 220:
  github.com/pingcap/tidb/session.(*LazyTxn).changeInvalidToValid()
      /go/tidb/session/txn.go:213 +0x64
  github.com/pingcap/tidb/session.(*session).NewTxn()
      /go/tidb/session/session.go:2451 +0x39b
  github.com/pingcap/tidb/executor.(*DDLExec).Next()
      /go/tidb/executor/ddl.go:134 +0x271
  github.com/pingcap/tidb/executor.Next()
      /go/tidb/executor/executor.go:302 +0x56f
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelayExecutor()
      /go/tidb/executor/adapter.go:635 +0x6c9
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelay()
      /go/tidb/executor/adapter.go:490 +0x29d
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      /go/tidb/executor/adapter.go:439 +0xc24
  github.com/pingcap/tidb/session.runStmt()
      /go/tidb/session/session.go:2005 +0x6eb
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      /go/tidb/session/session.go:1882 +0xd93
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      /go/tidb/testkit/testkit.go:215 +0x6bc
  github.com/pingcap/tidb/ddl_test.execWithTimeout.func1()
      /go/tidb/ddl/ddl_tiflash_test.go:806 +0x66
Goroutine 309 (running) created at:
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run()
      /go/tidb/util/wait_group_wrapper.go:31 +0xde
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:888 +0x7a4
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
Goroutine 220 (running) created at:
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:805 +0x1f3
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:893 +0x7ca
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c014c9f4a0 by goroutine 309:
  github.com/pingcap/tidb/store/driver/txn.(*tikvTxn).Valid()
      <autogenerated>:1 +0x3c
  github.com/pingcap/tidb/session.(*LazyTxn).Valid()
      /go/tidb/session/txn.go:159 +0x24c
  github.com/pingcap/tidb/session.(*session).RollbackTxn()
      /go/tidb/session/session.go:980 +0x1f1
  github.com/pingcap/tidb/session.(*session).Close()
      /go/tidb/session/session.go:2560 +0x484
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter.func4()
      /go/tidb/ddl/ddl_tiflash_test.go:890 +0x57
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run.func1()
      /go/tidb/util/wait_group_wrapper.go:33 +0x7e
Previous write at 0x00c014c9f4a0 by goroutine 220:
  github.com/pingcap/tidb/store/driver/txn.NewTiKVTxn()
      /go/tidb/store/driver/txn/txn_driver.go:55 +0x155
  github.com/pingcap/tidb/store/mockstore/mockstorage.newTiKVTxn()
      /go/tidb/store/mockstore/mockstorage/storage.go:108 +0x74
  github.com/pingcap/tidb/store/mockstore/mockstorage.(*mockStorage).Begin()
      /go/tidb/store/mockstore/mockstorage/storage.go:79 +0x6e
  github.com/pingcap/tidb/session.(*session).NewTxn()
      /go/tidb/session/session.go:2441 +0x1b0
  github.com/pingcap/tidb/executor.(*DDLExec).Next()
      /go/tidb/executor/ddl.go:134 +0x271
  github.com/pingcap/tidb/executor.Next()
      /go/tidb/executor/executor.go:302 +0x56f
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelayExecutor()
      /go/tidb/executor/adapter.go:635 +0x6c9
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelay()
      /go/tidb/executor/adapter.go:490 +0x29d
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      /go/tidb/executor/adapter.go:439 +0xc24
  github.com/pingcap/tidb/session.runStmt()
      /go/tidb/session/session.go:2005 +0x6eb
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      /go/tidb/session/session.go:1882 +0xd93
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      /go/tidb/testkit/testkit.go:215 +0x6bc
  github.com/pingcap/tidb/ddl_test.execWithTimeout.func1()
      /go/tidb/ddl/ddl_tiflash_test.go:806 +0x66
Goroutine 309 (running) created at:
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run()
      /go/tidb/util/wait_group_wrapper.go:31 +0xde
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:888 +0x7a4
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
Goroutine 220 (running) created at:
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:805 +0x1f3
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:893 +0x7ca
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c00beafd30 by goroutine 309:
  github.com/tikv/client-go/v2/txnkv/transaction.(*KVTxn).Valid()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.1-0.20220302130440-46d649305eee/txnkv/transaction/txn.go:827 +0x34
  github.com/pingcap/tidb/store/driver/txn.(*tikvTxn).Valid()
      <autogenerated>:1 +0x49
  github.com/pingcap/tidb/session.(*LazyTxn).Valid()
      /go/tidb/session/txn.go:159 +0x24c
  github.com/pingcap/tidb/session.(*session).RollbackTxn()
      /go/tidb/session/session.go:980 +0x1f1
  github.com/pingcap/tidb/session.(*session).Close()
      /go/tidb/session/session.go:2560 +0x484
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter.func4()
      /go/tidb/ddl/ddl_tiflash_test.go:890 +0x57
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run.func1()
      /go/tidb/util/wait_group_wrapper.go:33 +0x7e
Previous write at 0x00c00beafd30 by goroutine 220:
  github.com/tikv/client-go/v2/txnkv/transaction.NewTiKVTxn()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.1-0.20220302130440-46d649305eee/txnkv/transaction/txn.go:125 +0x324
  github.com/tikv/client-go/v2/tikv.(*KVStore).Begin()
      /home/prow/go/pkg/mod/github.com/tikv/client-go/v2@v2.0.1-0.20220302130440-46d649305eee/tikv/kv.go:274 +0x3e4
  github.com/pingcap/tidb/store/mockstore/mockstorage.(*mockStorage).Begin()
      /go/tidb/store/mockstore/mockstorage/storage.go:78 +0x64
  github.com/pingcap/tidb/session.(*session).NewTxn()
      /go/tidb/session/session.go:2441 +0x1b0
  github.com/pingcap/tidb/executor.(*DDLExec).Next()
      /go/tidb/executor/ddl.go:134 +0x271
  github.com/pingcap/tidb/executor.Next()
      /go/tidb/executor/executor.go:302 +0x56f
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelayExecutor()
      /go/tidb/executor/adapter.go:635 +0x6c9
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelay()
      /go/tidb/executor/adapter.go:490 +0x29d
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      /go/tidb/executor/adapter.go:439 +0xc24
  github.com/pingcap/tidb/session.runStmt()
      /go/tidb/session/session.go:2005 +0x6eb
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      /go/tidb/session/session.go:1882 +0xd93
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      /go/tidb/testkit/testkit.go:215 +0x6bc
  github.com/pingcap/tidb/ddl_test.execWithTimeout.func1()
      /go/tidb/ddl/ddl_tiflash_test.go:806 +0x66
Goroutine 309 (running) created at:
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run()
      /go/tidb/util/wait_group_wrapper.go:31 +0xde
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:888 +0x7a4
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
Goroutine 220 (running) created at:
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:805 +0x1f3
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:893 +0x7ca
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
==================
==================
WARNING: DATA RACE
Read at 0x00c00b4a5478 by goroutine 309:
  github.com/pingcap/tidb/session.(*session).RollbackTxn()
      /go/tidb/session/session.go:987 +0x2e9
  github.com/pingcap/tidb/session.(*session).Close()
      /go/tidb/session/session.go:2560 +0x484
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter.func4()
      /go/tidb/ddl/ddl_tiflash_test.go:890 +0x57
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run.func1()
      /go/tidb/util/wait_group_wrapper.go:33 +0x7e
Previous write at 0x00c00b4a5478 by goroutine 220:
  github.com/pingcap/tidb/session.(*session).NewTxn()
      /go/tidb/session/session.go:2453 +0x6d2
  github.com/pingcap/tidb/executor.(*DDLExec).Next()
      /go/tidb/executor/ddl.go:134 +0x271
  github.com/pingcap/tidb/executor.Next()
      /go/tidb/executor/executor.go:302 +0x56f
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelayExecutor()
      /go/tidb/executor/adapter.go:635 +0x6c9
  github.com/pingcap/tidb/executor.(*ExecStmt).handleNoDelay()
      /go/tidb/executor/adapter.go:490 +0x29d
  github.com/pingcap/tidb/executor.(*ExecStmt).Exec()
      /go/tidb/executor/adapter.go:439 +0xc24
  github.com/pingcap/tidb/session.runStmt()
      /go/tidb/session/session.go:2005 +0x6eb
  github.com/pingcap/tidb/session.(*session).ExecuteStmt()
      /go/tidb/session/session.go:1882 +0xd93
  github.com/pingcap/tidb/testkit.(*TestKit).Exec()
      /go/tidb/testkit/testkit.go:215 +0x6bc
  github.com/pingcap/tidb/ddl_test.execWithTimeout.func1()
      /go/tidb/ddl/ddl_tiflash_test.go:806 +0x66
Goroutine 309 (running) created at:
  github.com/pingcap/tidb/util.(*WaitGroupWrapper).Run()
      /go/tidb/util/wait_group_wrapper.go:31 +0xde
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:888 +0x7a4
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
Goroutine 220 (running) created at:
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:805 +0x1f3
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:893 +0x7ca
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:881 +0x67d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x493
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:868 +0x42b
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x46a
  github.com/pingcap/tidb/ddl_test.execWithTimeout()
      /go/tidb/ddl/ddl_tiflash_test.go:817 +0x3e
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:844 +0x31c
  github.com/pingcap/failpoint.parseTerm()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:149 +0x244
  github.com/pingcap/failpoint.parse()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:126 +0xa8
  github.com/pingcap/failpoint.newTerms()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/terms.go:98 +0x4d
  github.com/pingcap/failpoint.(*Failpoint).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoint.go:54 +0x44
  github.com/pingcap/failpoint.(*Failpoints).Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:105 +0x296
  github.com/pingcap/failpoint.Enable()
      /home/prow/go/pkg/mod/github.com/pingcap/failpoint@v0.0.0-20220303073211-00fea37feb66/failpoints.go:225 +0x1f1
  github.com/pingcap/tidb/ddl_test.TestTiFlashBatchRateLimiter()
      /go/tidb/ddl/ddl_tiflash_test.go:836 +0x1f2
  testing.tRunner()
      /usr/local/go/src/testing/testing.go:1259 +0x22f
  testing.(*T).Run·dwrap·21()
      /usr/local/go/src/testing/testing.go:1306 +0x47
================== 
```
<!-- a step by step guide for reproducing the bug. -->

### 2. What did you expect to see? (Required)

### 3. What did you see instead (Required)

### 4. What is your TiDB version? (Required)

<!-- Paste the output of SELECT tidb_version() -->

