
CREATE TABLE t (
  `id` BIGINT(20) NOT NULL PRIMARY KEY AUTO_INCREMENT
) ENGINE=InnoDB;

INSERT INTO t VALUES();
INSERT INTO t VALUES();
INSERT INTO t VALUES();
INSERT INTO t VALUES();
INSERT INTO t VALUES();

SELECT q.i, q.r, q.r
FROM (
  SELECT
    id AS i,
    (FLOOR(RAND(100) * 4)) AS r
  FROM t
) q;

SELECT q.r, q.r
FROM (
  SELECT (FLOOR(RAND(100) * 4)) AS r
) q;

SELECT /*+ no_merge(q) */... FROM (<subquery>) AS q;

WITH RECURSIVE one_hundred (N) AS (
  SELECT 1
  UNION ALL
  SELECT N+1 FROM one_hundred WHERE N < 100
),
randomized (RANDOM_VALUE) AS (
  SELECT RAND() AS SORT_ORDER
  FROM one_hundred
)
SELECT COUNT(*)
FROM randomized
WHERE RANDOM_VALUE <= 0.1;

EXPLAIN format=tree WITH RECURSIVE one_hundred (N) AS (
  SELECT 1
  UNION ALL
  SELECT N+1 FROM one_hundred WHERE N < 100
),
randomized (RANDOM_VALUE) AS (
  SELECT RAND() AS SORT_ORDER
  FROM one_hundred
)
SELECT COUNT(*)
FROM randomized
WHERE RANDOM_VALUE <= 0.1;

EXPLAIN format=TRADITIONAL WITH RECURSIVE one_hundred (N) AS (
  SELECT 1
  UNION ALL
  SELECT N+1 FROM one_hundred WHERE N < 100
),
randomized (RANDOM_VALUE) AS (
  SELECT RAND() AS SORT_ORDER
  FROM one_hundred
)
SELECT COUNT(*)
FROM randomized
WHERE RANDOM_VALUE <= 0.1;

SHOW WARNINGS;
