ID: 15540
Title: Crash with nullable, subquery and array join
Description:
```
SELECT                                                                                                                                                                                                                                         
    count(),                                                                                                                                                                                                                                   
    sum(ns)                                                                                                                                                                                                                                    
FROM                                                                                                                                                                                                                                           
(                                                                                                                                                                                                                                              
    SELECT intDiv(number, NULL) AS k                                                                                                                                                                                                           
    FROM system.numbers_mt                                                                                                                                                                                                                            
    GROUP BY k                                                                                                                                                                                                                                 
)                                                                                                                                                                                                                                              
ARRAY JOIN ns

2020.10.02 19:24:50.750387 [ 47305 ] {} <Trace> BaseDaemon: Received signal 11                                                                                                                                                                 
2020.10.02 19:24:50.751783 [ 50232 ] {} <Fatal> BaseDaemon: ########################################                                                                                                                                           
2020.10.02 19:24:50.752166 [ 50232 ] {} <Fatal> BaseDaemon: (version 20.10.1.1, build id: 59AA3CC2CD1B0A6E) (from thread 47603) (query_id: 4084af45-f022-466c-980e-15c5dd8225e2) Received signal Segmentation fault (11)                       
2020.10.02 19:24:50.752565 [ 50232 ] {} <Fatal> BaseDaemon: Stack trace: 0x114c5bc5 0x114c2bc2 0x114c206b 0x112f79f6 0x112dde5a 0x112d9bbf 0x112d8147 0x11509102 0x11244beb 0x11243923 0x116a794c 0x116a6a1f 0x11e279b1 0x11e34d08 0x14c6d903 0x14c6e157 0x14dd58a7 0x14dd3fe0 0x14dd2858 0x7f968ad 0x7f4ea8b3c6db 0x7f4ea845988f
2020.10.02 19:24:50.773973 [ 50232 ] {} <Fatal> BaseDaemon: 5. /home/alesap/code/cpp/ClickHouse/src/Interpreters/ExpressionAnalyzer.cpp:428: DB::ExpressionAnalyzer::makeAggregateDescriptions(std::__1::shared_ptr<DB::ActionsDAG>&) @ 0x114c5bc5 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.791784 [ 50232 ] {} <Fatal> BaseDaemon: 6. /home/alesap/code/cpp/ClickHouse/src/Interpreters/ExpressionAnalyzer.cpp:0: DB::ExpressionAnalyzer::analyzeAggregation() @ 0x114c2bc2 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.806558 [ 50232 ] {} <Fatal> BaseDaemon: 7. /home/alesap/code/cpp/ClickHouse/src/Interpreters/ExpressionAnalyzer.cpp:137: DB::ExpressionAnalyzer::ExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, unsigned long, bool) @ 0x114c206b in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.826783 [ 50232 ] {} <Fatal> BaseDaemon: 8. /home/alesap/code/cpp/ClickHouse/src/Interpreters/ExpressionAnalyzer.h:249: DB::SelectQueryExpressionAnalyzer::SelectQueryExpressionAnalyzer(std::__1::shared_ptr<DB::IAST> const&, std::__1::shared_ptr<DB::TreeRewriterResult const> const&, DB::Context const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, bool, DB::SelectQueryOptions const&) @ 0x112f79f6 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.842787 [ 50232 ] {} <Fatal> BaseDaemon: 9. /home/alesap/code/cpp/ClickHouse/contrib/libcxx/include/memory:3028: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&)::$_2::operator()(bool) const @ 0x112dde5a in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.859398 [ 50232 ] {} <Fatal> BaseDaemon: 10. /home/alesap/code/cpp/ClickHouse/src/Interpreters/InterpreterSelectQuery.cpp:405: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&) @ 0x112d9bbf in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.875940 [ 50232 ] {} <Fatal> BaseDaemon: 11. /home/alesap/code/cpp/ClickHouse/src/Interpreters/InterpreterSelectQuery.cpp:145: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x112d8147 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.891624 [ 50232 ] {} <Fatal> BaseDaemon: 12. /home/alesap/code/cpp/ClickHouse/contrib/libcxx/include/memory:0: DB::InterpreterSelectWithUnionQuery::InterpreterSelectWithUnionQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0x11509102 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.906602 [ 50232 ] {} <Fatal> BaseDaemon: 13. /home/alesap/code/cpp/ClickHouse/contrib/libcxx/include/memory:0: std::__1::__unique_if<DB::InterpreterSelectWithUnionQuery>::__unique_single std::__1::make_unique<DB::InterpreterSelectWithUnionQuery, std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions>(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::SelectQueryOptions&&) @ 0x11244beb in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.921000 [ 50232 ] {} <Fatal> BaseDaemon: 14. /home/alesap/code/cpp/ClickHouse/src/Interpreters/InterpreterFactory.cpp:0: DB::InterpreterFactory::get(std::__1::shared_ptr<DB::IAST>&, DB::Context&, DB::QueryProcessingStage::Enum) @ 0x11243923 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.937131 [ 50232 ] {} <Fatal> BaseDaemon: 15. /home/alesap/code/cpp/ClickHouse/src/Interpreters/executeQuery.cpp:0: DB::executeQueryImpl(char const*, char const*, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool, DB::ReadBuffer*) @ 0x116a794c in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.954001 [ 50232 ] {} <Fatal> BaseDaemon: 16. /home/alesap/code/cpp/ClickHouse/src/Interpreters/executeQuery.cpp:708: DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool) @ 0x116a6a1f in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.972645 [ 50232 ] {} <Fatal> BaseDaemon: 17. /home/alesap/code/cpp/ClickHouse/src/Server/TCPHandler.cpp:0: DB::TCPHandler::runImpl() @ 0x11e279b1 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:50.993298 [ 50232 ] {} <Fatal> BaseDaemon: 18. /home/alesap/code/cpp/ClickHouse/src/Server/TCPHandler.cpp:0: DB::TCPHandler::run() @ 0x11e34d08 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.014305 [ 50232 ] {} <Fatal> BaseDaemon: 19. /home/alesap/code/cpp/ClickHouse/contrib/poco/Net/src/TCPServerConnection.cpp:57: Poco::Net::TCPServerConnection::start() @ 0x14c6d903 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.035142 [ 50232 ] {} <Fatal> BaseDaemon: 20. /home/alesap/code/cpp/ClickHouse/contrib/poco/Net/src/TCPServerDispatcher.cpp:0: Poco::Net::TCPServerDispatcher::run() @ 0x14c6e157 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.056594 [ 50232 ] {} <Fatal> BaseDaemon: 21. /home/alesap/code/cpp/ClickHouse/contrib/poco/Foundation/src/ThreadPool.cpp:213: Poco::PooledThread::run() @ 0x14dd58a7 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.077906 [ 50232 ] {} <Fatal> BaseDaemon: 22. /home/alesap/code/cpp/ClickHouse/contrib/poco/Foundation/src/Thread.cpp:56: Poco::(anonymous namespace)::RunnableHolder::run() @ 0x14dd3fe0 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.098759 [ 50232 ] {} <Fatal> BaseDaemon: 23. /home/alesap/code/cpp/ClickHouse/contrib/poco/Foundation/include/Poco/SharedPtr.h:277: Poco::ThreadImpl::runnableEntry(void*) @ 0x14dd2858 in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.121458 [ 50232 ] {} <Fatal> BaseDaemon: 24. __tsan_thread_start_func @ 0x7f968ad in /home/alesap/code/cpp/BuildCH/programs/clickhouse
2020.10.02 19:24:51.121771 [ 50232 ] {} <Fatal> BaseDaemon: 25. start_thread @ 0x76db in /lib/x86_64-linux-gnu/libpthread-2.27.so
2020.10.02 19:24:51.122638 [ 50232 ] {} <Fatal> BaseDaemon: 26. /build/glibc-OTsEL5/glibc-2.27/misc/../sysdeps/unix/sysv/linux/x86_64/clone.S:97: clone @ 0x12188f in /usr/lib/debug/lib/x86_64-linux-gnu/libc-2.27.so

```                                                                                                                                                                                                    
