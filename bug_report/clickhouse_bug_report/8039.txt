ID: 8039
Title: ClickHouse servers continually grow in RAM usage.
Description:
Clickhouse-server version:19.9.5.36

My test server has insert tsv files roughly  8Gb/ 15min.
I apply a following command to load tsv files to clickhouse 

> cat /home/tmp/test*.csv.gz | gzip -dc - | awk -v pu_id=9001 'BEGIN{FS="\t";OFS="\t";}{print $0;}' | clickhouse-client --max_insert_block_size 33554432 --max_memory_usage 100000000000 -q "insert into test_toby.test format TSV"

After that I will use insert select command to generate reports.

But after running a while, ClickHouse servers continually grow in RAM usage (125G+) until server crash or trigger os to restart clickhouse.

I try to figure out why this issue happen so I open htop and insert data by previous command. I found every time I insert data, Clickhouse servers  will allocate more memory and won't release.

The attachment is my clickhouse config.

Do I need to adjust any command or parameters?

Following is one of a table I created to insert tsv data:

>  CREATE TABLE table_lte_pos_all_agg.recent (`DATA_DATE` Date, `DATA_HOUR` Nullable(Int8), `BATCH` FixedString(4), `PU_ID` Int32, `CALL_ID` Nullable(UInt64), `CALL_SEG_ID` Nullable(UInt64), `DATE_TIME` Nullable(DateTime), `DATE_TIME_MS` Nullable(Int16), `EVENT_SEQ_ID` Nullable(Int32), `ERAB_SEQ_ID` Array(Nullable(Int32)), `MSG_ID` Nullable(UInt16), `EVENT_ID` Nullable(Int16), `SERVING_ENODEB_ID` Nullable(Int32), `SERVING_CELL_ID` Nullable(Int8), `SERVING_PCI` Nullable(Int16), `SERVING_RSRP` Nullable(Float64), `SERVING_RSRQ` Nullable(Float64), `SERVING_ENODEB_ID_SCELL` Nullable(String), `SERVING_CELL_ID_SCELL` Nullable(String), `SERVING_PCI_SCELL` Nullable(String), `SERVING_RSRP_SCELL` Nullable(String), `SERVING_RSRQ_SCELL` Nullable(String), `TARGET_SITE_ID` Array(Nullable(Int32)), `TARGET_CELL_ID` Array(Nullable(Int32)), `TARGET_PU_RNC_BSC_ID` Array(Nullable(Int32)), `TARGET_TAC_LAC` Array(Nullable(Int32)), `TARGET_ARFCN` Array(Nullable(Int32)), `TARGET_PCI_PSC_BSIC` Array(Nullable(Int32)), `TARGET_RSRP_RSCP_RSSI` Array(Nullable(Float64)), `TARGET_RSRQ_ECN0` Array(Nullable(Float64)), `NBR_ENODEB_ID_SCELL` Array(Nullable(Int32)), `NBR_CELL_ID_SCELL` Array(Nullable(Int32)), `NBR_PCI_SCELL` Array(Nullable(Int32)), `NBR_RSRP_SCELL` Array(Nullable(Float64)), `NBR_RSRQ_SCELL` Array(Nullable(Float64)), `UL_TRAFFIC_DUR` Nullable(Float64), `UL_TRAFFIC_VOL` Nullable(Float64), `UL_TPT_AVG` Nullable(Float64), `UL_TPT_MAX` Nullable(Float64), `DL_TRAFFIC_DUR` Nullable(Float64), `DL_TRAFFIC_VOL` Nullable(Float64), `DL_TPT_AVG` Nullable(Float64), `DL_TPT_MAX` Nullable(Float64), `DL_TRAFFIC_DUR_OPT` Nullable(Float64), `DL_TRAFFIC_VOL_OPT` Nullable(Float64), `DL_TPT_AVG_OPT` Nullable(Float64), `ERAB_ID` Array(Nullable(Int32)), `QCI` Array(Nullable(Int32)), `TA` Nullable(UInt16), `EVENT_CAUSE_ID` Nullable(Int32), `RESULT_IND` Nullable(Int8), `FAILURE_CAUSE_ID` Nullable(Int32), `VOLTE_FLAG` Nullable(Int8), `CA_FLAG` Nullable(Int8), `APN` Nullable(String), `APN_ID` Nullable(UInt16), `MDT_SHAPE_TYPE` Nullable(Int16), `MDT_LONGITUDE` Nullable(Float64), `MDT_LATITUDE` Nullable(Float64), `MDT_ALTITUDE` Nullable(Float64), `MDT_CONFIDENCE` Nullable(Int16), `MDT_ELLIPSOID_INFO` Nullable(String), `CQI1_CNT` Array(Nullable(Int32)), `CQI2_CNT` Array(Nullable(Int32)), `CQI3_CNT` Array(Nullable(Int32)), `CQI4_CNT` Array(Nullable(Int32)), `SINR_PUSCH_CNT` Array(Nullable(Int32)), `SINR_PUCCH_CNT` Array(Nullable(Int32)), `RANK_CNT` Array(Nullable(Int32)), `MIMO_INDICATOR` Nullable(UInt16), `MIMO_TYPE` Nullable(UInt16), `MIMO_4_4_TOTAL` Nullable(UInt16), `MIMO_TOTAL` Nullable(UInt16), `MIMO_NON_MIMO_TOTAL` Nullable(UInt16), `LOC_ID` Nullable(Int64), `TILE_ID` Nullable(Int64), `TILE_LON` Nullable(Float64), `TILE_LAT` Nullable(Float64), `DISTANCE_BEST_CELL` Nullable(Float64), `DISTANCE_SERVING_CELL` Nullable(Float64), `POS_CAUSE` Nullable(Int64), `CONF` Nullable(Int8), `VAR` Nullable(UInt16), `MOVING` Nullable(Int8), `INDOOR` Nullable(Int8), `LONGITUDE` Nullable(Float64), `LATITUDE` Nullable(Float64), `ALTITUDE` Nullable(Float64), `MOVING_S` Nullable(Float64), `MOVING_T` Nullable(Int8), `MOVING_D` Nullable(Int16), `PINGPONG_TIMEGAP` Nullable(Int64), `IMSI` Nullable(String), `M_TMSI` Nullable(String), `MCC` Nullable(String), `MNC` Nullable(String), `IMSI_GROUP_ID` Nullable(Int16), `IMEI` String, `MAKE_ID` Nullable(UInt16), `MODEL_ID` Nullable(Int32), `CALL_TYPE` Nullable(Int8), `CALL_STATUS` Nullable(Int8), `BEST_RSRP_RSCP_RSSI` Nullable(Int16), `BEST_RSRQ_ECN0` Nullable(Float64), `BEST_PCI` Nullable(Int16), `BEST_ENODEB_ID` Nullable(Int32), `BEST_CELL_ID` Nullable(Int8), `SERVING_TA` Nullable(UInt16), `TAREGT_TA` Nullable(UInt16), `INTERFERED_IND` Nullable(Int8), `INTERFERED_IND_TARGET_CELL` Array(Nullable(Int32)), `PATH_LOSS` Nullable(Float64), `PATH_LOSS_TARGET_CELL` Array(Nullable(Float64)), `RSRP_GAP` Nullable(Float64), `SERVING_OVERSHOOT_IND` Nullable(Int8), `SERVING_OVERSHOOT_IND_MAIN` Nullable(Int8), `TARGET_OVERSHOOT_IND` Array(Nullable(Int32)), `TARGET_OVERSHOOT_IND_MAIN` Array(Nullable(Int32)), `SERVING_TAC` Nullable(Int32), `SERVING_CELL_NAME` Nullable(String), `SERVING_EARFCN` Nullable(Int32), `SERVING_FREQUENCY` Nullable(Int16), `TARGET_CELL_NAME` Array(Nullable(String)), `TARGET_FREQUENCY` Array(Nullable(Int32)), `BEST_PU` Nullable(Int32), `BEST_TAC` Nullable(Int32), `BEST_CELL_NAME` Nullable(String), `BEST_EARFCN` Nullable(Int32), `BEST_FREQUENCY` Nullable(Int16), `SERVING_CELL_LAT` Nullable(Float64), `SERVING_CELL_LON` Nullable(Float64), `SERVING_CELL_AZIMUTH` Nullable(Int32), `TARGET_CELL_LAT` Array(Nullable(Float64)), `TARGET_CELL_LON` Array(Nullable(Float64)), `TARGET_CELL_AZIMUTH` Array(Nullable(Int32))) ENGINE = MergeTree PARTITION BY (DATA_DATE, PU_ID, toUInt32(BATCH)) ORDER BY IMEI SETTINGS index_granularity = 8192

[config.txt](https://github.com/ClickHouse/ClickHouse/files/3924996/config.txt)

