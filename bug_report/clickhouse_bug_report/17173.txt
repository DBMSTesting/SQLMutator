ID: 17173
Title: server crash
Description:
clickhouse server version  20.5.4.40

log message:



```
2020.11.18 14:17:07.604888 [ 15272 ] {} <Fatal> BaseDaemon: ########################################
2020.11.18 14:17:07.605059 [ 15272 ] {} <Fatal> BaseDaemon: (version 20.5.4.40 (official build), no build id) (from thread 30082) (query_id: db7c0b53-7b53-4364-8f07-3c46e9ccaffb) Received signal Segmentation fault (11)
2020.11.18 14:17:07.605122 [ 15272 ] {} <Fatal> BaseDaemon: Address: 0x334f8 Access: read. Address not mapped to object.
2020.11.18 14:17:07.605165 [ 15272 ] {} <Fatal> BaseDaemon: Stack trace: 0xf6a495f 0x9f3a0ad 0xe9fda25 0xe9fdcef 0xea66e04 0xea684c9 0xebcf157 0xefcccf0 0xf68f3fd 0xea608c1 0xea647a2 0xea65d54 0xebce0f4 0xebce44c 0xeccfdba 0xeccfe26 0xeac6fb5 0xe65fb3d 0xf5af8cd 0xf3d77c1 0xf3dbf46 0xf3dc592 0x9f6bf47 0x9f6a433 0x7f40373bde25 0x7f4036cdbbad
2020.11.18 14:17:07.608875 [ 15272 ] {} <Fatal> BaseDaemon: 3. /build/obj-x86_64-linux-gnu/../contrib/jemalloc/include/jemalloc/internal/atomic.h:62: sallocx @ 0xf6a495f in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.609372 [ 15272 ] {} <Fatal> BaseDaemon: 4. /build/obj-x86_64-linux-gnu/../src/Common/new_delete.cpp:55: operator delete(void*, unsigned long) @ 0x9f3a0ad in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.612448 [ 15272 ] {} <Fatal> BaseDaemon: 5. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/__hash_table:1583: std::__1::__vector_base<DB::TableWithColumnNamesAndTypes, std::__1::allocator<DB::TableWithColumnNamesAndTypes> >::~__vector_base() @ 0xe9fda25 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.614405 [ 15272 ] {} <Fatal> BaseDaemon: 6. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:461: DB::JoinedTables::~JoinedTables() @ 0xe9fdcef in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.617085 [ 15272 ] {} <Fatal> BaseDaemon: 7. /build/obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:455: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>, std::__1::shared_ptr<DB::IStorage> const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0xea66e04 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.619684 [ 15272 ] {} <Fatal> BaseDaemon: 8. /build/obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:145: DB::InterpreterSelectQuery::InterpreterSelectQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0xea684c9 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.620794 [ 15272 ] {} <Fatal> BaseDaemon: 9. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1681: DB::InterpreterSelectWithUnionQuery::InterpreterSelectWithUnionQuery(std::__1::shared_ptr<DB::IAST> const&, DB::Context const&, DB::SelectQueryOptions const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0xebcf157 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.621852 [ 15272 ] {} <Fatal> BaseDaemon: 10. /build/obj-x86_64-linux-gnu/../src/Storages/StorageView.cpp:74: DB::StorageView::read(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, DB::SelectQueryInfo const&, DB::Context const&, DB::QueryProcessingStage::Enum, unsigned long, unsigned int) @ 0xefcccf0 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.622496 [ 15272 ] {} <Fatal> BaseDaemon: 11. /build/obj-x86_64-linux-gnu/../src/Processors/QueryPlan/ReadFromStorageStep.cpp:38: DB::ReadFromStorageStep::ReadFromStorageStep(DB::TableStructureReadLockHolder, DB::SelectQueryOptions, std::__1::shared_ptr<DB::IStorage>, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context>, DB::QueryProcessingStage::Enum, unsigned long, unsigned long) @ 0xf68f3fd in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.623535 [ 15272 ] {} <Fatal> BaseDaemon: 12. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:3028: DB::InterpreterSelectQuery::executeFetchColumns(DB::QueryProcessingStage::Enum, DB::QueryPlan&, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&) @ 0xea608c1 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.624786 [ 15272 ] {} <Fatal> BaseDaemon: 13. /build/obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectQuery.cpp:788: DB::InterpreterSelectQuery::executeImpl(DB::QueryPlan&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>) @ 0xea647a2 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.626087 [ 15272 ] {} <Fatal> BaseDaemon: 14. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/optional:224: DB::InterpreterSelectQuery::buildQueryPlan(DB::QueryPlan&) @ 0xea65d54 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.626511 [ 15272 ] {} <Fatal> BaseDaemon: 15. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1549: DB::InterpreterSelectWithUnionQuery::buildQueryPlan(DB::QueryPlan&) @ 0xebce0f4 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.626933 [ 15272 ] {} <Fatal> BaseDaemon: 16. /build/obj-x86_64-linux-gnu/../src/Interpreters/InterpreterSelectWithUnionQuery.cpp:200: DB::InterpreterSelectWithUnionQuery::execute() @ 0xebce44c in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.627282 [ 15272 ] {} <Fatal> BaseDaemon: 17. /build/obj-x86_64-linux-gnu/../src/Interpreters/SubqueryForSet.cpp:16: DB::SubqueryForSet::makeSource(std::__1::shared_ptr<DB::InterpreterSelectWithUnionQuery>&, std::__1::vector<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > >&&)::'lambda'()::operator()() @ 0xeccfdba in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.627608 [ 15272 ] {} <Fatal> BaseDaemon: 18. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1715: std::__1::__function::__func<DB::SubqueryForSet::makeSource(std::__1::shared_ptr<DB::InterpreterSelectWithUnionQuery>&, std::__1::vector<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > >&&)::'lambda'(), std::__1::allocator<DB::SubqueryForSet::makeSource(std::__1::shared_ptr<DB::InterpreterSelectWithUnionQuery>&, std::__1::vector<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > >&&)::'lambda'()>, std::__1::shared_ptr<DB::IBlockInputStream> ()>::operator()() @ 0xeccfe26 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.629123 [ 15272 ] {} <Fatal> BaseDaemon: 19. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/functional:1867: DB::LazyBlockInputStream::readImpl() @ 0xeac6fb5 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.629668 [ 15272 ] {} <Fatal> BaseDaemon: 20. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/vector:1003: DB::IBlockInputStream::read() @ 0xe65fb3d in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.630240 [ 15272 ] {} <Fatal> BaseDaemon: 21. /build/obj-x86_64-linux-gnu/../src/Processors/Transforms/CreatingSetsTransform.cpp:165: DB::CreatingSetsTransform::work() @ 0xf5af8cd in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.630640 [ 15272 ] {} <Fatal> BaseDaemon: 22. /build/obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:167: std::__1::__function::__func<DB::PipelineExecutor::addJob(DB::PipelineExecutor::ExecutionState*)::'lambda'(), std::__1::allocator<DB::PipelineExecutor::addJob(DB::PipelineExecutor::ExecutionState*)::'lambda'()>, void ()>::operator()() @ 0xf3d77c1 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.631298 [ 15272 ] {} <Fatal> BaseDaemon: 23. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/exception:180: DB::PipelineExecutor::executeStepImpl(unsigned long, unsigned long, std::__1::atomic<bool>*) (.constprop.0) @ 0xf3dbf46 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.631984 [ 15272 ] {} <Fatal> BaseDaemon: 24. /build/obj-x86_64-linux-gnu/../src/Processors/Executors/PipelineExecutor.cpp:798: ThreadFromGlobalPool::ThreadFromGlobalPool<DB::PipelineExecutor::executeImpl(unsigned long)::'lambda0'()>(DB::PipelineExecutor::executeImpl(unsigned long)::'lambda0'()&&)::'lambda'()::operator()() const @ 0xf3dc592 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.632140 [ 15272 ] {} <Fatal> BaseDaemon: 25. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/atomic:856: ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0x9f6bf47 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.632183 [ 15272 ] {} <Fatal> BaseDaemon: 26. /build/obj-x86_64-linux-gnu/../contrib/libcxx/include/memory:2615: void* std::__1::__thread_proxy<std::__1::tuple<std::__1::unique_ptr<std::__1::__thread_struct, std::__1::default_delete<std::__1::__thread_struct> >, void ThreadPoolImpl<std::__1::thread>::scheduleImpl<void>(std::__1::function<void ()>, int, std::__1::optional<unsigned long>)::'lambda1'()> >(void*) @ 0x9f6a433 in /usr/lib/debug/usr/bin/clickhouse
2020.11.18 14:17:07.632334 [ 15272 ] {} <Fatal> BaseDaemon: 27. start_thread @ 0x7e25 in /usr/lib64/libpthread-2.17.so
2020.11.18 14:17:07.632428 [ 15272 ] {} <Fatal> BaseDaemon: 28. clone @ 0xfebad in /usr/lib64/libc-2.17.so

```