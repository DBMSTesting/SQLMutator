ID: 21018
Title: High insert rate, low RAM, zk session lost and table is stuck.
Description:
**Describe the bug**
Wide table with 80 columns.
High insert rate (~30 per second) with 1 row per insert
At some point it hit max memory usage limit and Clickhouse loss session with zookeeper and were not be able to get it back.
Queries to the system.zookeeper table are working normally.

SYSTEM RESTART REPLICA database.some_table or DETACH TABLE database.some_table queries is stuck forever.
But exact same queries are working normally for any other table.

Restart of clickhouse server fixes everything.

Clickhouse 20.8.12.2


**Expected behavior**
Clickhouse doesn't stuck or at least would react to SYSTEM RESTART REPLICA/ DETACH TABLE queries.

**Error message and/or stacktrace**

```

2021.02.20 18:05:29.547956 [ 87 ] {} <Error> void Coordination::ZooKeeper::receiveThread(): Code: 241, e.displayText() = DB::Exception: Memory limit (total) exceeded: would use 6.75 GiB (attempt to allocate chunk of 4267856 bytes), maximum: 6.75 GiB, Stack trace (when copying this message, always include the lines below):

0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x18ccf210 in /usr/bin/clickhouse
1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xe62f32d in /usr/bin/clickhouse
2. ? @ 0xe61cdcf in /usr/bin/clickhouse
3. MemoryTracker::alloc(long) @ 0xe61b736 in /usr/bin/clickhouse
4. operator new(unsigned long) @ 0xe619f2c in /usr/bin/clickhouse
5. std::__1::enable_if<(std::__1::__is_cpp17_forward_iterator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*>::value) && (std::__1::is_constructible<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::iterator_traits<std::__1::iterator_traits>::reference>::value), void>::type std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >::assign<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >*>(std::__1::iterator_traits, std::__1::iterator_traits) @ 0xe750e92 in /usr/bin/clickhouse
6. ? @ 0x16756aaf in /usr/bin/clickhouse
7. Coordination::ZooKeeper::receiveEvent() @ 0x16776ae7 in /usr/bin/clickhouse
8. Coordination::ZooKeeper::receiveThread() @ 0x16777b8c in /usr/bin/clickhouse
9. ? @ 0x16777c40 in /usr/bin/clickhouse
10. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0xe65cba7 in /usr/bin/clickhouse
11. ? @ 0xe65b093 in /usr/bin/clickhouse
12. start_thread @ 0x9609 in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
13. clone @ 0x122293 in /usr/lib/x86_64-linux-gnu/libc-2.31.so
 (version 20.8.12.2 (official build))
2021.02.20 18:05:29.549135 [ 70 ] {} <Error> .transactions: void DB::StorageReplicatedMergeTree::mergeSelectingTask(): Code: 999, e.displayText() = Coordination::Exception: Connection loss, path: /clickhouse//transactions/temp, Stack trace (when copying this message, always include the lines below):

0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x18ccf210 in /usr/bin/clickhouse
1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xe62f32d in /usr/bin/clickhouse
2. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error, int) @ 0x16749a98 in /usr/bin/clickhouse
3. Coordination::Exception::Exception(Coordination::Error, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0x16749f73 in /usr/bin/clickhouse
4. ? @ 0x1675c146 in /usr/bin/clickhouse
5. DB::ReplicatedMergeTreeMergePredicate::ReplicatedMergeTreeMergePredicate(DB::ReplicatedMergeTreeQueue&, std::__1::shared_ptr<zkutil::ZooKeeper>&) @ 0x162c13ea in /usr/bin/clickhouse
6. DB::ReplicatedMergeTreeQueue::getMergePredicate(std::__1::shared_ptr<zkutil::ZooKeeper>&) @ 0x162c2f5e in /usr/bin/clickhouse
7. DB::StorageReplicatedMergeTree::mergeSelectingTask() @ 0x15f65bd6 in /usr/bin/clickhouse
8. DB::BackgroundSchedulePoolTaskInfo::execute() @ 0x15714d89 in /usr/bin/clickhouse
9. DB::BackgroundSchedulePool::threadFunction() @ 0x15715212 in /usr/bin/clickhouse
10. ? @ 0x15715342 in /usr/bin/clickhouse
11. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0xe65cba7 in /usr/bin/clickhouse
12. ? @ 0xe65b093 in /usr/bin/clickhouse
13. start_thread @ 0x9609 in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
14. clone @ 0x122293 in /usr/lib/x86_64-linux-gnu/libc-2.31.so
 (version 20.8.12.2 (official build))
2021.02.20 18:05:29.549173 [ 50 ] {} <Error> .transactions: DB::StorageReplicatedMergeTree::queueTask()::<lambda(DB::StorageReplicatedMergeTree::LogEntryPtr&)>: Code: 999, e.displayText() = Coordination::Exception: Connection loss, path: /clickhouse//transactions/replicas, Stack trace (when copying this message, always include the lines below):

0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x18ccf210 in /usr/bin/clickhouse
1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xe62f32d in /usr/bin/clickhouse
2. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error, int) @ 0x16749a98 in /usr/bin/clickhouse
3. Coordination::Exception::Exception(Coordination::Error, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0x16749f73 in /usr/bin/clickhouse
4. ? @ 0x1675c146 in /usr/bin/clickhouse
5. DB::StorageReplicatedMergeTree::findReplicaHavingCoveringPart(DB::ReplicatedMergeTreeLogEntry&, bool) @ 0x15f22bf7 in /usr/bin/clickhouse
6. DB::StorageReplicatedMergeTree::executeFetch(DB::ReplicatedMergeTreeLogEntry&) @ 0x15f6aec8 in /usr/bin/clickhouse
7. DB::StorageReplicatedMergeTree::executeLogEntry(DB::ReplicatedMergeTreeLogEntry&) @ 0x15f6d6e1 in /usr/bin/clickhouse
8. ? @ 0x15f6dadd in /usr/bin/clickhouse
9. DB::ReplicatedMergeTreeQueue::processEntry(std::__1::function<std::__1::shared_ptr<zkutil::ZooKeeper> ()>, std::__1::shared_ptr<DB::ReplicatedMergeTreeLogEntry>&, std::__1::function<bool (std::__1::shared_ptr<DB::ReplicatedMergeTreeLogEntry>&)>) @ 0x162b3102 in /usr/bin/clickhouse
10. DB::StorageReplicatedMergeTree::queueTask() @ 0x15f1dfde in /usr/bin/clickhouse
11. DB::BackgroundProcessingPool::workLoopFunc() @ 0x16095643 in /usr/bin/clickhouse
12. ? @ 0x16095f82 in /usr/bin/clickhouse
13. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0xe65cba7 in /usr/bin/clickhouse
14. ? @ 0xe65b093 in /usr/bin/clickhouse
15. start_thread @ 0x9609 in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
16. clone @ 0x122293 in /usr/lib/x86_64-linux-gnu/libc-2.31.so
 (version 20.8.12.2 (official build))
2021.02.20 18:05:29.549938 [ 73 ] {} <Error> .dd_models: void DB::StorageReplicatedMergeTree::mergeSelectingTask(): Code: 999, e.displayText() = Coordination::Exception: Session expired (Session expired), Stack trace (when copying this message, always include the lines below):

0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x18ccf210 in /usr/bin/clickhouse
1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xe62f32d in /usr/bin/clickhouse
2. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error, int) @ 0x16749a98 in /usr/bin/clickhouse
3. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error) @ 0x1674a18e in /usr/bin/clickhouse
4. ? @ 0x1677ed18 in /usr/bin/clickhouse
5. Coordination::ZooKeeper::get(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::function<void (Coordination::GetResponse const&)>, std::__1::function<void (Coordination::WatchResponse const&)>) @ 0x16778de5 in /usr/bin/clickhouse
6. zkutil::ZooKeeper::asyncTryGet(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0x16753264 in /usr/bin/clickhouse
7. DB::ReplicatedMergeTreeMergePredicate::ReplicatedMergeTreeMergePredicate(DB::ReplicatedMergeTreeQueue&, std::__1::shared_ptr<zkutil::ZooKeeper>&) @ 0x162c130b in /usr/bin/clickhouse
8. DB::ReplicatedMergeTreeQueue::getMergePredicate(std::__1::shared_ptr<zkutil::ZooKeeper>&) @ 0x162c2f5e in /usr/bin/clickhouse
9. DB::StorageReplicatedMergeTree::mergeSelectingTask() @ 0x15f65bd6 in /usr/bin/clickhouse


2021.02.20 18:29:48.951048 [ 76 ] {} <Error> .transactions: There is a problem with deleting parts from ZooKeeper: Code: 999, e.displayText() = Coordination::Exception: Session expired (Session expired), Stack trace (when copying this message, always include the lines below):

0. Poco::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0x18ccf210 in /usr/bin/clickhouse
1. DB::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, int) @ 0xe62f32d in /usr/bin/clickhouse
2. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error, int) @ 0x16749a98 in /usr/bin/clickhouse
3. Coordination::Exception::Exception(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Error) @ 0x1674a18e in /usr/bin/clickhouse
4. ? @ 0x1677ed18 in /usr/bin/clickhouse
5. Coordination::ZooKeeper::exists(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::function<void (Coordination::ExistsResponse const&)>, std::__1::function<void (Coordination::WatchResponse const&)>) @ 0x167789d5 in /usr/bin/clickhouse
6. zkutil::ZooKeeper::asyncExists(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) @ 0x1675375a in /usr/bin/clickhouse
7. DB::StorageReplicatedMergeTree::removePartsFromZooKeeper(std::__1::shared_ptr<zkutil::ZooKeeper>&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::unordered_set<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::hash<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::equal_to<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >*) @ 0x15f4b48e in /usr/bin/clickhouse
8. DB::StorageReplicatedMergeTree::clearOldPartsAndRemoveFromZK() @ 0x15f4d9f7 in /usr/bin/clickhouse
9. DB::ReplicatedMergeTreeCleanupThread::iterate() @ 0x16284bd8 in /usr/bin/clickhouse
10. DB::ReplicatedMergeTreeCleanupThread::run() @ 0x16284dbd in /usr/bin/clickhouse
11. DB::BackgroundSchedulePoolTaskInfo::execute() @ 0x15714d89 in /usr/bin/clickhouse
12. DB::BackgroundSchedulePool::threadFunction() @ 0x15715212 in /usr/bin/clickhouse
13. ? @ 0x15715342 in /usr/bin/clickhouse
14. ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>) @ 0xe65cba7 in /usr/bin/clickhouse
15. ? @ 0xe65b093 in /usr/bin/clickhouse
16. start_thread @ 0x9609 in /usr/lib/x86_64-linux-gnu/libpthread-2.31.so
17. clone @ 0x122293 in /usr/lib/x86_64-linux-gnu/libc-2.31.so
```



From system.stack_trace table
```
Poco::EventImpl::waitImpl()
DB::DDLWorker::runMainThread()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::DDLWorker::*)(), DB::DDLWorker*>(void (DB::DDLWorker::*&&)(), DB::DDLWorker*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone │
│       105 │ 9c11922c-9143-4f5c-8bfe-63e75541819f │ __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::DDLGuard::DDLGuard(std::__1::map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::DDLGuard::Entry, std::__1::less<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::DDLGuard::Entry> > >&, std::__1::shared_mutex&, std::__1::unique_lock<std::__1::mutex>, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::DatabaseCatalog::getDDLGuard(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::InterpreterSystemQuery::tryRestartReplica(DB::StorageID const&, DB::Context&, bool)
DB::InterpreterSystemQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone │
│      1291 │ dd8c5627-c2df-40d5-9bf6-bb3b3b65ec9d │ __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::BackgroundSchedulePoolTaskInfo::deactivate()
DB::ReplicatedMergeTreeRestartingThread::shutdown()
DB::StorageReplicatedMergeTree::shutdown()
DB::InterpreterSystemQuery::tryRestartReplica(DB::StorageID const&, DB::Context&, bool)
DB::InterpreterSystemQuery::execute()

DB::executeQuery(DB::ReadBuffer&, DB::WriteBuffer&, bool, DB::Context&, std::__1::function<void (std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)>)
DB::HTTPHandler::processQuery(DB::Context&, Poco::Net::HTTPServerRequest&, HTMLForm&, Poco::Net::HTTPServerResponse&, DB::HTTPHandler::Output&)
DB::HTTPHandler::handleRequest(Poco::Net::HTTPServerRequest&, Poco::Net::HTTPServerResponse&)
Poco::Net::HTTPServerConnection::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone │
│      1293 │ 106c380d-2755-4cb3-8f20-46a423908ae6 │ __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::DDLGuard::DDLGuard(std::__1::map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::DDLGuard::Entry, std::__1::less<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::DDLGuard::Entry> > >&, std::__1::shared_mutex&, std::__1::unique_lock<std::__1::mutex>, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::DatabaseCatalog::getDDLGuard(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::InterpreterDropQuery::executeToTable(DB::ASTDropQuery const&)
DB::InterpreterDropQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone │
│      1294 │ 8cd701c2-b365-44fe-af20-c67235776bbf │ sigqueue
DB::StorageSystemStackTrace::fillData(std::__1::vector<COW<DB::IColumn>::mutable_ptr<DB::IColumn>, std::__1::allocator<COW<DB::IColumn>::mutable_ptr<DB::IColumn> > >&, DB::Context const&, DB::SelectQueryInfo const&) const
DB::IStorageSystemOneBlock<DB::StorageSystemStackTrace>::read(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo const&, DB::Context const&, DB::QueryProcessingStage::Enum, unsigned long, unsigned int)
DB::ReadFromStorageStep::ReadFromStorageStep(std::__1::shared_ptr<DB::RWLockImpl::LockHolderImpl>, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, DB::SelectQueryOptions, std::__1::shared_ptr<DB::IStorage>, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context>, DB::QueryProcessingStage::Enum, unsigned long, unsigned long)
DB::InterpreterSelectQuery::executeFetchColumns(DB::QueryProcessingStage::Enum, DB::QueryPlan&, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&)
DB::InterpreterSelectQuery::executeImpl(DB::QueryPlan&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>)
DB::InterpreterSelectQuery::buildQueryPlan(DB::QueryPlan&)
DB::InterpreterSelectWithUnionQuery::buildQueryPlan(DB::QueryPlan&)
DB::InterpreterSelectWithUnionQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone






Row 5:
──────
groupArray(thread_id): [106]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
Poco::SemaphoreImpl::waitImpl(long)
Coordination::ZooKeeper::sendThread()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 6:
──────
groupArray(thread_id): [1291]
groupArray(query_id):  ['dd8c5627-c2df-40d5-9bf6-bb3b3b65ec9d']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::BackgroundSchedulePoolTaskInfo::deactivate()
DB::ReplicatedMergeTreeRestartingThread::shutdown()
DB::StorageReplicatedMergeTree::shutdown()
DB::InterpreterSystemQuery::tryRestartReplica(DB::StorageID const&, DB::Context&, bool)
DB::InterpreterSystemQuery::execute()

DB::executeQuery(DB::ReadBuffer&, DB::WriteBuffer&, bool, DB::Context&, std::__1::function<void (std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)>)
DB::HTTPHandler::processQuery(DB::Context&, Poco::Net::HTTPServerRequest&, HTMLForm&, Poco::Net::HTTPServerResponse&, DB::HTTPHandler::Output&)
DB::HTTPHandler::handleRequest(Poco::Net::HTTPServerRequest&, Poco::Net::HTTPServerResponse&)
Poco::Net::HTTPServerConnection::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 7:
──────
groupArray(thread_id): [70,71,72,74,75,76,77,78,80,81,84,85]
groupArray(query_id):  ['','','','','','','','','','','','']
res:                   pthread_cond_wait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl()
Poco::NotificationQueue::waitDequeueNotification()
DB::BackgroundSchedulePool::threadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 8:
──────
groupArray(thread_id): [1294]
groupArray(query_id):  ['35e85f8c-283b-42dc-8d53-4d5724846dc9']
res:                   sigqueue
DB::StorageSystemStackTrace::fillData(std::__1::vector<COW<DB::IColumn>::mutable_ptr<DB::IColumn>, std::__1::allocator<COW<DB::IColumn>::mutable_ptr<DB::IColumn> > >&, DB::Context const&, DB::SelectQueryInfo const&) const
DB::IStorageSystemOneBlock<DB::StorageSystemStackTrace>::read(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, std::__1::shared_ptr<DB::StorageInMemoryMetadata const> const&, DB::SelectQueryInfo const&, DB::Context const&, DB::QueryProcessingStage::Enum, unsigned long, unsigned int)
DB::ReadFromStorageStep::ReadFromStorageStep(std::__1::shared_ptr<DB::RWLockImpl::LockHolderImpl>, std::__1::shared_ptr<DB::StorageInMemoryMetadata const>&, DB::SelectQueryOptions, std::__1::shared_ptr<DB::IStorage>, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&, DB::SelectQueryInfo const&, std::__1::shared_ptr<DB::Context>, DB::QueryProcessingStage::Enum, unsigned long, unsigned long)
DB::InterpreterSelectQuery::executeFetchColumns(DB::QueryProcessingStage::Enum, DB::QueryPlan&, std::__1::shared_ptr<DB::PrewhereInfo> const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&)
DB::InterpreterSelectQuery::executeImpl(DB::QueryPlan&, std::__1::shared_ptr<DB::IBlockInputStream> const&, std::__1::optional<DB::Pipe>)
DB::InterpreterSelectQuery::buildQueryPlan(DB::QueryPlan&)
DB::InterpreterSelectWithUnionQuery::buildQueryPlan(DB::QueryPlan&)
DB::InterpreterSelectWithUnionQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 9:
───────
groupArray(thread_id): [79]
groupArray(query_id):  ['']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::ReplicatedMergeTreeQueue::pullLogsToQueue(std::__1::shared_ptr<zkutil::ZooKeeper>, std::__1::function<void (Coordination::WatchResponse const&)>)
DB::StorageReplicatedMergeTree::queueUpdatingTask()
DB::BackgroundSchedulePoolTaskInfo::execute()
DB::BackgroundSchedulePool::threadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 10:
───────
groupArray(thread_id): [45,104]
groupArray(query_id):  ['','']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::ExternalLoader::PeriodicUpdater::doPeriodicUpdates()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::ExternalLoader::PeriodicUpdater::*)(), DB::ExternalLoader::PeriodicUpdater*>(void (DB::ExternalLoader::PeriodicUpdater::*&&)(), DB::ExternalLoader::PeriodicUpdater*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 11:
───────
groupArray(thread_id): [89]
groupArray(query_id):  ['']
res:                   __libc_read
DB::ReadBufferFromFileDescriptor::nextImpl()
DB::TraceCollector::run()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::TraceCollector::*)(), DB::TraceCollector*>(void (DB::TraceCollector::*&&)(), DB::TraceCollector*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 12:
───────
groupArray(thread_id): [86]
groupArray(query_id):  ['']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::ReplicatedMergeTreeQueue::updateMutations(std::__1::shared_ptr<zkutil::ZooKeeper>, std::__1::function<void (Coordination::WatchResponse const&)>)
DB::StorageReplicatedMergeTree::mutationsUpdatingTask()
DB::BackgroundSchedulePoolTaskInfo::execute()
DB::BackgroundSchedulePool::threadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 13:
───────
groupArray(thread_id): [1305]
groupArray(query_id):  ['']
res:                   pthread_cond_wait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl()
Poco::NotificationQueue::waitDequeueNotification()
Poco::ActiveDispatcher::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 14:
───────
groupArray(thread_id): [47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62]
groupArray(query_id):  ['','','','','','','','','','','','','','','','']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::BackgroundProcessingPool::workLoopFunc()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 15:
───────
groupArray(thread_id): [105]
groupArray(query_id):  ['9c11922c-9143-4f5c-8bfe-63e75541819f']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::DDLGuard::DDLGuard(std::__1::map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::DDLGuard::Entry, std::__1::less<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::DDLGuard::Entry> > >&, std::__1::shared_mutex&, std::__1::unique_lock<std::__1::mutex>, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::DatabaseCatalog::getDDLGuard(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::InterpreterSystemQuery::tryRestartReplica(DB::StorageID const&, DB::Context&, bool)
DB::InterpreterSystemQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 16:
───────
groupArray(thread_id): [68]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
void std::__1::this_thread::sleep_until<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000l> > >(std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000l> > > const&)
DB::MetricLog::metricThreadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 17:
───────
groupArray(thread_id): [73]
groupArray(query_id):  ['']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::BackgroundSchedulePoolTaskInfo::deactivate()
DB::StorageReplicatedMergeTree::exitLeaderElection()
DB::ReplicatedMergeTreeRestartingThread::partialShutdown()
DB::ReplicatedMergeTreeRestartingThread::run()
DB::BackgroundSchedulePoolTaskInfo::execute()
DB::BackgroundSchedulePool::threadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 18:
───────
groupArray(thread_id): [94]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::AsynchronousMetrics::run()
ThreadFromGlobalPool::ThreadFromGlobalPool<DB::AsynchronousMetrics::AsynchronousMetrics(DB::Context&, int)::'lambda'()>(DB::AsynchronousMetrics::AsynchronousMetrics(DB::Context&, int)::'lambda'()&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 19:
───────
groupArray(thread_id): [102,103]
groupArray(query_id):  ['','']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl(long)
DB::ConfigReloader::run()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::ConfigReloader::*)(), DB::ConfigReloader*>(void (DB::ConfigReloader::*&&)(), DB::ConfigReloader*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 20:
───────
groupArray(thread_id): [95]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::NamedSessions::cleanThread()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::NamedSessions::*)(), DB::NamedSessions*>(void (DB::NamedSessions::*&&)(), DB::NamedSessions*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 21:
───────
groupArray(thread_id): [69]
groupArray(query_id):  ['f1486638-8ecf-4691-9d6a-322f1e65ec3e']
res:                   pthread_cond_wait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl()
DB::DDLWorker::runMainThread()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::DDLWorker::*)(), DB::DDLWorker*>(void (DB::DDLWorker::*&&)(), DB::DDLWorker*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 22:
───────
groupArray(thread_id): [1]
groupArray(query_id):  ['']
res:                   pthread_cond_wait@@GLIBC_2.3.2
std::__1::condition_variable::wait(std::__1::unique_lock<std::__1::mutex>&)
BaseDaemon::waitForTerminationRequest()
DB::Server::main(std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > > const&)
Poco::Util::Application::run()
DB::Server::run()
mainEntryClickHouseServer(int, char**)
main
__libc_start_main
_start

Row 23:
───────
groupArray(thread_id): [88]
groupArray(query_id):  ['']
res:                   epoll_wait
Poco::Net::SocketImpl::pollImpl(Poco::Timespan&, int)
Poco::Net::SocketImpl::poll(Poco::Timespan const&, int)
DB::ReadBufferFromPocoSocket::poll(unsigned long)
Coordination::ZooKeeper::receiveThread()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 24:
───────
groupArray(thread_id): [44]
groupArray(query_id):  ['']
res:                   __libc_read
DB::ReadBufferFromFileDescriptor::nextImpl()
SignalListener::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 25:
───────
groupArray(thread_id): [67]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::SystemLog<DB::MetricLogElement>::savingThreadFunction()
ThreadFromGlobalPool::ThreadFromGlobalPool<DB::SystemLog<DB::MetricLogElement>::startup()::'lambda'()>(DB::MetricLogElement&&, DB::SystemLog<DB::MetricLogElement>::startup()::'lambda'()&&...)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 26:
───────
groupArray(thread_id): [63]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::SystemLog<DB::QueryLogElement>::savingThreadFunction()
ThreadFromGlobalPool::ThreadFromGlobalPool<DB::SystemLog<DB::QueryLogElement>::startup()::'lambda'()>(DB::QueryLogElement&&, DB::SystemLog<DB::QueryLogElement>::startup()::'lambda'()&&...)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 27:
───────
groupArray(thread_id): [91,93]
groupArray(query_id):  ['','']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl(long)
Poco::NotificationQueue::waitDequeueNotification(long)
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 28:
───────
groupArray(thread_id): [66]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::SystemLog<DB::TraceLogElement>::savingThreadFunction()
ThreadFromGlobalPool::ThreadFromGlobalPool<DB::SystemLog<DB::TraceLogElement>::startup()::'lambda'()>(DB::TraceLogElement&&, DB::SystemLog<DB::TraceLogElement>::startup()::'lambda'()&&...)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 29:
───────
groupArray(thread_id): [90]
groupArray(query_id):  ['']
res:                   pthread_cond_wait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl()
DB::DDLWorker::runCleanupThread()
ThreadFromGlobalPool::ThreadFromGlobalPool<void (DB::DDLWorker::*)(), DB::DDLWorker*>(void (DB::DDLWorker::*&&)(), DB::DDLWorker*&&)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 30:
───────
groupArray(thread_id): [96,97,98,99,100,101]
groupArray(query_id):  ['','','','','','']
res:                   epoll_wait
Poco::Net::SocketImpl::pollImpl(Poco::Timespan&, int)
Poco::Net::SocketImpl::poll(Poco::Timespan const&, int)
Poco::Net::TCPServer::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

Row 31:
───────
groupArray(thread_id): [64]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::SystemLog<DB::CrashLogElement>::savingThreadFunction()
ThreadFromGlobalPool::ThreadFromGlobalPool<DB::SystemLog<DB::CrashLogElement>::startup()::'lambda'()>(DB::CrashLogElement&&, DB::SystemLog<DB::CrashLogElement>::startup()::'lambda'()&&...)::'lambda'()::operator()() const
ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 32:
───────
groupArray(thread_id): [82]
groupArray(query_id):  ['']
res:                   pthread_cond_wait@@GLIBC_2.3.2
Poco::EventImpl::waitImpl()
zkutil::ZooKeeper::getChildrenImpl(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::vector<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, std::__1::allocator<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > > >&, Coordination::Stat*, std::__1::function<void (Coordination::WatchResponse const&)>)
zkutil::ZooKeeper::getChildrenWatch(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, Coordination::Stat*, std::__1::function<void (Coordination::WatchResponse const&)>)
DB::ReplicatedMergeTreeQueue::updateMutations(std::__1::shared_ptr<zkutil::ZooKeeper>, std::__1::function<void (Coordination::WatchResponse const&)>)
DB::ReplicatedMergeTreeQueue::pullLogsToQueue(std::__1::shared_ptr<zkutil::ZooKeeper>, std::__1::function<void (Coordination::WatchResponse const&)>)
DB::ReplicatedMergeTreeMergePredicate::ReplicatedMergeTreeMergePredicate(DB::ReplicatedMergeTreeQueue&, std::__1::shared_ptr<zkutil::ZooKeeper>&)
DB::ReplicatedMergeTreeQueue::getMergePredicate(std::__1::shared_ptr<zkutil::ZooKeeper>&)
DB::StorageReplicatedMergeTree::mergeSelectingTask()
DB::BackgroundSchedulePoolTaskInfo::execute()
DB::BackgroundSchedulePool::threadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 33:
───────
groupArray(thread_id): [83]
groupArray(query_id):  ['']
res:                   pthread_cond_timedwait@@GLIBC_2.3.2
std::__1::condition_variable::__do_timed_wait(std::__1::unique_lock<std::__1::mutex>&, std::__1::chrono::time_point<std::__1::chrono::system_clock, std::__1::chrono::duration<long long, std::__1::ratio<1l, 1000000000l> > >)
DB::BackgroundSchedulePool::delayExecutionThreadFunction()

ThreadPoolImpl<std::__1::thread>::worker(std::__1::__list_iterator<std::__1::thread, void*>)

start_thread
clone

Row 34:
───────
groupArray(thread_id): [1293]
groupArray(query_id):  ['106c380d-2755-4cb3-8f20-46a423908ae6']
res:                   __lll_lock_wait
__pthread_mutex_lock
pthread_mutex_lock
std::__1::mutex::lock()
DB::DDLGuard::DDLGuard(std::__1::map<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> >, DB::DDLGuard::Entry, std::__1::less<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > >, std::__1::allocator<std::__1::pair<std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const, DB::DDLGuard::Entry> > >&, std::__1::shared_mutex&, std::__1::unique_lock<std::__1::mutex>, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::DatabaseCatalog::getDDLGuard(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&)
DB::InterpreterDropQuery::executeToTable(DB::ASTDropQuery const&)
DB::InterpreterDropQuery::execute()

DB::executeQuery(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, DB::Context&, bool, DB::QueryProcessingStage::Enum, bool)
DB::TCPHandler::runImpl()
DB::TCPHandler::run()
Poco::Net::TCPServerConnection::start()
Poco::Net::TCPServerDispatcher::run()
Poco::PooledThread::run()
Poco::ThreadImpl::runnableEntry(void*)
start_thread
clone

34 rows in set. Elapsed: 0.008 sec.
```

**Additional context**
Add any other context about the problem here.
