ID: 2234
Title: [Bug]: failed to calculate left expression
Description:
mysql>SELECT left(QUERY_SQL,1000) FROM oceanbase.GV$OB_SQL_AUDIT WHERE DB_NAME not in ('oceanbase','coofagdb') AND SQL_ID <>'' ORDER BY REQUEST_TIME DESC LIMIT 1
ERROR 1210 (HY000): Invalid argument

**Environment**
Linux SVR44133XF2288 5.14.0-162.23.1.el9_1.x86_64 #1 SMP PREEMPT_DYNAMIC Tue Apr 11 10:43:28 EDT 2023 x86_64 x86_64 x86_64 GNU/Linux
  
OceanBase_CE 4.2.1.7
  

[2025-02-24 20:04:54.607976] WDIAG [LIB.CHARSET] first_valid_char (ob_charset.cpp:2402) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=3][errcode=-4002] invalid encoding found
[2025-02-24 20:04:54.607994] WDIAG [SQL.ENG] calc_left (ob_expr_left.cpp:124) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=17][errcode=-4002] get char failed(ret=-4002)
[2025-02-24 20:04:54.608001] WDIAG [SQL.ENG] calc_left_expr (ob_expr_left.cpp:153) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=6][errcode=-4002] failed to calculate left expression(ret=-4002)
[2025-02-24 20:04:54.608007] WDIAG [SQL.EXE] get_next_row (ob_execute_result.cpp:62) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5][errcode=-4002] expr evaluate failed(ret=-4002)
[2025-02-24 20:04:54.608014] WDIAG [SQL] inner_get_next_row (ob_result_set.cpp:411) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5][errcode=-4002] get next row from exec result failed(ret=-4002)
[2025-02-24 20:04:54.608020] WDIAG [SERVER] response_query_result (ob_query_driver.cpp:301) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=4][errcode=-4002] fail to iterate and response(ret=-4002, row_num=0, can_retry=true)
[2025-02-24 20:04:54.608029] WDIAG [SERVER] response_result (ob_sync_plan_driver.cpp:104) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=7][errcode=-4002] response query result fail(ret=-4002)
[2025-02-24 20:04:54.608037] WDIAG [SERVER] after_func (ob_query_retry_ctrl.cpp:947) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5][errcode=-4002] [RETRY] check if need retry(v={force_local_retry:false, stmt_retry_times:0, local_retry_times:0, err_:-4002, err_:"OB_INVALID_ARGUMENT", retry_type:0, client_ret:-4002}, need_retry=false, THIS_WORKER.can_retry()=true, v.ctx_.multi_stmt_item_={is_part_of_multi_stmt:false, seq_num:0, sql:"SELECT left(QUERY_SQL,1000) FROM oceanbase.GV$OB_SQL_AUDIT WHERE DB_NAME not in ('oceanbase','coofagdb') AND SQL_ID <>'' ORDER BY REQUEST_TIME DESC LIMIT 1", batched_queries:NULL, is_ps_mode:false, ab_cnt:0})
[2025-02-24 20:04:54.608056] WDIAG [SERVER] response_result (ob_sync_plan_driver.cpp:116) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=19][errcode=-4002] result response failed, check if need retry(ret=-4002, cli_ret=-4002, retry_ctrl_.need_retry()=0)
[2025-02-24 20:04:54.608089] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.113:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608107] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=11] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.173:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608121] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=8] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.180:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608131] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.21:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608142] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=6] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.41:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608160] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=11] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.44:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608168] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=7] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.45:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608179] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=6] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.52:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608198] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=6] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.60:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608208] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=5] success to send interrupt message(int_code={code:-4662, info:{msg:"tid:10820,from:"100.129.222.45:2882",PX ABORT DFO"}}, addr="100.129.222.66:2882", interrupt_id=task(1727156159708881,85903541645))
[2025-02-24 20:04:54.608219] INFO  [SQL.ENG] broadcast_dfo (ob_px_interruption.cpp:76) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=4]  REACH SYSLOG RATE LIMIT [bandwidth]
[2025-02-24 20:04:54.608421] WDIAG [SERVER] response_result (ob_sync_plan_driver.cpp:126) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=1][errcode=-4002] close result set fail(cret=-4002)
[2025-02-24 20:04:54.608444] INFO  [SERVER] send_error_packet (obmp_packet_sender.cpp:319) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=11] sending error packet(ob_error=-4002, client error=1210, extra_err_info=NULL, lbt()="0x11c4a48c 0x99dbb20 0x9988c99 0x4c4b3c5 0x4c30f0f 0x4c2aa3c 0x4c222b8 0x4c1d6a0 0x983a434 0x122f6bb3 0x7ff58303d802 0x7ff582fdd450")
[2025-02-24 20:04:54.608474] WDIAG [SERVER] do_process (obmp_query.cpp:808) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=12][errcode=-4002] execute query fail(ret=-4002, timeout_timestamp=1740398790776089)
[2025-02-24 20:04:54.608574] TRACE [TRACE] after_process (obmp_base.cpp:145) [10820][T1_L0_G0][T1][YB420A6DDC2D-000622D6E1C9813F-0-0] [lt=8] [slow query](TRACE=begin_ts=1740398690776158 2025-02-24 12:04:50.776158|[process_begin] u=0 in_queue_time:68, receive_ts:1740398690776089, enqueue_ts:1740398690776095|[start_sql] u=1 addr:{ip:"127.0.0.1", port:39492}|[query_begin] u=0 trace_id:YB420A6DDC2D-000622D6E1C9813F-0-0|[before_processor_run] u=4 |[session] u=4 sid:3226632859, tenant_id:1|[parse_begin] u=56 stmt:"SELECT left(QUERY_SQL,1000) FROM oceanbase.GV$OB_SQL_AUDIT WHERE DB_NAME not in ('oceanbase','coofagdb') AND SQL_ID <>'' ORDER BY REQUEST_TIME DESC LIMIT 1", stmt_len:155|[calc_partition_location_begin] u=85 |[plc_serialize_begin] u=6 |[plc_serialize_end] u=11 |[tl_calc_part_id_end] u=27 |[get_location_cache_begin] u=0 |[get_location_cache_end] u=21 |[calc_partition_location_end] u=2 |[pc_choose_plan] u=22 |[check_priv] u=5 |[plan_id] u=2 plan_id:284640|[do_open_plan_begin] u=9 plan_id:284640|[sql_start_stmt_begin] u=1 |[sql_start_stmt_end] u=1 |[exec_plan_begin] u=0 |[exec_plan_end] u=23 |[do_open_plan_end] u=0 |[sqc_finish] u=2396991 dfo_id:0, sqc_id:7|[sqc_finish] u=29050 dfo_id:0, sqc_id:8|[sqc_finish] u=6620 dfo_id:0, sqc_id:4|[sqc_finish] u=245918 dfo_id:0, sqc_id:5|[sqc_finish] u=21946 dfo_id:0, sqc_id:11|[sqc_finish] u=51306 dfo_id:0, sqc_id:2|[sqc_finish] u=33547 dfo_id:0, sqc_id:9|[sqc_finish] u=99229 dfo_id:0, sqc_id:3|[sqc_finish] u=217766 dfo_id:0, sqc_id:1|[sqc_finish] u=40803 dfo_id:0, sqc_id:0|[sqc_finish] u=353433 dfo_id:0, sqc_id:10|[close_plan_begin] u=335017 |[sqc_finish] u=250 dfo_id:0, sqc_id:6|[start_end_stmt] u=101 |[end_stmt] u=0 |[close_plan_end] u=0 |[auto_end_plan_begin] u=2 |[auto_end_plan_end] u=3 |[session] u=42 sid:3226632859, tenant_id:1|[get_location_cache_begin] u=92 |[query_end] u=9 |[session] u=2 sid:3226632859, tenant_id:1|[process_end] u=8 run_ts:1740398690776164|total_timeu=3832415)
