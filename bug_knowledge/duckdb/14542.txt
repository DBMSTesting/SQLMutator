{
    "sql": "CREATE OR REPLACE MACRO json_each(input) AS TABLE ( SELECT CASE json_type (val::json) WHEN 'ARRAY' THEN unnest(RANGE (json_array_length(val::json)::bigint)) ::varchar ELSE unnest(json_keys (val::json)) END AS key, json_extract (val::json, key) AS value FROM (SELECT input as val)); SELECT * FROM (SELECT '[1,2,3]' AS message) CROSS JOIN json_each(message); SELECT * FROM (SELECT '[1,2,3]'::json AS message) CROSS JOIN json_each(message); SELECT * FROM (SELECT '[1,2,3]'::json[] AS message) CROSS JOIN json_each(message);",
    "Affected Elements": "CREATE OR REPLACE MACRO, SELECT, CROSS JOIN, json_each, json_type, json_array_length, unnest, json_keys, json_extract",
    "Root Cause Analysis": "The internal error indicates a failure in type casting within the macro logic, likely due to the handling of the json[] type causing an unexpected condition."
}