{
    "sql": "DROP TABLE IF EXISTS data_guess; CREATE TABLE data_guess (user_id LowCardinality(String), datasource_id LowCardinality(String), timestamp DateTime, path LowCardinality(String), type LowCardinality(String), num Float32, str String) ENGINE = MergeTree ORDER BY (user_id, datasource_id, timestamp); INSERT INTO data_guess VALUES ('0','0','2021-10-15 09:38:51','$.extra_data.city','string',0,'Concord'), ('0','0','2021-10-15 09:38:51','$.extra_data.city','string',0,'Hartford'); SELECT path, argMax(advice_type, type_pct) AS recommended_type FROM ( SELECT path, count() AS cnt, count() AS type_pct, countIf(isNotNull(parseDateTimeBestEffortOrNull(str))) AS date_parseable, countIf(isNotNull(parseDateTime64BestEffortOrNull(str))) AS date_parseable64, multiIf(date_parseable < (cnt * 0.99), NULL, (date_parseable64 >= date_parseable), 'DateTime64', 'DateTime') AS advice_date_subtype, path LIKE '%[:]%' AS is_array, path LIKE '%[:]%[:]%' AS is_nested_array, multiIf(isNotNull(advice_date_subtype), advice_date_subtype, NULL) AS advice_type_raw, multiIf(is_nested_array, NULL, is_array, concat('Array(', advice_type_raw, ')'), advice_type_raw) AS advice_type FROM data_guess GROUP BY type, path ) GROUP BY path;",
    "Affected Elements": "argMax, multiIf, subqueries",
    "Root Cause Analysis": "The error is caused by a logical issue in handling LowCardinality types leading to an invalid cast to ColumnVector<char8_t>."
}