{
    "sql": "SELECT arraySort(arrayMap((x, y) -> (x, y), groupArray(event_index), groupArray(url))) AS events, arrayFilter(event -> (event.1 = step2.1 - 1), events)[1] AS step1, arrayFilter(event -> (event.1 = step3.1 - 1), events)[1] AS step2, arrayFilter(event -> (event.1 = step4.1 - 1), events)[1] AS step3, arrayFilter(event -> (event.1 = step5.1 - 1), events)[1] AS step4, arrayFilter(event -> (event.1 = step6.1 - 1), events)[1] AS step5, arrayFilter(event -> (event.2 LIKE '%foo%'), events)[1] AS step6 FROM data GROUP BY session_id; CREATE TABLE data_shard (server_date Date, session_id UInt64, event_index UInt16, url String) ENGINE = ReplicatedMergeTree('/clickhouse/tables/default/{shard}/data', '{replica}') PARTITION BY toYYYYMM(server_date) ORDER BY (server_date, session_id) SETTINGS index_granularity = 8192; CREATE TABLE data (server_date Date, session_id UInt64, event_index UInt16, url String) ENGINE = Distributed(analytics, default, data_shard, rand());",
    "Affected Elements": "arraySort, arrayMap, groupArray, arrayFilter, LIKE",
    "Root Cause Analysis": "The issue is likely related to the maximum parse depth limit being exceeded due to the complexity of the query after the upgrade to ClickHouse 19.11, potentially exacerbated by the distributed table configuration."
}