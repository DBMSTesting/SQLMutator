{
    "sql": "CREATE TABLE t_local (id UInt32, s String) ENGINE = MergeTree ORDER BY id; CREATE TABLE t_dist (id UInt32, s String) ENGINE = Distributed(test_cluster_two_shards, currentDatabase(), t_local); SELECT * FROM ( SELECT id, COUNT() FROM t_dist GROUP BY id ) WHERE id IN ( SELECT id FROM t_dist WHERE NOT EMPTY(s) ) SETTINGS enable_optimize_predicate_expression = 1, distributed_product_mode = 'deny'; SELECT * FROM ( SELECT id, COUNT() FROM t_dist GROUP BY id WITH TOTALS ) WHERE id IN ( SELECT id FROM t_dist AS dist WHERE NOT EMPTY(s) ) SETTINGS enable_optimize_predicate_expression = 1, distributed_product_mode = 'local';",
    "Affected Elements": "IN clause, GROUP BY, HAVING, distributed_product_mode keyword",
    "Root Cause Analysis": "The issue arises from improper handling of distributed subqueries, leading to execution context mismatches and incorrect query results when using specific distributed_product_mode settings."
}