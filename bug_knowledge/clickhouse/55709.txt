{
    "sql": "CREATE TABLE users (uid Int16, date Date, age Int16, reg Int16) ENGINE=Memory; INSERT INTO users VALUES (1111, '2023-10-01', 13, 12); INSERT INTO users VALUES (1111, '2023-10-03', 33, 22); INSERT INTO users VALUES (2222, '2023-10-01', 14, 14); INSERT INTO users VALUES (2222, '2023-10-02', 48, 34); INSERT INTO users VALUES (8888, '2023-10-02', 55, 55); INSERT INTO users VALUES (8888, '2023-10-03', 50, 23); CREATE VIEW users_avg_broken (uid Int16, age Int16, reg Int16) AS SELECT uid, avg(age) AS age, sum(reg) AS reg FROM users WHERE uid = 1111 GROUP BY uid; SELECT * FROM users_avg_broken(uid=1111) FORMAT JSONEachRow; SET flatten_nested=0; CREATE TABLE users (uid Int16, date Date, age Int16, reg Int16, bar Int16) ENGINE=Memory; INSERT INTO users VALUES (1111, '2023-10-01', 13, 12, 234); INSERT INTO users VALUES (1111, '2023-10-03', 33, 22, 543); INSERT INTO users VALUES (2222, '2023-10-01', 14, 14, 512); INSERT INTO users VALUES (2222, '2023-10-02', 48, 34, 876); INSERT INTO users VALUES (8888, '2023-10-02', 55, 55, 632); INSERT INTO users VALUES (8888, '2023-10-03', 50, 23, 532); CREATE VIEW test_view (uid UInt32, params Nested(age UInt32, reg UInt16, bar Int16)) AS SELECT uid, groupArray((age, reg, bar)) AS params FROM users WHERE uid = 2222 GROUP BY uid; SELECT * FROM test_view(uid=2222) FORMAT JSONEachRow;",
    "Affected Elements": "JSONEachRow format, Nested type handling",
    "Root Cause Analysis": "The bug stems from changes in JSON serialization for numerical types and nested structures in ClickHouse version 23.8, causing incorrect data representation."
}