{
    "sql": "CREATE TABLE visits (ts DateTime, mac String) ENGINE = ReplacingMergeTree(ts) PARTITION BY formatDateTime(ts, '%Y%m%d%H') ORDER BY mac TTL ts + toIntervalDay(32); INSERT INTO test.visits(ts, mac) VALUES('2019-09-12 22:00:00', 'A'); INSERT INTO test.visits(ts, mac) VALUES('2019-10-12 22:00:00', 'A'); INSERT INTO test.visits(ts, mac) VALUES('2019-11-12 22:00:00', 'A'); INSERT INTO test.visits(ts, mac) VALUES('2019-12-12 22:00:00', 'A'); INSERT INTO test.visits(ts, mac) VALUES('2019-08-12 22:00:00', 'A'); INSERT INTO test.visits(ts, mac) VALUES('2019-09-12 22:00:00', 'B'); INSERT INTO test.visits(ts, mac) VALUES('2019-12-12 22:00:00', 'B'); SELECT partition, name, active FROM system.parts WHERE (table = 'visits') AND (database = 'test') ORDER BY partition ASC; OPTIMIZE TABLE test.visits DEDUPLICATE; OPTIMIZE TABLE test.visits FINAL; SELECT partition, name, active FROM system.parts WHERE (table = 'visits') AND (database = 'test') ORDER BY partition ASC;",
    "Affected Elements": "CREATE TABLE, INSERT INTO, SELECT, OPTIMIZE TABLE",
    "Root Cause Analysis": "The TTL setting is not functioning as expected with the custom partitioning key, leading to old parts not being dropped from the table."
}