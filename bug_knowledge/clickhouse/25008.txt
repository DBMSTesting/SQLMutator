{
    "sql": "CREATE OR REPLACE TABLE funnels (EventTime DateTime, UserId UInt64, Step UInt8) ENGINE = MergeTree() ORDER BY (UserId, EventTime) PARTITION BY (EventTime) SAMPLE BY UserId; INSERT INTO funnels SELECT 24*60*60*0, number, 1 FROM system.numbers LIMIT 100000000; INSERT INTO funnels SELECT 24*60*60*1, number, 2 FROM system.numbers LIMIT 10000000; INSERT INTO funnels SELECT 24*60*60*2, number, 3 FROM system.numbers LIMIT 1000000; SELECT level, count() AS c FROM ( SELECT UserId, windowFunnel(25920000)(EventTime, Step = 1, Step = 2, Step = 3) AS level FROM funnels SAMPLE 1/10000 GROUP BY UserId ) as a GROUP BY level ORDER BY level ASC;",
    "Affected Elements": "SAMPLE BY, ORDER BY, windowFunnel function",
    "Root Cause Analysis": "The SAMPLE BY clause requires the use of intHash32 in the ORDER BY clause to function correctly, leading to performance issues without it."
}