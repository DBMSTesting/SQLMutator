{
    "sql": "CREATE TABLE IF NOT EXISTS compass.test_merge (`scroll` AggregateFunction(avg, UInt8)) ENGINE = AggregatingMergeTree() ORDER BY tuple() SETTINGS index_granularity = 8192; echo \"SELECT scroll from compass.m_hits_day_1 WHERE event_time < toDateTime('2021-02-16 07:30:00') AND site_id=108 AND finalizeAggregation(scroll) = 43.89265536723164 FORMAT CSV\" > /tmp/query.sql; cat /tmp/query.sql | clickhouse-client --password 'OLD_SERVER_PASS' --host 'OLD_SERVER_HOST' --max_memory_usage 40G > /tmp/hits.csv; cat /tmp/hits.csv | clickhouse-client --password 'OLD_SERVER_PASS' --host 'OLD_SERVER_HOST' --max_memory_usage 40G --query=\"INSERT INTO compass.test_merge FORMAT CSV\"; cat /tmp/hits.csv | clickhouse-client --password 'NEW_SERVER_PASS' --host 'NEW_SERVER_HOST' --max_memory_usage 40G --query=\"INSERT INTO compass.test_merge FORMAT CSV\";",
    "Affected Elements": "AggregateFunction(avg, UInt8), finalizeAggregation(scroll)",
    "Root Cause Analysis": "The discrepancy in handling the AggregateFunction between different server versions leads to inconsistent data aggregation results."
}