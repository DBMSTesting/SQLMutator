{
    "sql": "CREATE TABLE staging.test_shard ON CLUSTER cluster_name (id String, sid String) ENGINE = ReplicatedMergeTree('/clickhouse/tables/{shard}/staging/test_shard', '{replica}') PARTITION BY tuple() ORDER BY (id); CREATE TABLE staging.test_new ON CLUSTER cluster_name AS staging.test_shard ENGINE = Distributed(cluster_name, staging, test_shard, rand()); RENAME TABLE staging.test_new TO staging.test ON CLUSTER cluster_name; INSERT INTO staging.test (id) VALUES ('1'); ALTER TABLE staging.test_shard ON CLUSTER cluster_name DROP COLUMN sid; ALTER TABLE staging.test_shard ON CLUSTER cluster_name ADD COLUMN sid MATERIALIZED id; INSERT INTO staging.test (id) VALUES ('2'); INSERT INTO staging.test (id) VALUES ('3'); CREATE TABLE staging.test_new ON CLUSTER cluster_name AS staging.test_shard ENGINE = Distributed(cluster_name, staging, test_shard, rand()); RENAME TABLE staging.test TO staging.test_old, staging.test_new TO staging.test ON CLUSTER cluster_name; SELECT COUNT(*) FROM staging.test; INSERT INTO staging.test (id) VALUES ('4'); INSERT INTO staging.test (id) VALUES ('5'); SELECT COUNT(*) FROM staging.test; DROP TABLE staging.test_old ON CLUSTER cluster_name;",
    "Affected Elements": "RENAME TABLE, INSERT INTO, ALTER TABLE, MATERIALIZED COLUMN",
    "Root Cause Analysis": "The issue arises due to the failure of the RENAME operation to update the data directory, resulting in new data not being directed to the appropriate location and causing conflicts with the MATERIALIZED column definition."
}