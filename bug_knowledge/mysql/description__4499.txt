{
    "sql": "-- Source \nCREATE TABLE test_txn_main_tbl (\ntxn_id bigint(16) NOT NULL,\ncol1 varchar(100),\ncol2 varchar(100),\noverride_routing_no_upd varchar(1) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT 'N',\noutbound_file_id bigint(12) DEFAULT NULL,\noutbound_file_type int(4) DEFAULT NULL,\ntxn_status_code int(3) DEFAULT NULL,\ntxn_sub_status_code int(4) DEFAULT NULL,\npartner_id bigint(12) DEFAULT NULL,\ntxn_schld_date datetime DEFAULT NULL,\nPRIMARY KEY (txn_id)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n-- Target \nCREATE TABLE test_txn_schd_queue_tbl (\ntxn_id bigint(16) NOT NULL,\ncol1 varchar(100),\ncol2 varchar(100),\noverride_routing_no_upd varchar(1) CHARACTER SET utf8 COLLATE utf8_bin DEFAULT 'N',\nschld_id bigint(16) DEFAULT NULL,\nschld_row_id bigint(16) DEFAULT NULL,\noutbound_file_id bigint(12) DEFAULT NULL,\noutbound_file_type int(4) DEFAULT NULL,\ntxn_status_code int(3) DEFAULT NULL,\ntxn_sub_status_code int(4) DEFAULT NULL,\npartner_id bigint(12) DEFAULT NULL,\ntxn_schld_date datetime DEFAULT NULL,\nPRIMARY KEY (txn_id),\nKEY test_txn_schd_queue_tbl_rtno_idx (override_routing_no_upd),\nKEY test_txn_schd_queue_tbl_idx1 (schld_id,schld_row_id),\nKEY test_txn_schd_queue_tbl_idx2 (outbound_file_id),\nKEY test_txn_schd_queue_tbl_idx3 (outbound_file_type,txn_status_code,txn_sub_status_code),\nKEY test_txn_schd_queue_tbl_idx4 (partner_id,txn_schld_date)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8;\n\n-- Populate source\nINSERT INTO test_txn_main_tbl(txn_id, col1, col2, override_routing_no_upd, outbound_file_id, outbound_file_type, txn_status_code, txn_sub_status_code, partner_id, txn_schld_date) \nVALUES(5131630, 'one', 'two', 'Y', 70000, 1004, 17, 559, 195, NOW()),\n(5133631, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133632, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133633, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133634, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133635, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133636, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133637, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133638, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133639, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW()),\n(5133640, 'one', 'two', 'Y', NULL, 510, 17, 559, 124, NOW());\n\n-- Populate target\nINSERT INTO test_txn_schd_queue_tbl(txn_id, col1, col2, override_routing_no_upd, schld_id, schld_row_id, outbound_file_id, outbound_file_type, txn_status_code, txn_sub_status_code, partner_id, txn_schld_date) \nSELECT txn_id, col1, col2, override_routing_no_upd, 9974590 as schld_id, (@ROWNUM:=@ROWNUM+1) as schld_row_id, outbound_file_id, outbound_file_type, txn_status_code, txn_sub_status_code, partner_id, txn_schld_date\nFROM test_txn_main_tbl,\n(SELECT @ROWNUM:=0) a\nWHERE txn_id IN (5131630, 5133631, 5133632);\n\n-- Session 1\nBEGIN;\n\nINSERT INTO test_txn_schd_queue_tbl(txn_id, col1, col2, override_routing_no_upd, schld_id, schld_row_id, outbound_file_id, outbound_file_type, txn_status_code, txn_sub_status_code, partner_id, txn_schld_date) \nSELECT txn_id, col1, col2, override_routing_no_upd, 9974687 as schld_id, (@ROWNUM:=@ROWNUM+1) as schld_row_id, outbound_file_id, outbound_file_type, txn_status_code, txn_sub_status_code, partner_id, txn_schld_date\nFROM test_txn_main_tbl,\n(SELECT @ROWNUM:=0) a\nWHERE txn_id NOT IN (5131630, 5133631, 5133632);\n\n-- Session 2\nUPDATE test_txn_schd_queue_tbl\nSET col1 = 'Updated'\nWHERE schld_id = 9974590 and schld_row_id BETWEEN 1 AND 3;",
    "Affected Elements": "UPDATE statements, WHERE clauses involving non-unique keys",
    "Root Cause Analysis": "InnoDB's handling of locks in the presence of uncommitted transactions, specifically around gap locking behavior when using non-unique indexes."
}