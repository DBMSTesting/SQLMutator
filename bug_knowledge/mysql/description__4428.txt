{
    "sql": "USE test; SELECT f_bms_odometers_no('bms_so_key', 'SODETAIL') FROM tbl_a sm INNER JOIN tbl_b oh ON sm.wh_code = oh.wh_code AND sm.sono = oh.wms_order_no; CREATE FUNCTION f_bms_odometers_no(odometer_code VARCHAR(100), prefix VARCHAR(20)) RETURNS VARCHAR(255) CHARSET utf8 COLLATE utf8_bin BEGIN DECLARE str VARCHAR(255) DEFAULT ''; DECLARE no_count_id INT DEFAULT -1; SELECT no_count INTO no_count_id FROM plat_odometer WHERE no_name = odometer_code; IF (no_count_id >= 0) THEN SET no_count_id = no_count_id + 1; UPDATE plat_odometer SET no_count = no_count_id WHERE no_name = odometer_code; SET str = CONCAT(prefix, DATE_FORMAT(NOW(), '%Y%m%d'), RIGHT(CONCAT('0000000000', no_count_id), 10)); END IF; RETURN str; END;",
    "Affected Elements": "SELECT, CREATE FUNCTION, INNER JOIN, UPDATE, IF, CONCAT, DATE_FORMAT, RIGHT",
    "Root Cause Analysis": "The data node crashes due to a massive overload when executing complex SQL statements, leading to timeouts and internal errors."
}