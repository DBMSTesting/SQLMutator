{
    "sql": "CREATE TABLE IF NOT EXISTS `in_docs` (`id` int(11) NOT NULL AUTO_INCREMENT, `doc_type` smallint(6) NOT NULL DEFAULT '0', `sender_code` varchar(10) COLLATE utf8_unicode_ci NOT NULL DEFAULT '', `orig_reg_number` varchar(25) COLLATE utf8_unicode_ci NOT NULL, `orig_sent_date` date DEFAULT NULL, `followup_doc_id` int(11) NOT NULL, `reg_year` char(2) COLLATE utf8_unicode_ci NOT NULL, `reg_number` int(11) NOT NULL, `paper_reg_number` varchar(25) COLLATE utf8_unicode_ci NOT NULL DEFAULT '', `title` text COLLATE utf8_unicode_ci NOT NULL, `contact_id` int(11) NOT NULL DEFAULT '0', `contact_info` varchar(255) COLLATE utf8_unicode_ci NOT NULL DEFAULT '', `reg_date` date NOT NULL DEFAULT '0000-00-00', `deadline` date DEFAULT NULL, `ext_response_status` enum('none','accept','reject') COLLATE utf8_unicode_ci NOT NULL DEFAULT 'none', `deadline_notes` varchar(255) COLLATE utf8_unicode_ci NOT NULL DEFAULT '', `creator_user_id` smallint(11) NOT NULL DEFAULT '0', `access_level_id` smallint(6) NOT NULL DEFAULT '0', `fully_electronic` tinyint(1) NOT NULL DEFAULT '0', `media_type_id` smallint(6) NOT NULL DEFAULT '0', `modified` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `created` timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (`id`), UNIQUE KEY `reg_year_and_number` (`reg_year`,`reg_number`), KEY `reg_date` (`reg_date`), KEY `orig_reg_number` (`orig_reg_number`), KEY `contact_info` (`contact_info`), KEY `title` (`title`(333)), KEY `followup_doc_id` (`followup_doc_id`)) ENGINE=MyISAM  DEFAULT CHARSET=utf8 COLLATE=utf8_unicode_ci PACK_KEYS=0 COMMENT='Incoming Documents' AUTO_INCREMENT=31824; INSERT INTO `in_docs` (`reg_year`, `id`, `reg_number`) VALUES ('11', 31659, 33), ('11', 31660, 34), ... , ('14', 31822, 40), ('14', 31823, 41); SELECT IF(MAX(reg_number) <= 0, 1, MAX(reg_number) + 1) FROM in_docs WHERE reg_year='14-1';",
    "Affected Elements": "SELECT, IF, MAX, WHERE",
    "Root Cause Analysis": "The bug arises from an incorrect assumption that the query would return a meaningful value when no matching rows exist for the specified reg_year."
}