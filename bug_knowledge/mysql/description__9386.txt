{
    "sql": "CREATE TABLE label ( id INT ); INSERT INTO label VALUES (0), (1); CREATE TABLE record ( label_id INT, amount BIGINT, deleted BOOLEAN ); INSERT INTO record VALUES (0, 1, 0), (1, -2, 0), (1, 3, 0), (0, -10, 1), (1, -10, 1); SELECT L.id AS label_id, AMOUNTS.type, AMOUNTS.amount FROM label AS L CROSS JOIN LATERAL ( SELECT CASE WHEN R.deleted = TRUE THEN NULL WHEN R.amount < 0 THEN 'NEGATIVE' WHEN R.amount >= 0 THEN 'POSITIVE' END AS type, SUM(R.amount) AS amount FROM record AS R WHERE R.label_id = L.id GROUP BY type HAVING type IS NOT NULL) AS AMOUNTS ORDER BY label_id ASC;",
    "Affected Elements": "LATERAL, aggregated functions, SUM, GROUP BY, HAVING",
    "Root Cause Analysis": "Incorrect handling of reference slices in the aggregation process during LATERAL joins, leading to erroneous results."
}