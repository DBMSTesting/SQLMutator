{
    "sql": "SET GLOBAL innodb_stats_auto_recalc = 0; SET GLOBAL innodb_stats_method = 'nulls_equal'; SET GLOBAL innodb_stats_on_metadata = 0; SET GLOBAL innodb_stats_persistent = 1; SET GLOBAL innodb_stats_persistent_sample_pages = 1000; SET GLOBAL innodb_stats_sample_pages = 8; SET GLOBAL innodb_stats_transient_sample_pages = 8; CREATE TABLE sale (id INT PRIMARY KEY AUTO_INCREMENT, customer_id INT NOT NULL, product_id INT NOT NULL, sale_time DATETIME NOT NULL, sale_value DECIMAL(10,2) NOT NULL, filler VARCHAR(250) NOT NULL, KEY(customer_id, sale_time), KEY(product_id)) ENGINE=InnoDB STATS_AUTO_RECALC=0 STATS_SAMPLE_PAGES=1000; INSERT INTO sale (customer_id, product_id, sale_time, sale_value, filler) VALUES (1, 1, NOW(), 100, LPAD('X', 250, 'X')), (1, 2, NOW(), 200, LPAD('X', 250, 'X')), (1, 3, NOW(), 300, LPAD('X', 250, 'X')), (2, 4, NOW(), 100, LPAD('X', 250, 'X')), (2, 5, NOW(), 200, LPAD('X', 250, 'X')), (3, 6, NOW(), 100, LPAD('X', 250, 'X')); INSERT INTO sale (customer_id, product_id, sale_time, sale_value, filler) SELECT customer_id, product_id, NOW(), sale_value, filler FROM sale; ANALYZE TABLE sale; SHOW INDEXES FROM sale;",
    "Affected Elements": "SHOW INDEXES; INSERT INTO ... SELECT; ANALYZE TABLE",
    "Root Cause Analysis": "The statistics are incorrectly updated due to persistent statistics settings and the handling of cardinality in InnoDB."
}