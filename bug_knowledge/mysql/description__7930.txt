{
    "sql": "CREATE TABLE jsontest ( `id` int NOT NULL AUTO_INCREMENT, `docId` int unsigned NOT NULL, `data` json NOT NULL, PRIMARY KEY (`id`), KEY `subIds` ((cast(`data`->'$.subDocs[*].subId' as unsigned array))) ) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci; INSERT INTO `jsontest` (docId,`data`) VALUES (1111111,'{\"docId\": 1111111, \"subDocs\": [{\"subId\": 1111111}, {\"subId\": 1111112}]}'), (2222222,'{\"docId\": 2222222, \"subDocs\": [{\"subId\": 2222222}]}'), (3333334,'{\"docId\": 3333334, \"subDocs\": [{\"subId\": 3333334}]}'), (3333335,'{\"docId\": 3333335, \"subDocs\": [{\"subId\": 3333334}, {\"subId\": 3333335}]}'); EXPLAIN SELECT d.docId FROM jsontest d WHERE d.docId MEMBER OF (d.data->'$.subDocs[*].subId');",
    "Affected Elements": "MEMBER OF clause, JSON extraction functions",
    "Root Cause Analysis": "The optimizer fails to use the multi-valued index when a column reference is used instead of a static value in the MEMBER OF clause."
}